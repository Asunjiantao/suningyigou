//基础组件以及方法


;(function(window){	
	var Util = Util || {};
	Util.listloop = function (opt) {
		/**
		 * [ description by 12050231]
		 * @param  {[type]} wrap [最外层DOM元素id或class]
		 * @param  {[type]} loopBox [循环滚动的DOM元素]
		 * @param  {[type]} triggerLeft [控制左移的按钮]
		 * @param  {[type]} triggerRight [控制右移的按钮]
		 * @param  {[Object]} step [滚动的元素数量]
		 * @param  {[Object]} scrollWidth [滚动的宽度]
		 * @param  {[type]} isLazyLoad [是否需要图片懒加载]
		 * @param  {[type]} hasCount [是否有图片计数]
		 * @param  {[type]} isLoop [是否循环]
		 * @return {[type]}   [description]
		 * @param  {[type]} timeDelay [自动滚动时间]
		 * @param {[type]}  isAuto [是否自动滚动]
		 */
		var _opt = {
			wrap: '',
			loopBox: '',
			loopChild: '',
			triggerLeft: '.switch-prev',
			triggerRight: '.switch-next',
			curCount: '',
			totalCount: '',
			hasCount: false,
			isLoop: true,
			isLazyImg: false,
			isLazyDom: false,
			delay: 0,
			hasLabel: true,
			hasLabelObj: null,
			labelObj: null,
			isRandom: false,
			timeDelay: 5000,
			isAuto: false
		};
		$.extend(_opt, opt);
		var box = $(_opt.wrap),
			leftCtrl = box.find(_opt.triggerLeft),
			rightCtrl = box.find(_opt.triggerRight),
			moveBox = box.find(_opt.loopBox),
			moveBoxLi = moveBox.find(_opt.loopChild),
			step = _opt.step.wide,
			scrollWidth = _opt.scrollWidth.wide,
			len = Math.ceil(moveBoxLi.length / step),
			liLen = moveBoxLi.length,
			curCount = box.find(_opt.curCount),
			totalCount = box.find(_opt.totalCount),
			pagerBox = $(_opt.hasLabelObj),
			i = 0,
			_step,
			timer = null,
			timeDelay = _opt.timeDelay;
		if (!bigscreen) {
			step = _opt.step.narrow;
			scrollWidth = _opt.scrollWidth.narrow;
			_step = moveBoxLi.length % step;
			len = Math.ceil(moveBoxLi.length / step);
			liLen = moveBoxLi.length - _step;
		}

		box.hover(function () {
			leftCtrl.show();
			rightCtrl.show();
			autoPause()
		}, function () {
			leftCtrl.hide();
			rightCtrl.hide();
			autoStart()
		})

		_opt.hasCount && totalCount.html(len);

		leftCtrl.unbind().click(function () {
			prev();
		});
		rightCtrl.unbind().click(function () {
			next();
		});

		function autoStart() {
			if (_opt.isAuto) {
				timer = setInterval(function () {
					next();
				}, timeDelay);
			}
		}
		autoStart();



		function autoPause() {
			clearInterval(timer);
		}

		// 键盘切换
		$(document).keyup(function (e) {
			if (index.isInScreen(rightCtrl)) {
				if (e.which == 37 || e.which == 75) {
					prev();
				}
				if (e.which == 39 || e.which == 74) {
					next();
				}
			}
		});

		var pager = opt.labelObj,
			pagerDom = '',
			pageri;
		if (pager) {
			if (len <= 1) {
				pager.hide();
			}

			pager.find('.prev').unbind().click(function () {
				prev();
			});
			pager.find('.next').unbind().click(function () {
				next();
			});

			for (pageri = 0; pageri < len; pageri++) {
				pagerDom += '<li></li>';
			}
			pager.find('ul').html(pagerDom).find('li').click(function () {
				i = $(this).index();
				move(false, i);
			}).first().addClass('current');
		}

		function next() {
			if (len == 1 || moveBox.is(":animated")) {
				return false;
			}
			if (!_opt.isLoop) {
				i++;
				if (i >= len) {
					i = len - 1
				}
				move(false, i);
				return;
			}
			if (i == len - 1) {
				for (var j = 0; j < step; j++) {
					moveBoxLi.eq(j).css({
						"position": "relative",
						"left": len * scrollWidth + "px"
					});
				}
			}
			i++;
			move(function () {
				if (i == len) {
					i = 0;
					moveBoxLi.removeAttr("style");
					moveBox.css("left", i * scrollWidth);
				}
			}, i);
		}

		function prev() {
			if (len == 1 || moveBox.is(":animated")) {
				return false;
			}
			if (!_opt.isLoop) {
				i--;
				if (i <= 0) {
					i = 0;
				}
				move(false, i);
				return;
			}
			if (i == 0) {
				for (var j = 1; j <= step; j++) {
					moveBoxLi.eq(liLen - j).css({
						"position": "relative",
						"left": -len * scrollWidth + "px"
					});
				}
			}
			i--;
			move(function () {
				if (i == -1) {
					i = len - 1;
					moveBoxLi.removeAttr("style");
					moveBox.css("left", -i * scrollWidth);
				}
			}, i);
		}

		function move(callback, _index) {
			if (_opt.hasCount) {
				if (_index > len - 1) {
					_index = 0
				}
				if (_index < 0) {
					_index = len - 1
				}
				curCount.html(_index + 1);
			}
			if (!callback) {
				callback = function () {}
			}
			moveBox.stop(true).animate({
				left: -i * scrollWidth
			}, 300, callback);
			lazyDom();
			lazyImg();
			//cptPv
			for (var j = (i * step); j < ((i + 1) * step); j++) {
				if (moveBoxLi.eq(j).attr("cptId")) {
					pid = moveBoxLi.eq(j).attr("cptId");
					if (pid) {
						try {
							apsAdboardCptPvObj.aps_adboard_loadAdCptPv(pid, index.cptTime);
						} catch (e) {}
					}
				}
			}

			// 同步分页标签
			chooseLabel(i == len ? 0 : i);
			if (pager) {
				pager.find('li').removeClass('current').eq(i == len ? 0 : i).addClass('current');
			}
		}

		//dom懒加载
		function lazyDom() {
			if (!_opt.isLazyDom) {
				return;
			}
			var _dom = moveBoxLi.eq(i).find('.lazy-dom'),
				source = _dom.text(),
				sourceLength = source.length;
			if (sourceLength == 0) return;
			var rep = /\n+/g,
				repone = /<!--.*?-->/ig,
				reptwo = /\/\*.*?\*\//ig,
				reptree = /[ ]+</ig,
				sourceZero = source.replace(rep, ""),
				sourceOne = sourceZero.replace(repone, ""),
				sourceTwo = sourceOne.replace(reptwo, ""),
				sourceTree = sourceTwo.replace(reptree, "<");
			_dom.before(sourceTree).remove();
			lazyImg();
		}

		//图片懒加载
		function lazyImg() {
			lazyelem.detect();
		}
		// 项目扩展
		// 创建分页标签
		function createLabel() {
			var dom = [],
				j, timer;
			dom.push('<div class="banner-pager"><div class="black"></div><div class="pager">');
			for (j = 1; j <= len; j++) {
				dom.push('<a' + (j == 1 ? ' class="current"' : '') + ' href="javascript:;"></a>');
			}
			dom.push('</div></div>');
			var pager = $(dom.join('')).appendTo(pagerBox);
			// 分页部分行为
			pager.find('a').hover(function () {
				var index = $(this).index(),
					begin = index * step,
					over = (index + 1) * step;
				timer = setTimeout(function () {
					moveBox.stop(true).animate({
						left: -index * scrollWidth
					}, 300);
					chooseLabel(index);
					if (_opt.hasCount) {
						curCount.html(index + 1);
					}
					i = index;
					//dom懒加载
					if (_opt.isLazyDom) {
						var _dom = moveBoxLi.eq(i).find('.lazy-dom'),
							source = _dom.text(),
							sourceLength = source.length;
						if (sourceLength == 0) return;
						var rep = /\n+/g,
							repone = /<!--.*?-->/ig,
							reptwo = /\/\*.*?\*\//ig,
							reptree = /[ ]+</ig,
							sourceZero = source.replace(rep, ""),
							sourceOne = sourceZero.replace(repone, ""),
							sourceTwo = sourceOne.replace(reptwo, ""),
							sourceTree = sourceTwo.replace(reptree, "<");
						_dom.before(sourceTree).remove();
					}

					//图片懒加载
					if (_opt.isLazyImg) {
						for (var n = begin; n < over; n++) {
							moveBoxLi.eq(n).find('img[src3]').each(function () {
								var _this = $(this);
								_this.attr('src', _this.attr('src3')).removeAttr('src3').addClass('err-product');
							});
						}
					}

				}, 100);
			}, function () {
				clearTimeout(timer);
			});
		}

		function chooseLabel(i) {
			box.find('.pager a').removeClass('current').eq(i).addClass('current');
		}

		if (_opt.hasLabel && len > 1) {
			createLabel();
		}

		if (_opt.delay) {
			var auto = setInterval(function () {
				next();
			}, _opt.delay);

			box.hover(function () {
				clearInterval(auto);
			}, function () {
				auto = setInterval(function () {
					next();
				}, _opt.delay);
			});
		}
	};


	Util.CountDown = function (opts) {
		function Timer(opts) {
			this.opts = opts || {};
			this.obj = this.opts.obj;
			this.nowTime = this.opts.nowTime;
			this.startTime = this.opts.startTime;
			this.endTime = this.opts.endTime;
			this.dayNode = this.opts.dayNode || ".day-node";
			this.hourNode = this.opts.hourNode || ".hour-node";
			this.minuteNode = this.opts.minuteNode || ".minute-node";
			this.secondNode = this.opts.secondNode || ".second-node";
			// 即将开始
			this.beforeStart = this.opts.beforeStart || function () {};
			// 倒计时中
			this.isStart = this.opts.isStart || function () {};
			// 结束状态
			this.callback = this.opts.callback || function () {};
			this.speed = this.opts.speed || 1000;
			this.timeOffset = 0;
			this.gap = [];
			this.auto = null;
		}

		Timer.prototype = {
			init: function () {
				var self = this;
				self.timeOffset = self.nowTime - new Date().getTime();
				self.timer();
				self.run();
			},
			timer: function () {

				var self = this,
					//nowTime以服务器时间为准
					now = this.nowTime;

				if (self.startTime && parseInt(self.startTime) > parseInt(now)) { //未开始           
					self.gap = self.parse(self.startTime - now);
					self.html();
					this.beforeStart();
				} else if (self.endTime && parseInt(self.endTime) > parseInt(now)) { //开始未结束, 进行中
					self.gap = self.parse(self.endTime - now);
					self.html();
					this.isStart();
				}
				if (parseInt(self.endTime) < parseInt(this.nowTime)) { // 已结束
					clearTimeout(self.auto);
					this.callback();
				}
				//fix移动端页面在后台不跑倒计时的问题：在init()时记录本地时间与服务端时间偏移量，定时器中每次从本地取时间加上偏移量
				this.nowTime = new Date().getTime() + this.timeOffset;
			},
			parse: function (time) {
				var self = this,
					t = time / self.speed;
				self.second = Math.round(t % 60);
				self.minute = Math.floor((t / 60) % 60);
				self.hour = Math.floor((t / 60 / 60) % 24);
				self.day = Math.floor(t / 60 / 60 / 24);
				if (self.second < 10) {
					self.second = "0" + self.second;
				}
				if (self.minute < 10) {
					self.minute = "0" + self.minute;
				}
				if (self.hour < 10) {
					self.hour = "0" + self.hour;
				}
				if (self.day < 10) {
					self.day = "0" + self.day;
				}
				return [self.second, self.minute, self.hour, self.day]
			},
			html: function () {
				var self = this;
				self.obj.find(this.dayNode).html(self.gap[3]);
				self.obj.find(this.hourNode).html(self.gap[2]);
				self.obj.find(this.minuteNode).html(self.gap[1]);
				self.obj.find(this.secondNode).html(self.gap[0]);
			},
			run: function () {
				var self = this;
				self.auto = setInterval(function () {
					self.timer();
				}, 500)
			}
		}
		new Timer(opts).init();
	}

	Util.scrollTab = function (opts) {

		var _opt = {
			wrap: '',
			item: '',
			wrapWidth: '',
			itemWidth: '',
			callback: function () {

			}

		};
		$.extend(_opt, opts);

		this.wrapper = _opt.wrap
		this.item = $(this.wrapper).find(_opt.item)
		this.wrapWidth = _opt.wrapWidth
		this.itemWidth = _opt.itemWidth
		this.callback = _opt.callback

		this.init()

	}

	Util.scrollTab.prototype = {

		init: function () {
			this.itemClick()
		},

		itemClick: function () {
			var self = this
			$(self.item).on('click', function () {
				var $this = $(this)
				$this.addClass('cur').siblings().removeClass('cur')
				self.to($this.index())
			})
		},

		to: function (index) {
			var left = 0,
				length = $(this.item).length,
				firstSize;

			firstSize = $(this.item).eq(0).hasClass('jx');

			if (index < 3) {
				//left = 0
			} else if (index > (length - 3)) {
				left = -(this.itemWidth * length - this.wrapWidth)
				if (firstSize) {
					left = left + 42
				}
			} else {
				left = (2 - index) * this.itemWidth
				if (firstSize) {
					left = left - 42
				}
			}

			$(this.wrapper).stop(true).animate({
				'left': left + 'px'
			}, 300)

		}
	}

	Util.serialize = function (obj) {
		var str = '',
			flag = false;
		for (key in obj) {
			if (flag) {
				str += '&';
			}
			str += key + '=' + obj[key];

			flag = true;
		}
		return str;
	}

	Util.isiPad = function () {
		var userAgentInfo = navigator.userAgent;
		var Agent = "iPad";
		var flag = false;

		if (userAgentInfo.indexOf(Agent) > 0) {
			flag = true;
		}
		return flag;
	}

	Util.json2String = function (str) {
		if (!window.JSON) {
			window.JSON = {
				stringify: function (obj) {
					var result = "";
					for (var key in obj) {
						if (typeof obj[key] == "string") {
							// 如果属性值是String类型，属性值需要加上双引号
							result += "\"" + key + "\":\"" + obj[key] + "\",";
						} else if (obj[key] instanceof RegExp) {
							// 如果属性是正则表达式，属性值只保留一对空大括号{}
							result += "\"" + key + "\":{},";
						} else if (typeof obj[key] == "undefined" || obj[key] instanceof Function) {
							// 如果属性值是undefined, 该属性被忽略。忽略方法。
						} else if (obj[key] instanceof Array) {
							// 如果属性值是数组
							result += "\"" + key + "\":[";
							var arr = obj[key];
							for (var item in arr) {
								if (typeof arr[item] == "string") {
									// 如果数组项是String类型，需要加上双引号
									result += "\"" + arr[item] + "\",";
								} else if (arr[item] instanceof RegExp) {
									// 如果属数组项是正则表达式，只保留一对空大括号{}
									result += "{},";
								} else if (typeof arr[item] == "undefined" || arr[item] instanceof Function) {
									// 如果数组项是undefined, 则显示null。如果是函数，则显示null?。
									result += null + ",";
								} else if (arr[item] instanceof Object) {
									//如果数组项是对象(非正则，非函数，非null)，调用本函数处理
									result += this.stringify(arr[item]) + ",";
								} else {
									result += arr[item] + ",";
								}
							}
							result = result.slice(0, -1) + "],"

						} else if (obj[key] instanceof Object) {
							// 如果属性值是对象(非null，非函数，非正则)，调用本函数处理
							result += "\"" + key + "\":" + this.stringify(obj[key]) + ",";
						} else {
							result += "\"" + key + "\":" + obj[key] + ",";
						}
					}
					// 去除最后一个逗号,两边加{}
					return "{" + result.slice(0, -1) + "}";
				}
			};

		}
		return JSON.stringify(str);
	}

	Util.getCurrentTime = function () {
		var d = $.Deferred(),
			nowTime,
			self = this;
		if (this.serverOffset) {
			nowTime = new Date().getTime() + this.serverOffset;
			d.resolve(nowTime);
		} else {
			$.ajax({
				url: '//f.m.suning.com/api/ct.do',
				dataType: 'jsonp',
				timeout: 3000,
				success: function (data) {
					nowTime = parseInt(data.currentTime);
					self.serverOffset = nowTime - new Date().getTime();
					d.resolve(nowTime);
				},
				error: function () {
					nowTime = new Date().getTime();
					d.resolve(nowTime);
				}
			})
		}
		return d.promise();
	};

	//随机数用于图片服务器域名分配
	Util.getRandomNum = function () {
		return parseInt(Math.random() * 5) + 1;
	}

	//轮播组件
	Util.Slide = function (container, options) {
		//应用配置
		this.opt = $.extend({
			event: 'click', //切换触发事件
			mouseOverDelay: 0, //event为mouseover时，切换发生的延迟时间
			auto: true, //是否开启自动切换
			delay: 5000, //自动切换间隔
			duration: 500, //动画持续时间
			showLabel: true, //若为自定义分页标签，则传入选择器
			onchange: function (page) {}, //每次切换完成后的回调函数
			onchangestart: function (page) {},
			oninitend: function (container) {}
		}, options);
		//相关元素
		this.container = $(container);
		this.items = this.container.find('li');
		this.index = 0;
		this.pager = null;
		this.animating = false;
		this.screen = false;
		this.mouseIn = false;
		//初始化
		this._init();
	};
	Util.Slide.prototype = {
		_init: function () {
			var the = this;
			//生成标签并绑定事件
			this.opt.showLabel && this._createLabel();

			this.to(0, true);

			this.container.find('li a').on('mouseenter mousemove', function () {
				the.mouseIn = true;
				the.autoPause();
			});
			this.container.find('li a').on('mouseleave', function () {
				the.mouseIn = false;
				if (the.isInScreen()) {
					the.autoStart();
				}
			});

			//在可视区域，开始轮播
			if (this.isInScreen()) {
				// 自动切换
				the.autoStart();
				the.screen = true;
			}
			//不在可视区域，暂停轮播
			$(window).scroll(function () {
				if (the.isInScreen() && the.screen == false) {
					the.screen = true;
					the.autoStart();
				} else if (!the.isInScreen() && the.screen == true) {
					the.screen = false;
					the.autoPause();
				}
			});

			this.opt.oninitend.call(this, this.container);
		},
		_createLabel: function () {
			var the = this,
				dom = [],
				timer, i, a;
			dom.push('<div class="banner-nav">');
			for (i = 1; i <= this.items.size(); i++) {
				dom.push('<a tabindex="-1" href="javascript:;" class="page-item">' + i + '</a>');
			}
			dom.push('</div>');
			this.pager = typeof this.opt.showLabel == 'string' ? this.container.find(this.opt.showLabel) : $(dom.join('')).appendTo(this.container.parent().find(".banner-nav-wrapper"));
			//绑定标签事件

			if (this.opt.mouseOverDelay) {
				this.pager.find('a').hover(function () {
					var index = $(this).index();
					timer = setTimeout(function () {
						the.to(index);
					}, the.opt.mouseOverDelay);
				}, function () {
					clearTimeout(timer);
				});
			} else {
				this.pager.find('a').bind(this.opt.event, function () {
					the.to($(this).index());
				});
			}
		},
		autoStart: function () {
			var the = this;
			this.timer = setInterval(function () {
				the.next();
			}, this.opt.delay);
		},
		autoPause: function () {
			clearInterval(this.timer);
		},
		prev: function () {
			this.to(this.index == 0 ? this.items.size() - 1 : this.index - 1, true);
		},
		next: function () {
			this.to(this.index == this.items.size() - 1 ? 0 : this.index + 1, false);
		},
		to: function (index, flag) {
			var the = this;
			if (this.animating) {
				return false;
			}

			this.opt.onchangestart.call(this, index);
			this.animating = true;

			this.items.eq(index).css({
				'opacity': '1',
				'filter':'alpha(opacity=100)',
				'z-index':'0'
			}).siblings().css({
				'opacity': '0',
				'filter':'alpha(opacity=0)',
				'z-index':'-1'
			});
			this.animating = false;
			
			lazyelem.detect();
			if (!this.items.eq(index).attr('data-bgflag') || flag) {
				//如果没有策略请求
				if (this.items.eq(index).find('a[cpmId]') && !this.items.eq(index).find('a[cpmId]').attr('data-fromcelue') ) {
					cpmRequire(this.items.eq(index));
					if (this.items.eq(index).attr('data-needbg') == 'true') {
						this.items.eq(index).css('background',this.items.eq(index).attr('d-color'))
					}
				}else{
					this.items.eq(index).find('a[cpmId] img').attr('src',this.items.eq(index).find('a[cpmId] img').attr('d-src'));
				}

				if (this.items.eq(index).find('a[cptId]')) {
					this.items.eq(index).find('a[cptId]').each(function () {
						pid = $(this).attr('cptId')
						if (pid) {
							try {
								apsAdboardCptPvObj.aps_adboard_loadAdCptPv(pid, index.cptTime);
							} catch (e) {
								index.saYcFunc('sy-8dlbggcpmss-2sjbz');
							}
						}
					});
				}
				this.items.eq(index).attr('data-bgflag', 'true');
			}

			this.pager && this.pager.find('a').eq(index).addClass('current').siblings().removeClass('current');
			this.index = index;
			this.opt.onchange.call(this, index);
		},
		isInScreen: function () {
			var box = this.container;
			if (box.length > 0) {
				return ($(document).scrollTop() + $(window).height() - 100 > box.offset().top) && (box.offset().top + box.height() - 100 > $(document).scrollTop());
			}

		}
	};

	Util.verticalLoop = function (container, options) {

		//应用配置
		this.opt = $.extend({
			event: 'click', //切换触发事件
			mouseOverDelay: 0, //event为mouseover时，切换发生的延迟时间
			auto: true, //是否开启自动切换
			delay: 5000, //自动切换间隔
			duration: 500, //动画持续时间
			height: null,
			showLabel: false, //若为自定义分页标签，则传入选择器
			onchange: function (page) {}, //每次切换完成后的回调函数
			onchangestart: function (page) {},
			oninitend: function (container) {}
		}, options);
		//相关元素
		this.container = $(container);
		this.items = this.container.find('li');
		this.index = 0;
		this.pager = null;
		this.animating = false;
		this.screen = false;
		this.mouseIn = false;
		//初始化
		this._init();
	};

	Util.verticalLoop.prototype = {
		_init: function () {
			var the = this;

			this.container.find('ul').clone().appendTo(this.container);

			this.to(0);

			this.container.on('mouseenter mousemove', function () {
				the.mouseIn = true;
				the.autoPause();
			});
			this.container.on('mouseleave', function () {
				the.mouseIn = false;
				if (the.isInScreen()) {
					the.autoStart();
				}
			});

			//在可视区域，开始轮播
			if (this.isInScreen()) {
				// 自动切换
				the.autoStart();
				the.screen = true;
			}
			//不在可视区域，暂停轮播
			$(window).scroll(function () {
				if (the.isInScreen() && the.screen == false) {
					the.screen = true;
					the.autoStart();
				} else if (!the.isInScreen() && the.screen == true) {
					the.screen = false;
					the.autoPause();
				}
			});

			this.opt.oninitend.call(this, this.container);
		},
		autoStart: function () {
			var the = this;
			this.timer = setInterval(function () {
				the.next();
			}, this.opt.delay);
		},
		autoPause: function () {
			clearInterval(this.timer);
		},
		next: function () {
			this.to(this.index);
		},
		to: function (index) {
			var ul1 = this.container.find('ul').eq(0),
				ul2 = this.container.find('ul').eq(1),
				length = ul1.find('li').length,
				count = parseInt(length / 3),
				the = this;

			var scrollHeight = the.opt.height !== null ? the.opt.height : 144;
			ul1.animate({
				'marginTop': 0 - (index * scrollHeight) + 'px'
			}, 1000, function () {

				if (index == count) {
					ul1.css('marginTop', 0)
					the.index = 1;
				} else {
					the.index = index + 1;
				}
			});


		},
		isInScreen: function () {
			var box = this.container;
			if (box.length > 0) {
				return ($(document).scrollTop() + $(window).height() - 100 > box.offset().top) && (box.offset().top + box.height() - 100 > $(document).scrollTop());
			}

		}
	};

	// 楼层导航条
	Util.floatBar = function () {
		//默认参数
		var _d = {
			contents: null, //滚动条的内容，可以是DOM字符或者jQuery对象
			align: "right", //水平方向对齐
			vertical: "middle", //垂直方向对齐
			zIndex: 10000, //Z轴值
			css: null, //附加样式
			id: null, //包裹容器的id，必要时可以设置id用来操作DOM
			ieFixed: true //IE6及更低版本是否模拟fixed效果
		};

		//检测某些垃圾浏览器版本，并保存至变量
		var _ie = ($.browser.msie) ? parseInt($.browser.version) : false;

		//检测并合并传递的参数
		if (arguments.length < 1 || !(arguments[0] instanceof Object)) {
			return $.error("ECode.floatBar: 参数必须为JSON对象");
		}
		$.extend(_d, arguments[0]);

		//挂载DOM
		var _hideCss = {
			position: "fixed",
			top: "-9999em",
			left: "-9999em"
		};
		if (_ie && _ie <= 6) {
			_hideCss.position = "absolute";
		}
		$('<div class="ECode-floatBar"></div>').css(_hideCss).appendTo("body");

		//修正位置
		var _bar = $("body").find(".ECode-floatBar:last");
		_bar.append(_d.contents);
		var _bw = _bar.width(),
			_bh = _bar.height(),
			_css = {
				zIndex: _d.zIndex
			};
		if (_d.id != null) {
			_bar.attr("id", _d.id);
		}
		switch (_d.align) {
			case 'right':
				_css.left = 'auto';
				_css.right = 0;
				break;
			case 'left':
				_css.right = 'auto';
				_css.left = 0;
				break;
			case 'center':
				_css.right = 'auto';
				_css.left = '50%';
				_css.marginLeft = -parseInt(_bw / 2);
				break;
		}
		switch (_d.vertical) {
			case 'top':
				_css.top = 0;
				break;
			case 'bottom':
				_css.top = 'auto';
				_css.bottom = 0;
				break;
			case 'middle':
				_css.top = '50%';
				_css.marginTop = -parseInt(_bh / 2);
				if (_ie && _ie <= 6) {
					_css.marginTop = 0;
				}
				break;
		}
		_bar.css($.extend(_css, _d.css));

		/*
		* 以下代码针对IE6及更古老的版本
		* 如果感觉不爽，可以将 _d.ieFixed 置为 false
		* 那么IE6下将不会随屏滚动，囧~~
		* */
		var fixIE6 = function () {
			var _topHide = $(document).scrollTop(), //页面上部被卷去高度
				_winHeight = $(window).height(), //可视区域高度
				_winWidth = $(document).width(); //可视区域宽度
			switch (_d.vertical) {
				case 'top':
					_bar.stop().animate({
						top: _topHide
					});
					break;
				case 'bottom':
					var _newTop = _winHeight + _topHide - _bh;
					if (_d.css.marginBottom != null) {
						var _mb = parseInt(_d.css.marginBottom);
						//若果IE6下出现 margin-bottom 为负值，则忽略掉，否则合并计算得出 top 值
						if (_mb >= 0) {
							_newTop -= _mb;
						}
					}
					_bar.css({
						marginTop: 0
					}).stop().animate({
						top: _newTop
					});
					break;
				case 'middle':
					_bar.stop().animate({
						top: _winHeight / 2 + _topHide - _bh / 2
					});
					break;
			}
		};
		if (_d.ieFixed && _ie && _ie <= 6) {
			fixIE6();
			$(window).scroll(function () {
				fixIE6();
			});
			$(window).resize(function () {
				fixIE6();
			});
		}
	};

	//入参曝光埋点 埋点标签
	Util.baoguangFun = function (pdName, bqName) {

		var bqName = bqName ? bqName : 'a'

		//曝光数据采集
		if (typeof _analyseExpoTags == "function") {
			// 此处表示解析a标签的ID
			_analyseExpoTags(bqName, pdName);
		} else {
			setTimeout(function () {
				Util.baoguangFun(pdName, bqName);
			}, 2000);
		}

	}

	Util.stripscript = function (s) {
		var pattern = new RegExp("[<>]")
		var rs = "";
		for (var i = 0; i < s.length; i++) {
			rs = rs + s.substr(i, 1).replace(pattern, '');
		}
		return rs;
	}

	// 写cookie
	Util.SetCookie = function (name, val, day, domain) {
		var now = new Date;
		now.setTime(now.getTime() + day * 24 * 60 * 60 * 1000);
		if (domain) {
			document.cookie = name + "=" + escape(val) + ";path=/;domain=" + sn.cookieDomain + ";expires=" + now;
		} else {
			document.cookie = name + "=" + escape(val) + ";expires=" + now;
		}
	};

	// 取cookie
	Util.getCookie = function (a) {
		var b;
		return (b = document.cookie.match(new RegExp("(^| )" + a + "=([^;]*)(;|$)"))) ? Util.stripscript(decodeURIComponent(b[2].replace(/\+/g, "%20"))) : null;
	};

	//判断ie版本
	Util.ieVersion = function (ver) {
		var b = document.createElement('b');
		b.innerHTML = '<!--[if IE ' + ver + ']><i></i><![endif]-->';
		return b.getElementsByTagName('i').length === 1;
	};

	Util.isLocalStorageSupported = function () {
		var testKey = 'test',
			storage = window.localStorage;
		if (Util.ieVersion(7) || Util.ieVersion(6) || typeof JSON == 'undefined') {
			return false;
		}
		try {
			storage.setItem(testKey, 'testValue');
			storage.removeItem(testKey);
			return true;
		} catch (error) {
			return false;
		}
	}

	// 操作localstorage
	Util.setData = function (key, value) {
		if (Util.isLocalStorageSupported()) {
			localStorage.setItem(key, value);
		}
	};
	Util.getData = function (key) {
		if (Util.isLocalStorageSupported()) {
			return localStorage.getItem(key);
		}
		return null;
	};

	Util.getEnv = function (_hostName) {
		var ego_pre_reg = /^(\w*)(pre)(.*)(\.cnsuning\.com)$/;
		var ego_sit_reg = /^(\w*)(sit)(.*)(\.cnsuning\.com)$/;

		if (ego_pre_reg.test(_hostName)) {
			return 'pre';
		} else if (ego_sit_reg.test(_hostName)) {
			return 'sit';
		}
		return 'prd';
	};

	Util.getAjax = function (url, callback, type, cache) {

		var d = $.Deferred();
		$.ajax({
			cache: cache ? cache : true,
			type: type ? type : "GET",
			url: url,
			dataType: 'jsonp',
			jsonpCallback: callback,
			timeout: 50000,
			success: function (data) {
				d.resolve(data);
			},
			error: function (XMLHttpRequest, textStatus, errorThrown) {
				d.reject();
			}
		});

		var promise = d.promise();
		return promise;
	}
	Util.getAjaxJson = function (url, type, cache) {
		var d = $.Deferred();
		$.ajax({
			cache: cache ? cache : true,
			type: type ? type : "GET",
			url: url,
			dataType: 'json',
			timeout: 10000,
			success: function (data) {
				d.resolve(data);
			},
			error: function (XMLHttpRequest, textStatus, errorThrown) {
				d.reject();
			}
		});

		var promise = d.promise();
		return promise;
	}

	Util.isArrayFn = function (value) {
		if (typeof Array.isArray === "function") {
			return Array.isArray(value);
		} else {
			return Object.prototype.toString.call(value) === "[object Array]";
		}
	}

	Util.getCity = function (b) {
		var c = f("cityCode"),
			d = f("SN_CITY");
		if (d) {
			var g = analyzeCookie(d);
			"function" == typeof b && b(g.provinceCommerceId);
		} else if (c) {
			"function" == typeof b && b(c);
		} else {
			var h = SFE.URL_CONST.IP_HSOT[SFE.base.getEnv()] + "/ipQuery.do";
			$.ajax({
				type: "GET",
				url: h,
				cache: !0,
				async: !1,
				dataType: "jsonp",
				jsonpCallback: "streetIdCallback",
				success: function (a) {
					c = a.cityLESId,
						a.flag = "2",
						a.count = 0;
					var d = cityInfoToString(a);
					SFE.base.setCookie("SN_CITY", d),
						SFE.base.setCookie("cityCode", a.cityLESId),
						SFE.base.setCookie("districtId", a.districtCommerceId),
						"function" == typeof b && b(c)
				},
				error: function () {
					c = "025",
						"function" == typeof b && b(c)
				}
			})
		}

		function f(a) {
			var b;
			return (b = document.cookie.match(RegExp("(^| )" + a + "=([^;]*)(;|$)"))) ? stripscript(decodeURIComponent(b[2].replace(/\+/g, "%20"))) : null
		}

		function analyzeCookie(a) {
			var b = a.split("|"),
				c = null;
			if (b.length > 0) {
				var d = b[0].split("_");
				c = {},
					c.provinceMDMId = d[0],
					c.provinceCommerceId = d[1],
					c.cityMDMId = d[2],
					c.cityCommerceId = d[3],
					c.districtMDMId = d[4],
					c.districtCommerceId = d[5],
					c.flag = d[6],
					c.count = d[7]
			}
			return c
		}

		function cityInfoToString(a) {
			var b = "";
			return b += a.provinceMDMId,
				b += "_",
				b += a.cityLESId,
				b += "_",
				b += a.cityMDMId,
				b += "_",
				b += a.cityCommerceId,
				b += "_",
				b += a.districtLESId,
				b += "_",
				b += a.districtCommerceId,
				b += "_",
				b += a.flag,
				b += "_",
				b += a.count
		}
	},

	Util.getStreetCode = function () {
		if (!Util.getCookie('streetCode') || Util.getCookie('streetCode') == '') {
			var cityId = Util.getCookie('cityId');
			$.ajax({
				url: '//ipservice.suning.com/ipQuery.do?cityId=' + cityId,
				type: 'GET',
				dataType: 'jsonp',
				success: function (res) {
					var streetLESId = res.streetLESId;
					Util.SetCookie('streetCode', streetLESId, 365, true)
				},
				error: function () {
					var streetLESId = '';
				}
			})
		}
	},

	Util.getArrayItems = function (arr, num) {
		//新建一个数组,将传入的数组复制过来,用于运算,而不要直接操作传入的数组;
		var temp_array = new Array();
		for (var index in arr) {
			temp_array.push(arr[index]);
		}
		//取出的数值项,保存在此数组
		var return_array = new Array();
		for (var i = 0; i < num; i++) {
			//判断如果数组还有可以取出的元素,以防下标越界
			if (temp_array.length > 0) {
				//在数组中产生一个随机索引
				var arrIndex = Math.floor(Math.random() * temp_array.length);
				//将此随机索引的对应的数组元素值复制出来
				return_array[i] = temp_array[arrIndex];
				//然后删掉此索引的数组元素,这时候temp_array变为新的数组
				temp_array.splice(arrIndex, 1);
			} else {
				//数组中数据项取完后,退出循环,比如数组本来只有10项,但要求取出20项.
				break;
			}
		}
		return return_array;
	}
	
	window.Util = Util
	
})(window)

//cpm广告获取
;(function (d, e) {
	var a = d.document,
		b = d.location;
	var c = {
		pids_new: "",
		noConflict: function () {
			d.apsAdboardGroupObj = _apsAdboardGroupObj;
			return c
		},
		aps_adboard_jsonpCallback: function (g, f, i) {
			try {
				if ((g != null && "" != g) && (f != null && "" != f) && (i != null && "" != i)) {
					switch (f) {
						case "cpm":
							if (typeof (aps_adboard_romancecpmGroup) == "function") {
								aps_adboard_romancecpmGroup(g, i)
							} else {
								c.aps_adboard_defaultRomanceCpmGroup(g, i)
							}
							break;
						default:
							throw new Error("adType error!");
							break
					}
				} else {
					throw new Error("callback data is null")
				}
			} catch (h) {
				if (typeof (aps_adboard_errors) == "function") {
					aps_adboard_errors(h)
				}
			}
		},
		aps_adboard_addScriptTag: function (h, j, i) {
			var f = a.createElement("script");
			var g = a.head || a.getElementsByTagName("head")[0] || a.documentElement;
			f.async = true;
			f.setAttribute("type", "text/javascript");
			f.src = h;
			f.id = j + "jsonp";
			f.onload = function () {
				if (!f.readyState) {
					c.aps_adboard_delScript(f, g);
					i("200", j)
				}
			};
			f.onerror = function () {
				c.aps_adboard_delScript(f, g);
				i("request error", j)
			};
			f.onreadystatechange = function () {
				if (/loaded|complete/.test(f.readyState)) {
					c.aps_adboard_delScript(f, g)
				}
			};
			g.insertBefore(f, g.firstChild)
		},
		aps_adboard_delScript: function (f, g) {
			f.onreadystatechange = null;
			f.onload = null;
			if (g && f.parentNode) {
				g.removeChild(f)
			}
			f = e
		},
		aps_adboard_loadAdCpmGroup: function (m, f, k, city) {
			var l = sn.apsDomainUrl;
			if (null == m || "" == m) {
				throw new Error("pids is null");
				return
			}
			var h = l + "/getCpmDatasGroup?";
			for (var g = 0; g < m.length; g++) {
				if (g == 0) {
					h = h + "pid=" + m[g]
				} else {
					h = h + "&pid=" + m[g]
				}
			}
			if (null != k && "" != k) {
				h = h + "&inputTime=" + k
			}
			if (null != f && "" != f) {
				h = h + "&screenType=" + f
			}
			if (null != city && "" != city) {
				h = h + "&city=" + city
			}

			try {
				this.aps_adboard_addScriptTag(h, m, function (i, n) {
					if (i != "200") {
						if (typeof (aps_adboard_errors) == "function") {
							aps_adboard_errors(n, i)
						}
						if (typeof (aps_adboard_cpm_errors) == "function") {
							aps_adboard_cpm_errors(n, i)
						}
					}
				})
			} catch (j) {
				throw new Error("request net error")
			}
			c.pids_new = m;
			setTimeout("apsAdboardGroupObj.aps_adboard_defaultOutTime(apsAdboardGroupObj.pids_new)", 500);
			return
		},
		aps_adboard_defaultRomanceCpmGroup: function (j, m) {
			if (j == null) {
				return
			}
			if (m == null) {
				return
			}
			try {
				var l = "";
				var h;
				var f;
				for (var g = 0; g < j.length; g++) {
					l = '<a name="sn_link_' + j[g].pid + '" target="_blank"   href="' + j[g].apsClickUrl + '"><img src="' + j[g].adSrc + '" title="' + j[g].title + '" alt="' + j[g].title + '" border="0" /></a>';
					if (m instanceof Array) {
						f = m[g]
					} else {
						f = m
					}
					h = a.getElementById("aps_adboard_" + f);
					if (h != null) {
						h.innerHTML = l
					} else {
						throw new Error("pid div not exist")
					}
				}
			} catch (k) {
				throw new Error(k)
			}
		},
		aps_adboard_defaultErrors: function (f) {},
		aps_adboard_defaultOutTime: function (h) {
			var f = a.getElementById(h + "jsonp");
			if (f) {
				var g = a.head || a.getElementsByTagName("head")[0] || a.documentElement;
				this.aps_adboard_delScript(f, g);
				if (typeof (aps_adboard_outTime) == "function") {
					aps_adboard_outTime(h)
				}
			}
		}
	};
	d.self_apsAdboardGroupObj = c
})(window);


function cpmRequire(obj) {
	Util.getCity(function (cityId) {
		var items = obj.find('[cpmId]'),
			pidArray = [];
	
		items.each(function () {
			pidArray.push($(this).attr('cpmId'));
		});
		var st = 'w', //暂无宽窄屏，统一传宽屏参数
			len = pidArray.length,
			arr = [],
			s = Math.ceil(len / 5);
		for (var i = 0; i < s; i++) {
			arr[i] = [];
			for (var m = 0; m < 5; m++) {
				var n = i * 5 + m;
				if (n < len) {
					arr[i].push(pidArray[n]);
				}
			}
		}
		for (var o = 0; o < s; o++) {
			try {
				self_apsAdboardGroupObj.aps_adboard_loadAdCpmGroup(arr[o], st, null, cityId);
			} catch (e) {
				aps_adboard_errors(arr[o]);
			}
		}
	})
}

//渲染CPM
function aps_adboard_romancecpmGroup(adJsonDatas, pids) {
	if (adJsonDatas == null || pids == null) return;
	var obj;
	try {
		for (var i = 0, s = pids.length; i < s; i++) {
			var prd = adJsonDatas[i],
				srcAttr;
			if (prd && prd.pid) { //返回正常
				if (prd.adSrc_n && prd.adSrc_n != "nil") {
					srcAttr = bigscreen ? prd.adSrc : prd.adSrc_n;
				} else {
					srcAttr = prd.adSrc;
				}

				if (srcAttr.indexOf("http:") == 0) {
					srcAttr = srcAttr.split("http:")[1];
				}


				obj = $('body').find('[cpmId=' + prd.pid + ']');

				obj.attr({
					'href': prd.apsClickUrl
				})
				.find('img').attr({
					'src': srcAttr
				});
				// 小联版需要手动展示下
				if (obj.parents(".four-wrap").length > 0) {
					obj.show();
					lazyelem.listen(obj.find("img[lazy-src]"), "img");
					lazyelem.detect();
				}

				if (obj.parents(".firstScreen").length > 0 && obj.hasClass('big') && $('.firstScreen').attr('data-dacu') != 'true') {
					obj.closest("li").css("background", prd.tone);
				} else if (obj.parents(".top-active").length > 0) {
					obj.parent().css("background", prd.tone);
				} else if (obj.parents(".firstScreen").length > 0 && obj.parent().attr('data-needbg') == 'true') {
					obj.parent().css("background", prd.tone);
				}

			} else { //返回空 
				var anchor = $('body').find('[cpmId="' + pids[i] + '"]'),
					img = anchor.find('img');

				srcAttr = img.attr('d-src');

				anchor.attr({
					'href': anchor.attr('d-href')
				});

				img.attr({
					'src': srcAttr
				});
				// 小联版需要手动展示下
				if (anchor.parents(".four-wrap").length > 0) {
					anchor.show();
					lazyelem.listen(anchor.find("img[lazy-src]"), "img");
					lazyelem.detect();
				}

				if (anchor.parents(".firstScreen").length > 0 && anchor.hasClass('big') && $('.firstScreen').attr('data-dacu') != 'true') {
					var liList = img.closest("li");
					liList.css("background", liList.attr('d-color'));
				} else if (anchor.parents(".top-active").length > 0) {
					var anParent = anchor.parent()
					anParent.css("background", anParent.attr('d-color'));
				} else if (anchor.parents(".firstScreen").length > 0 && anchor.parent().attr('data-needbg') == 'true') {
					var liList = img.closest("li");
					liList.css("background", liList.attr('d-color'));
				}
			}
		}
	} catch (e) {
		throw new Error(e);
	}
}

//超时处理
function aps_adboard_outTime(pids) {
	for (var i = 0, s = pids.length; i < s; i++) {
		var anchor = $('body').find('[cpmId="' + pids[i] + '"]'),
			img = anchor.find('img');

		srcAttr = img.attr('d-src');

		anchor.attr({
			'href': anchor.attr('d-href')
		});

		img.attr({
			'src': srcAttr
		});

		if (anchor.parents(".firstScreen").length > 0 && anchor.hasClass('big') && $('.firstScreen').attr('data-dacu') != 'true') {
			var liList = img.closest("li");
			liList.css("background", liList.attr('d-color'));
		} else if (anchor.parents(".top-active").length > 0) {
			var anParent = anchor.parent()
			anParent.css("background", anParent.attr('d-color'));
		} else {
			anchor.find(".img-name").html(anchor.find(".img-name").attr('d-title')).end()
				.find(".img-desc").html(anchor.find(".img-desc").attr('d-title'));
		}
	}
}
//error处理
function aps_adboard_errors(pids) {
	for (var i = 0, s = pids.length; i < s; i++) {
		var anchor = $('body').find('[cpmId="' + pids[i] + '"]'),
			img = anchor.find('img');

		srcAttr = img.attr('d-src');

		anchor.attr({
			'href': anchor.attr('d-href')
		});

		img.attr({
			'src': srcAttr
		});

		if (anchor.parents(".firstScreen").length > 0 && anchor.hasClass('big') && $('.firstScreen').attr('data-dacu') != 'true') {
			var liList = img.closest("li");
			liList.css("background", liList.attr('d-color'));
		} else if (anchor.parents(".top-active").length > 0) {
			var anParent = anchor.parent()
			anParent.css("background", anParent.attr('d-color'));
		} else {
			anchor.find(".img-name").html(anchor.find(".img-name").attr('d-title')).end()
				.find(".img-desc").html(anchor.find(".img-desc").attr('d-title'));
		}
	}
}

//商品相关方法
var commodity = {
	getUrl: function (data, trickPoint) {
		var srcPoint = "";
		if (data.trickPoint && data.trickPoint.length > 0) {
			srcPoint = "?srcPoint=" + data.trickPoint;
		}
		if (data.linkUrl && data.linkUrl != "") {
			if (data.linkUrl.indexOf("http://") == 0 || data.linkUrl.indexOf("https://") == 0) {
				return data.linkUrl + srcPoint;
			} else {
				return "//" + data.linkUrl + srcPoint;
			}
		} else {
			var type = data.linkType;
			var vendorCode = data.vendorCode;
			var partNumber = data.partNumber;
			var domain = sn.productDomain;
			if (domain.substring(domain.length - 1) != "/") {
				domain = domain + "/";
			}
			if (trickPoint && null != trickPoint) {
				if (vendorCode && vendorCode.length > 0) {
					return domain + vendorCode + "/" + partNumber + ".html?srcPoint=" + trickPoint + "&src=" + trickPoint;
				} else {
					return domain + partNumber + ".html?srcPoint=" + trickPoint + "&src=" + trickPoint;
				}
			} else {
				if (vendorCode && vendorCode.length > 0) {
					return domain + vendorCode + "/" + partNumber + ".html" + srcPoint;
				} else {
					return domain + partNumber + ".html" + srcPoint;
				}
			}
		}
	},
	getSku: function (data) {
		var data_sku = data.partNumber + "|1|";
		var num = "";
		var linkType = data.linkType;
		var vendorCode = data.vendorCode;
		if (linkType && linkType != "1") {
			if (linkType == "2") {
				num = "4|";
			} else if (linkType == "3") {
				num = "5|";
			} else if (linkType == "4") {
				num = "6|";
			} else if (linkType == "5") {
				num = "7|";
			} else if (linkType == "6") {
				num = "8|";
			} else if (linkType == "7") {
				num = "9|";
			}
		} else {
			if (vendorCode && vendorCode != "") {
				if (vendorCode == "0000000000") {
					num = "3|";
				} else {
					num = "2|" + data.vendorCode;
				}
			} else {
				num = "|";
			}
		}

		return 'data-sku="' + data_sku + num + '"';
	}
}

//业务相关逻辑
var index = index || {}

//价格逻辑

index.priceDOM = [];
index.getPriceFlag = false;
index.cuxiaoIndex=0;
index.cuxiaoLabel=[];
window.isScaled = false;

var _hostName = document.location.hostname,
	zsqDomain, codeDomain, pduaDomain, cmsApiDomain,
	msiDomain, custHeadUrl, scriptDomianDir, httpsDomain, ysDomain, tuijianDomain, passportLogonUrl, thDomain, rcrsDomain, rodsDomain, superDomain, pinDomain, dtsDomain, orderDomain, reviewDomain, juDomain, smpDomain, cuxiaoLabelDomain, codeDomain;
index.getenv = function () {
	switch (SFE.base.getEnv()) {
		case 'PRE':
			zsqDomain = '//ju.m.suning.com/';
			codeDomain = '//codepre.cnsuning.com';
			pduaDomain = '//pduapre.cnsuning.com';
			cmsApiDomain = '//libpre.cnsuning.com';
			cmsLibDomain = '//libpre.cnsuning.com';
			msiDomain = '//mypre.cnsuning.com/';
			custHeadUrl = '//uimgpre.cnsuning.com/uimg/cmf/cust_headpic/';
			scriptDomianDir = '//presslres.suning.com/';
			httpsDomain = 'https://sslpre.cnsuning.com/';
			ysDomain = '//nmpspre.cnsuning.com';
			nmqsDomain = '//nmqspre.cnsuning.com';
			// fmDomain = '//fprexg.m.cnsuning.com';
			// tuijianDomain = '//tuijianxgpre.cnsuning.com';
			fmDomain = '//f.m.suning.com';
			tuijianDomain = '//tuijian.suning.com';
			quanDomain = '//quanpre.cnsuning.com/';
			thDomain = '//apscorepre.cnsuning.com';
			rcrsDomain = '//rcrs.suning.com/';
			rodsDomain = '//rods.suning.com/';
			superDomain = '//supervippre.cnsuning.com/';
			dtsDomain = '//dtspre.cnsuning.com/';
			orderDomain = '//orderpre.cnsuning.com/';
			reviewDomain = '//reviewpre.cnsuning.com/';
			juDomain = '//jupre.m.cnsuning.com/';
			smpDomain = '//smppre.cnsuning.com/';
			// cuxiaoLabelDomain = '//xspespre1.cnsuning.com/';
			cuxiaoLabelDomain = '//spes.suning.com/';
			maDomain = '//mpre.cnsuning.com';
			pinDomain = '//pinpre.cnsuning.com';
			passportLogonUrl = "https://passportpre.cnsuning.com/ids/login";
			break;
		case 'PREXG':
			zsqDomain = '//ju.m.suning.com/';
			codeDomain = '//codexgpre.cnsuning.com';
			pduaDomain = '//pduapre.cnsuning.com';
			cmsApiDomain = '//libprexg.cnsuning.com';
			cmsLibDomain = '//libprexg.cnsuning.com';
			msiDomain = '//myprexg.cnsuning.com/';
			custHeadUrl = '//uimgxgpre.cnsuning.com/uimg/cmf/cust_headpic/';
			scriptDomianDir = '//presslres.suning.com/';
			httpsDomain = 'https://sslpre.cnsuning.com/';
			ysDomain = '//nmpspre.cnsuning.com';
			nmqsDomain = '//nmqsprexg.cnsuning.com';
			// fmDomain = '//fprexg.m.cnsuning.com';
			// tuijianDomain = '//tuijianxgpre.cnsuning.com';
			fmDomain = '//f.m.suning.com';
			tuijianDomain = '//tuijian.suning.com';
			quanDomain = '//quanprexg.cnsuning.com/';
			thDomain = '//apscoreprexg.cnsuning.com';
			rcrsDomain = '//rcrs.suning.com/';
			rodsDomain = '//rods.suning.com/';
			superDomain = '//supervipprexg.cnsuning.com/';
			dtsDomain = '//dtsxgpre.cnsuning.com/';
			orderDomain = '//orderprexg.cnsuning.com/';
			reviewDomain = '//reviewxgpre.cnsuning.com/';
			juDomain = '//juprexg.m.cnsuning.com/';
			smpDomain = '//smpprexg.cnsuning.com/';
			// cuxiaoLabelDomain = '//xspespre1.cnsuning.com/';
			cuxiaoLabelDomain = '//spes.suning.com/';
			maDomain = '//mprexg.cnsuning.com';
			pinDomain = '//pinxgpre.cnsuning.com';
			passportLogonUrl = "https://passportprexg.cnsuning.com/ids/login";
			break;
		case 'PRD':
			zsqDomain = '//ju.m.suning.com/';
			codeDomain = '//code.suning.cn';
			pduaDomain = '//pdua.suning.com';
			cmsApiDomain = '//lib.suning.com';
			cmsLibDomain = '//lib.suning.com';
			msiDomain = '//my.suning.com/';
			custHeadUrl = '//image.suning.cn/uimg/cmf/cust_headpic/';
			scriptDomianDir = '//res.suning.cn/';
			httpsDomain = 'https://ssl.suning.com/';
			ysDomain = '//ju.suning.com';
			tuijianDomain = '//tuijian.suning.com';
			nmqsDomain = '//nmqs.suning.com';
			fmDomain = '//f.m.suning.com';
			quanDomain = '//quan.suning.com/';
			thDomain = '//th.suning.com';
			rcrsDomain = '//rcrs.suning.com/';
			rodsDomain = '//rods.suning.com/';
			superDomain = '//supervip.suning.com/';
			dtsDomain = '//dts.suning.com/';
			orderDomain = '//order.suning.com/';
			reviewDomain = '//review.suning.com/';
			juDomain = '//ju.m.suning.com/';
			smpDomain = '//smp.suning.com/';
			cuxiaoLabelDomain = '//spes.suning.com/';
			maDomain = '//m.suning.com';
			pinDomain = '//pin.suning.com';
			passportLogonUrl = "https://passport.suning.com/ids/login";
			break;
		default:
			zsqDomain = '//ju.m.suning.com/';
			codeDomain = '//code.suning.cn';
			pduaDomain = '//pdua.suning.com';
			cmsApiDomain = '//lib.suning.com';
			cmsLibDomain = '//lib.suning.com';
			msiDomain = '//my.suning.com/';
			custHeadUrl = '//image.suning.cn/uimg/cmf/cust_headpic/';
			scriptDomianDir = '//res.suning.cn/';
			httpsDomain = 'https://ssl.suning.com/';
			ysDomain = '//ju.suning.com';
			tuijianDomain = '//tuijian.suning.com';
			nmqsDomain = '//nmqs.suning.com';
			fmDomain = '//f.msit.cnsuning.com';
			quanDomain = '//quan.suning.com/';
			thDomain = '//th.suning.com';
			rcrsDomain = '//rcrs.suning.com/';
			rodsDomain = '//rods.suning.com/';
			superDomain = '//supervip.suning.com/';
			dtsDomain = '//dts.suning.com/';
			orderDomain = '//order.suning.com/';
			reviewDomain = '//review.suning.com/';
			juDomain = '//ju.m.suning.com/';
			smpDomain = '//smp.suning.com/';
			cuxiaoLabelDomain = '//spes.suning.com/';
			maDomain = '//m.suning.com';
			pinDomain = '//pin.suning.com';
			passportLogonUrl = "https://passport.suning.com/ids/login";

	}


	window.passport_config = window.passport_config || {
		base: httpsDomain + 'webapp/wcs/stores/',
		loginTheme: "b2c_pop",
		successCallbackUrl: httpsDomain + '/webapp/wcs/stores/servlet/popupLoginSuccess?storeId=10052&catalogId=10051&'
	};

}

index.getpricecallback = function (data) {
	for (var i = 0; i < data.length; i++) {
		if (data[i]) {			
			var price = 0;

			var refPrice = 0;

			var snPrice = 0;

			var obj = index.priceDOM[0];
			if (obj.parents('.new-rec-tab').length > 0) {
				var item = data[i];
				try {
					genStr(item)
				} catch (error) {
					
				}
				function genStr(priceItem){
					var productType = obj.attr('data-shoptype'),
						priceType = priceItem.pricetype,
						supplierCode = obj.attr('data-productspecialflag'),
						price = priceItem.price;
					if (productType == '0') {
						productType = '0';
						supplierCode = '';
					} else if (productType == '5') {
						productType = '5';
					} else if (productType == '6') {
						productType = '1';
					}

					var priceList = ['4-1', '4-2', '4-3', '4-4', '4-5', '4-6', '4-7', '4-8', '4-10', '4-12', '4-14', '4-15', '4-32', '6-1', '6-2', '6-3', '6-4', '6-5', '6-32', '7-1', '7-2', '7-3', '7-4', '7-5', '7-6', '8-1', '8-2', '8-3', '8-4', '8-5', '8-6', '8-7', '12-1', '12-2', '13-1', '13-2', '13-3', '14', '15', '16', '17']

					if ($.inArray(priceType, priceList) < 0) {
						priceType = 0
					}

					var string = item.cmmdtyCode + '**' + productType + '*' + priceType + '***' + supplierCode + '*' + price + '****';
					index.labelAjax(obj,string,true)
				}
				
			}

			if (data[i].price) {
				// 挂牌价
				price = data[i].price;
			}

			if (data[i].refPrice) {
				refPrice = data[i].refPrice;
			}

			if (data[i].snPrice) {
				// 易购价
				snPrice = data[i].snPrice;

			}

			if (parseFloat(refPrice) != 0 || parseFloat(snPrice) != 0) {

				if (parseFloat(snPrice) < parseFloat(refPrice)) {
					snPrice = refPrice;
				}

				if (parseFloat(snPrice) <= parseFloat(price)) {
					obj.find(".refprice").html('');
				} else {
					obj.find(".refprice").html('<i>&yen;</i><em>' + snPrice + '</em>');
				}


			} else {
				obj.find(".refprice").html('');
			}

			if (/^[\u4e00-\u9fa5]+$/i.test(price)) {
				if (obj.parents('.phb-module').length > 0) {
					obj.find(".price").html('<i>&yen;</i>' + price);
				} else {
					if (obj.parents('.new-two-dj').length > 0 || obj.parents('.new-two-ms').length > 0 || obj.parents('.new-rec-tab').length > 0 ) {
						var ariaLabel = obj.attr('title') && obj.attr('title') != '' ? obj.attr('title'):'',
							name = obj.find('.name') && obj.find('.name').length > 0 ? obj.find('.name').text() : obj.find('.title').text();
						ariaLabel += name + ' ' + Number(price) + '元';
						obj.find('a').attr({
							'title': ariaLabel,
							'aria-label': ariaLabel,
							'tab-index' : '-1'
						})
					} else if (obj.parents('.newUser-floor').length > 0) {
						var ariaLabel = obj.attr('title') && obj.attr('title') != '' ? obj.attr('title') : '',
							name = obj.find('.pro-title') && obj.find('.pro-title').text();
						ariaLabel += name + ' 新人价 ' + Number(price) + '元';
						obj.find('a').attr({
							'title': ariaLabel,
							'aria-label': ariaLabel
						})
					}
					obj.find(".price").html('<i>&yen;</i><em>' + price + '</em>');
				}
			} else {
				if (parseFloat(price) <= 0) {
					if (obj.parents('.nine-floor').length == 0 || obj.attr('data-tj') != 'true') {
						obj.find(".price").css('color','#ccc').html('售罄').prev('.tag').hide();
						if (obj.parents('.new-two-dj').length > 0 || obj.parents('.new-two-ms').length > 0 || obj.parents('.new-rec-tab').length > 0 ) {
							var ariaLabel = obj.attr('title') && obj.attr('title') != '' ? obj.attr('title') : '',
								name = obj.find('.name') && obj.find('.name').length > 0 ? obj.find('.name').text() : obj.find('.title').text();
							ariaLabel += name + ' ' + '售罄';
							obj.find('a').attr({
								'title': ariaLabel,
								'aria-label': ariaLabel,
							'tab-index' : '-1'
							})
						} else if (obj.parents('.newUser-floor').length > 0) {
							var ariaLabel = obj.attr('title') && obj.attr('title') != '' ? obj.attr('title') : '',
								name = obj.find('.pro-title') && obj.find('.pro-title').text();
							ariaLabel += name + ' ' + '售罄';
							obj.find('a').attr({
								'title': ariaLabel,
								'aria-label': ariaLabel,
							'tab-index' : '-1'
							})
						}
					}
					obj.find(".sn-price").html();
				} else {
					if (obj.parents('.phb-module').length > 0) {

						var priceDom = price.indexOf('.') != -1 ? price.split('.')[0] + '<em>.' + price.split('.')[1] + '</em>' : price + '<em>.00</em>';
						obj.find(".price").html('<i>&yen;</i>' + priceDom);

					} else {
						if (obj.parents('.new-two-dj').length > 0 || obj.parents('.new-two-ms').length > 0 || obj.parents('.new-rec-tab').length > 0 ) {
							var ariaLabel = obj.attr('title') && obj.attr('title') != '' ? obj.attr('title') : '',
								name = obj.find('.name') && obj.find('.name').length > 0 ? obj.find('.name').text() : obj.find('.title').text();
							ariaLabel += name + ' ' + Number(price) + '元';
							obj.find('a').attr({
								'title': ariaLabel,
								'aria-label': ariaLabel
							})
						} else if (obj.parents('.newUser-floor').length > 0) {
							var ariaLabel = obj.attr('title') && obj.attr('title') != '' ? obj.attr('title') : '',
								name = obj.find('.pro-title') && obj.find('.pro-title').text();
							ariaLabel += name + ' 新人价 ' + Number(price) + '元';
							obj.find('a').attr({
								'title': ariaLabel,
								'aria-label': ariaLabel,
							'tab-index' : '-1'
							})
						}
						obj.find(".price").html('<i>&yen;</i><em>' + price + '</em>');
					}
				}
			}

		} else {
			// 无价格
			if (obj.parents('.nine-floor').length == 0 || obj.attr('data-tj') != 'true') {
				obj.find(".price").html('售罄').prev('.tag').hide();
				if (obj.parents('.new-two-dj').length > 0 || obj.parents('.new-two-ms').length > 0 || obj.parents('.new-rec-tab').length > 0 ) {
					var ariaLabel = obj.attr('title') && obj.attr('title') != '' ? obj.attr('title') : '',
						name = obj.find('.name') && obj.find('.name').length > 0 ? obj.find('.name').text() : obj.find('.title').text();
					ariaLabel += name + ' ' + '售罄';
					obj.find('a').attr({
						'title': ariaLabel,
						'aria-label': ariaLabel
					})
				} else if (obj.parents('.newUser-floor').length > 0) {
					var ariaLabel = obj.attr('title') && obj.attr('title') != '' ? obj.attr('title') : '',
						name = obj.find('.pro-title') && obj.find('.pro-title').text();
					ariaLabel += name + ' ' + '售罄';
					obj.find('a').attr({
						'title': ariaLabel,
						'aria-label': ariaLabel,
							'tab-index' : '-1'
					})
				}
			}
			obj.find(".sn-price").html();
			obj.find(".ref-price").hide();
		}
		index.priceDOM.shift();
	}
	if (index.priceDOM.length > 0) {
		GetPrice.queryprice(index.priceDOM, "1", index.getpricecallback);
	} else {
		index.getPriceFlag = false;
	}
};

index.JsonParse = function (str) {
	if (typeof JSON == 'object') {
		return JSON.parse(str);
	} else {
		var json = eval('(' + str + ')');
		return json;
	}
}

//楼层获取cms备份数据
index.getCMSHtml = function (pageCode, key, successCb, failCb, flag) {
	var backHost = window.location.host;
	var url = '',
		callback;
	callback = 'lazyload' + key + flag;
	if (sn.isBack && ('true' == sn.isBack)) {
		url = 'http://' + backHost + '/cms-admin-web/page/previewModel/' + pageCode + '_' + key + '_' + previewTimes + '_' + callback + '.htm';
	} else {
		url = sn.cmsLibDomain + '/homepage/model/' + pageCode + '_' + key + '_' + callback + '.json';
	}

	$.ajax({
		url: url,
		cache: false,
		dataType: 'jsonp',
		jsonpCallback: callback,
		success: function (data) {
			successCb(data);
		},
		error: function () {
			failCb();
		}
	})

}

//获取用户信息
index.cookieGet = function () {
	var nowU = Util.getCookie('custno');

	if (typeof nowU != undefined && nowU) {
		index.uID = nowU;
	}
	index.uID = index.uID ? index.uID : '';

	var nowC = Util.getCookie('_snma');

	if (typeof nowC != undefined && nowC) {
		index.cID = nowC.split("|")[1];
	}
	index.cID = index.cID ? index.cID : '';

}

index.isInScreen = function (obj) {
	var box = obj;
	if (box.length > 0) {
		return ($(window).scrollTop() + $(window).height() > box.offset().top) && box.offset().top + box.height() > $(window).scrollTop();
	}
};

index.getFloorNum = function () {
	var floor = $(".floor");
	var len = floor.length;
	for (var i = 0; i < len; i++) {
		floor.eq(i).addClass("J-floor" + (i + 1));
	}
}

index.floatbar = function () {
	if ($("#indexFloat").length == 0 || $(".floor").length == 0) {
		return;
	}

	if (screen.width <= 1200) {
		Util.floatBar({
			zIndex: 1000,
			contents: $("#indexFloat"),
			align: "center",
			vertical: "middle",
			css: {
				"margin-left": '-570px'
			}
		});
	} else {
		Util.floatBar({
			zIndex: 1000,
			contents: $("#indexFloat"),
			align: "center",
			vertical: "middle",
			css: {
				"margin-left": '-670px'
			}
		});
	}

	index.getFloorNum();
	var box = $('.ECode-floatBar');

	function show() {
		var topHide = parseInt($(document).scrollTop()),
			firstTop = $('.floor:first').offset().top,
			footer = $('.ng-footer').offset().top;
		//1200换成firstTop可定位到第一个楼层滑动到再展示
		if (topHide + $(window).height() > 1200 && footer > (topHide + $(window).height() - 200)) {
			box.stop(true, true).fadeIn(500);
		} else {
			box.stop(true, true).fadeOut(500);
		}
	}


	show();

	$(window).bind('scroll resize', function () {
		show();
	});

	index.floorGuide();

}

//楼层导航
index.floorGuide = function () {
	var $obj = $('.floatbar'),
		$objItem = $obj.find('li'),
		objTop, docTop, docLeft,
		goTop = $('#goTop'),
		flag = true;
	goTop.click(function () {
		flag = false;
		$('html, body').stop(true).animate({
			'scrollTop': 0
		}, 'fast', function () {
			flag = true;
		});
	});
	if ($obj.length == 0) return;
	$objItem.click(function () {
		flag = false;
		var moveCls = '.' + $(this).attr('rel');
		if ($(moveCls).length == 0) return;
		$(this).addClass('on').siblings().removeClass('on');
		$('html, body').stop(true).animate({
			'scrollTop': $(moveCls).offset().top - 70
		}, 'fast', function () {
			flag = true;
		});
	});

	$objItem.hover(function () {
		$(this).addClass('hover');
	}, function () {
		$(this).removeClass('hover');
	});

	function getFloorTop(number) {
		var cls = $('.floor').eq(number - 1);
		if (cls.length > 0) {
			return cls.offset().top - $(document).scrollTop();
		}
	}

	function init() {
		var len = $objItem.length;
		if (getFloorTop(1) <= 0) {
			for (var i = 2; i <= len; i++) {
				if (getFloorTop(i) > 0) {
					$objItem.eq(i - 1).addClass('on').siblings().removeClass('on');
					return;
				}
			}
			$objItem.eq(len - 1).addClass('on').siblings().removeClass('on');
		} else {
			$objItem.removeClass('on').eq(0).addClass('on');
		}
	}

	init();
	$(window).scroll(function () {
		if (flag) {
			init();
		}
	});
};

//目录
index.nav = function () {
	var delay1;

	var threeDataReady = false;

	var listWrapper = $('.dacu-list-wrapper'),
		sortListBox = $('.index-sort-list-box'),
		sortBoxDetail = $('.index-sort-detail');
		
	$(".index-sort-list-box").mouseover(function () {
		SFE.search.clearBox()
		clearTimeout(delay1);
		delay1 = setTimeout(function () {
			loadThreeSort();
		}, 100);
	});

	function loadThreeSort() {

		var modern = isLocalStorageSupported(),
			key = 'indexnav';
		if (!threeDataReady) {
			if (modern && localStorage.getItem(key)) {
				localDate = JSON.parse(localStorage.getItem(key));
				storeTime = parseInt(localDate.time) + 30 * 60 * 1000;
				var nowDate = new Date().getTime();

				if (nowDate > storeTime) {
					$.ajax({
						url: cmsApiDomain + "/api/jsonp/cb/sortList_v6-threeSortLoad.jsonp",
						type: "get",
						dataType: "jsonp",
						jsonp: 'callback',
						jsonpCallback: "threeSortLoad",
						cache: true,
						success: function (data) {

							if (data && data.allsort && data.allsort.nodes) {
								threeData = data.allsort.nodes;
								threeDataReady = true;
								if (modern) {
									var content = data.allsort.nodes;
									localStorage.setItem(key, JSON.stringify({
										'time': new Date().getTime(),
										'navContent': content
									}));
								}
							}

						}
					});
				} else {
					threeData = localDate.navContent;
					threeDataReady = true;
				}

			} else {
				$.ajax({
					url: cmsApiDomain + "/api/jsonp/cb/sortList_v6-threeSortLoad.jsonp",
					type: "get",
					dataType: "jsonp",
					jsonp: 'callback',
					jsonpCallback: "threeSortLoad",
					cache: true,
					success: function (data) {

						if (data && data.allsort && data.allsort.nodes) {
							threeData = data.allsort.nodes;
							threeDataReady = true;
							if (modern) {
								var content = data.allsort.nodes;
								localStorage.setItem(key, JSON.stringify({
									'time': new Date().getTime(),
									'navContent': content
								}));
							}
						}

					}
				});
			}

		}
	}


	//大促tab切
	$('.dacu-tab a').hover(function () {

		var the = $(this),
			index = the.index(),
			list = $('.dacu-list-wrapper .dacu-list-tab');

		the.addClass('dacu-btn-cur').siblings().removeClass('dacu-btn-cur');

		list.eq(index).show().siblings().hide();

		lazyelem.detect();

	}, function () {

	});

	function delayT() {
		var sx, sy; //鼠标进入类目的点
		var ex, ey; //鼠标离开类目的点
		var flag = 0; //标记  1切 0延时切
		sortListBox.find('li').live({
			mouseenter: function (e) {
				sx = e.pageX, sy = e.pageY;
				flag == 1 ? delay = 0 : delay = 200;
			},
			mouseleave: function (e) {
				ex = e.pageX, ey = e.pageY;
				if (ex <= sx + 5) { //鼠标左上/左下移动 切
					Math.abs(ey - sy) <= 28 ? flag = 0 : flag = 1;
				} else {
					flag = 0;
				}
			}
		});
		sortListBox.live('mouseleave', function () {
			flag = 0;
		});
	}
	delayT();

	var timer = null;

	var cateBox = $('.index-sort-detail');

	function changeColor(color){
		$('.index-sort-detail .sort-btn a').css('background', color)
		$('.index-sort-detail dd a.orange').css('color', color)
	}

	//ipad下兼容
	if (!Util.isiPad()) {
		sortListBox.find('li').live({
			mouseenter: function () {
				var _a = $(this);
				var color = _a.attr('data-color') && _a.attr('data-color')!=''?_a.attr('data-color'):'#f80';
				clearTimeout(timer);
				timer = setTimeout(function () {
					_a.addClass('current').siblings('li').removeClass('current');
					var _index = _a.index();
					insertDetail(_index);
					// var bigscreen = (screen.width>=1200) ?true : false;

					sortBoxDetail.addClass('index-sort-detail-border');

					changeColor(color);

					if (bigscreen) {
						sortBoxDetail.css('width', 989);
					} else {
						sortBoxDetail.css('width', 798);
					}

				}, delay);
			},
			mouseleave: function () {
				clearTimeout(timer);
			}
		});

		var timer2;
		sortListBox.hover(function () {
			clearTimeout(timer2);
		}, function () {

			clearTimeout(timer2);
			timer2 = setTimeout(function () {
				hideDetail();
			}, 200);
		});


	} else {

		sortListBox.find('li').on('click', function () {
			liClasssChange($(this));
		});


		function liClasssChange(item) {

			var _a = item;
			_a.addClass('current').siblings('li').removeClass('current');
			var _index = _a.index();
			insertDetail(_index);

			sortBoxDetail.addClass('index-sort-detail-border');

			if (bigscreen) {
				sortBoxDetail.css('width', 989);
			} else {
				sortBoxDetail.css('width', 798);
			}

		}


		sortListBox.find('li a').on('click', function (e) {
			var the = $(this),
				par = the.parent();

			if (!par.hasClass('current')) {
				liClasssChange(par)
				return false;
			}

		});


		$('body').on('touchstart', function () {
			hideDetail();
		})
		$('.index-sort-list-box').on('touchstart', function (e) {
			e.stopPropagation();
		})



	}


	var isFixed,
		allSort = $('.index-sort');

	$(window).scroll(function () {
		showFixed();
	})


	var timer3;
	allSort.hover(function () {
		if (isFixed) {
			clearTimeout(timer3);
			timer3 = setTimeout(function () {
				listWrapper.slideDown();
			}, 200);
		}
	}, function () {
		if (isFixed) {
			clearTimeout(timer3);
			timer3 = setTimeout(function () {
				$('.index-sort-detail').animate({
					'width': '0px'
				}, 100, function () {
					listWrapper.hide();
					$('.index-sort-detail').removeClass('index-sort-detail-border');
				});
			}, 200);
		}
	});


	var allSortHeight = allSort.height();
	var h = $('.ng-nav-bar').offset().top;
	var fixbar = $('.ng-fix-bar');
	var fixbarT;

	function showFixed() {
		var st = $(window).scrollTop();
		var WH = $(window).height();
		var fixbarTindexH = 600; //首页顶部冻结延后出现
		isFixed == false ? fixbarT = h + allSortHeight + fixbarTindexH : '';
		st > fixbarT ? FixBarShow() : FixBarHide();
		st > fixbarT ? isFixed = true : isFixed = false;

		if (st <= fixbarT) {
			FixBarHide();
			isFixed = false;
		}
	}

	function FixBarShow() {
		// allSort.find('.index-sort-list-box').hide();
		allSort.find('.dacu-list-wrapper').hide();
		fixbar.fadeIn(0);
		allSort.addClass('ng-sort-fixed');
		allSort.removeClass('ng-sort-index');
		// smallScreen?'':allSort.find('.ng-sort-list-box').hide();
		$('.ng-bar-node-mini-cart').addClass('ng-bar-node-mini-cart-fixed');
		$(".cart-child").addClass("ng-bar-node-mini-cart-child-fixed");
		$('.reg-bar-node , #username-node-slide ,#username-node').addClass('reg-bar-node-fixed');
		$('.ng-search').find('.g-search').addClass('g-search-fixed');
		$('.ng-nav-bar').addClass('ng-nav-bar-fixed');
		$('.ng-nav-index').hide();
	}

	function FixBarHide() {
		// allSort.find('.index-sort-list-box').show();
		allSort.find('.dacu-list-wrapper').show();
		allSort.addClass('ng-sort-index');
		allSort.removeClass('ng-sort-fixed');
		allSort.find('.ng-sort-list-box').show(); //只有首页的时候执行
		$('.ng-bar-node-mini-cart').removeClass('ng-bar-node-mini-cart-fixed');
		$(".cart-child").removeClass("ng-bar-node-mini-cart-child-fixed");
		$('.reg-bar-node , #username-node-slide ,#username-node').removeClass('reg-bar-node-fixed');
		$('.ng-search').find('.g-search').removeClass('g-search-fixed');
		$('.ng-nav-bar').removeClass('ng-nav-bar-fixed');
		$('.ng-nav-index').show();
		fixbar.fadeOut(100);
	}


	function insertDetail(_index) {
		var st = $(this).scrollTop();
		var sbT = sortListBox.offset().top;
		if (sn.isHome) {
			if (st > (sbT + 40)) {
				sortBoxDetail.animate({
					'top': st - sbT
				}, 100);
			} else {
				sortBoxDetail.animate({
					'top': 0
				}, 100);
			}
		}
		var _subHtml = "",
			bqHtml = '',
			navHtml = '',
			imgHtml = '',
			sortHeml = '';

			cateBox.html(' ');
			cateBox.attr('sap-modid', $('.index-list').find('li').eq(_index).attr('sap-modid2'));

		if (threeDataReady && typeof threeData != "undefined") {

			if (!threeData[_index] || !threeData[_index].nodes) {
				return;
			}
			var cityId = d("cityId") || "9173",
				_dataS = threeData[_index],
				data = threeData[_index],
				item, list, lmg, show,
				datalen = data.nodes.length;

			var _dataS = threeData[_index];
			//标签结构
			if (data.nodes[1]) {

				bqHtml += '<div class="sort-btn">';

				if (data.nodes[1].tag) {
					for (var i = 0; i < data.nodes[1].tag.length; i++) {

						item = data.nodes[1].tag[i];
						bqHtml += '<a tabindex="-1" href="' + item.linkUrl + '" target="_blank" name="' + item.trickPoint + '" title="' + item.elementName + '">' + item.elementName + '</a>';

					}
				}
				bqHtml += '</div>';
			}

			navHtml += '<div class="cate-list">';

			for (var i = 4; i < datalen; i++) {

				if (data.nodes[i] && data.nodes[i].tag && data.nodes[i].nodes) {
					navHtml += '<dl>';
					list = data.nodes[i].nodes;
					navHtml += '<dt><a tabindex="-1" href="' + data.nodes[i].tag[0].linkUrl + '" target="_blank" title="' + data.nodes[i].tag[0].elementName + '" name="' + data.nodes[i].tag[0].trickPoint + '">' + data.nodes[i].tag[0].elementName + '</a></dt>';

					if (list[0].tag) {
						if (i == 2) {
							navHtml += '<dd class="first">';
						} else {
							navHtml += '<dd>';
						}

						for (var j = 0; j < list[0].tag.length; j++) {
							if (list[0].tag[j].elementDesc == "orange") {
								navHtml += '<a tabindex="-1" href="' + list[0].tag[j].linkUrl + '" target="_blank" name="' + list[0].tag[j].trickPoint + '" title="' + list[0].tag[j].elementName + '" class="orange">' + list[0].tag[j].elementName + '</a>';
							} else {
								navHtml += '<a tabindex="-1" href="' + list[0].tag[j].linkUrl + '" target="_blank" name="' + list[0].tag[j].trickPoint + '" title="' + list[0].tag[j].elementName + '">' + list[0].tag[j].elementName + '</a>';
							}

						}
					}
					navHtml += '</dd>';

					navHtml += '</dl>';

				}

			}
			navHtml += '</div>';

			//右侧广告图片 
			if (sn.isNewHome) {
				imgHtml += '<div class="actShow">';

				if (data.nodes[2]) {
					imgHtml += '<div class="brandList clearfix">';
					img = data.nodes[2].tag;
					if (img) {
						for (var i = 0; i < img.length; i++) {
							picUrl = sn.imgHost + img[i].picUrl;
							imgHtml += '<a tabindex="-1" href="' + img[i].linkUrl + '" data-src="' + img[i].elementName + '" name="' + img[i].trickPoint + '" target="_blank"><img lazy-src="' + picUrl + '" src="//res.suning.cn/public/v3/images/blank.gif"></a>';
						}
					}

					imgHtml += '</div>';
				}

				if (data.nodes[3]) {

					imgHtml += '<div class="actList clearfix">';
					show = data.nodes[3].tag;
					if (show) {
						for (var i = 0; i < show.length; i++) {
							picUrl = sn.imgHost + show[i].picUrl;
							if (show[i].advistismentCode) {
								imgHtml += '<a tabindex="-1" d-href="' + show[i].linkUrl + '" d-title="' + show[i].elementName + '" d-name="' + show[i].trickPoint + '" target="_blank" cpmId="' + show[i].advistismentCode + '"><img d-src="' + sn.imgHost + show[i].picUrl + '" d-alt="' + show[i].elementDesc + '"></a>';
							} else {
								imgHtml += '<a tabindex="-1" href="' + show[i].linkUrl + '" title="' + show[i].elementName + '" name="' + show[i].trickPoint + '" target="_blank"><img lazy-src="' + sn.imgHost + show[i].picUrl + '" src="//res.suning.cn/public/v3/images/blank.gif"></a>';
							}
						}
					}


					imgHtml += '</div>'

				}

				imgHtml += '</div>';
			}

			_subHtml = bqHtml + navHtml + imgHtml;

			cateBox.html(_subHtml);

			lazyelem.listen(cateBox.find("img[lazy-src]"), "img");
			lazyelem.detect();

			cpmRequire(cateBox);

		} else {
			setTimeout(function () {
				insertDetail(_index);
			}, 300)
		}
	}

	function hideDetail() {
		sortBoxDetail.stop(true, true).animate({
			'width': '0px'
		}, 100, function () {
			sortListBox.find('li').removeClass('current');
			$(this).removeClass('index-sort-detail-border');
		});
	};
}

//千变banner
index.recBanner = function () {

	lazyelem.listen('.rec-banner', 'fn', function (obj) {
		Util.getCity(function (cityId) {
			$.ajax({
				url: fmDomain + '/api/cu/getNewBan.do?u=' + index.uID + '&c=' + index.cID + '&sceneIds=16-63&cityId=' + cityId + '&count=3&pageCode=cateBannerpc',
				type: "GET",
				cache: true,
				dataType: "jsonp",
				timeout: 5000,
				jsonpCallback: "recommendBanner",
				error: function () {
					getCmsHtml();
				},
				success: function (data) {

					if (data && data.data && data.data.length > 2) {
						getHtml(data.data);
					} else {
						getCmsHtml();
					}

				}
			});
		});

		function getHtml(data) {

			var dom = '',
				item, jumpUrl, trickPoint, id;

			var hcParameter = $(obj).attr('data-shopId');

			for (var i = 0; i < 3; i++) {

				item = data[i];

				jumpUrl = item.jumpUrl;

				trickPoint = 'index3_none_recpctmt_1-' + (i + 1) + '_p_' + item.vendorId + '_' + item.sugGoodsCode + '_' + item.handwork;
				id = 'baoguang_recpctmt_1-' + (i + 1) + '_' + item.vendorId + '_' + item.sugGoodsCode + '_' + item.handwork;

				dom += '<li class="item' + (i + 1) + '">' +
					'<a href="//cuxiao.suning.com/recommendpc.html?labelCode=' + item.labelCode + '&vendorId=' + item.vendorId + '&productCode=' + item.sugGoodsCode + '&shopCode=&title=' + encodeURIComponent(item.zTitle) + '&pictureUrl=' + encodeURIComponent(item.pictureUrl) + '&shopId=' + hcParameter + '&src=' + trickPoint + '" target="_blank" name="' + trickPoint + '" id="' + id + '">' +
					'<img src="' + sn.imgHost + item.bannerPic + '" alt="" class="bg-pic">' +
					'<img src="//oss.suning.com/IVMS/banner/' + item.vendorId + '-' + item.sugGoodsCode + '_2.png?ver=' + item.picVersion + '" alt="" class="com-pic">' +
					'<p class="name" style="color:' + item.zColor + '">' + item.zTitle + '</p>' +
					'<p class="desc" style="color:' + item.fColor + '">' + item.fTitle + '</p>' +
					'</a>' +
					'</li>';

			}

			$(obj).find('ul').html(dom);

			Util.baoguangFun('baoguang_recpctmt');

		};

		function getCmsHtml() {

			var pageCode = $("body").attr("data-pageCode"),
				key = $(".rec-banner").attr("data-fullId"),
				floorContent;

			index.getCMSHtml(pageCode, key, function (data) {

				var nowTime = new Date().getTime();

				floorContent = data.data;

				$('.rec-banner ul').html(floorContent);

				if ($(".rec-banner ul li").size() < 3) {
					$(".rec-banner").hide();
				}
				index.getwebp('.rec-banner ul')
				lazyelem.listen($(".rec-banner ul").find("img[lazy-src]"), "img");
				lazyelem.listen($(".rec-banner ul").find("[cms-name]"), 'fn', function (obj) {

					index.cmsBgDom.push(obj);

					if (index.cmsBgFlag) {
						return;
					}
					index.cmsBgFlag = true;

					setTimeout(function () {
						index.cmsBgFunc(index.cmsBgDom);
					}, 100)

				});

			}, function () {

				$(".rec-banner").hide();

			})

		};

	});

}

index.dacuTj = function (obj) {

	lazyelem.listen(".dacu-tuijian", "fn", function (obj) {

		var $list = $(obj).find(".content ul"),
			count = 10;

		if ($(obj).attr('data-tuijian') == 'true') {
			Util.getCity(function (cityId) {
				// sn.cityId = cityId;

				$.ajax({
					url: tuijianDomain + '/recommend-portal/recommend/paramsBiz.jsonp?u=' + index.uID + '&c=' + index.cID + '&parameter=A0002&snTerminal=284000002001&cityId=' + cityId + '&sceneIds=16-40&count=' + count,
					type: "GET",
					cache: true,
					dataType: "jsonp",
					timeout: 5000,
					jsonpCallback: "dacuTJCb" + count,
					error: function () {
						getCmsData();
						lazyelem.listen($list.find("img[lazy-src]"));
					},
					success: function (data) {
						if (data && data.sugGoods) {
							var sug = data.sugGoods[0];

							if (sug.resCode != '02' && sug.skus && sug.skus.length >= 5) {
								var skuList = sug.skus,
									length = sug.skus.length - sug.skus.length % 5,
									dom = '',
									tuijianimgUrl;
								name,
								id;

								for (var i = 0; i < length; i++) {

									tuijianimgUrl = skuList[i].labelPic;

									if (tuijianimgUrl.indexOf("http:") == 0) {
										tuijianimgUrl = tuijianimgUrl.split("http:")[1];
									}

									name = 'index3_' + skuList[i].labelCode + '_recpllc_1-' + (i + 1) + '_p_' + skuList[i].list[0].shopId + '_' + skuList[i].list[0].sugGoodsCode + '_' + skuList[i].handwork;
									id = 'baoguang_recpllc_1-' + (i + 1) + '_' + skuList[i].list[0].shopId + '_' + skuList[i].list[0].sugGoodsCode + '_' + skuList[i].handwork;
									var saData = Util.json2String({
										'prdid': kuList[i].list[0].sugGoodsCode,
										'shopid': kuList[i].list[0].shopId,
										'recvalue': kuList[i].handwork
									}).replace(/"/g, "'")

									dom += '<li><a sa-data="' + saData + '" href="' + skuList[i].jumpUrl + '?src=' + name + '" target="_blank" name="' + name + '" id="' + id + '"><img lazy-src="' + tuijianimgUrl + '" src="//res.suning.cn/public/v3/images/blank.gif"></a></li>'
								}
								$list.html(dom)

							} else {
								getCmsData();
							}

						} else {
							getCmsData();
						}
						index.getwebp(obj)

						lazyelem.listen($list.find("img[lazy-src]"));
					}
				});
			});
		} else {
			getCmsData();
		}




		function getCmsData() {

			var pageCode = $("body").attr("data-pageCode"),
				key = $(".dacu-tuijian").attr("data-fullId"),
				// url = sn.cmsLibDomain + '/homepage/model/' + pageCode +'_' + key + '_lazyload.json',
				floorContent;


			index.getCMSHtml(pageCode, key, function (data) {

				var nowTime = new Date().getTime();

				floorContent = data.data;

				$('.dacu-tuijian ul').html(floorContent);

				if ($(".dacu-tuijian ul li").size() < 5) {
					$(".dacu-tuijian").hide();
				}

				index.getwebp(obj)
				lazyelem.listen($(".dacu-tuijian ul").find("img[lazy-src]"), "img");
				lazyelem.listen($(".dacu-tuijian ul").find("[cms-name]"), 'fn', function (obj) {

					index.cmsBgDom.push(obj);

					if (index.cmsBgFlag) {
						return;
					}
					index.cmsBgFlag = true;

					setTimeout(function () {
						index.cmsBgFunc(index.cmsBgDom);
					}, 100)

				});

			}, function () {

				$(".dacu-tuijian").hide();

			})

		}

	});


};

index.topActive = function () {
	var box = $('#__TOP_ACTIVE__'),
		wrap = box.find('.top-active-wrap'),
		img = wrap.find('img'),
		height = parseInt(wrap.attr('data-height')),
		btn = box.find('.btn'),
		cookieFlag = true;
	box.on('click', '.btn', function () {
		var _this = $(this);
		if (!_this.hasClass('btn-open')) {
			btn.removeClass('btn-close').addClass('btn-open').attr({
				'title': '打开',
				'name': '打开埋点值'
			});
			if (height > 0) {
				wrap.stop(true).animate({
					"height": 0
				}, 200);
			} else {
				wrap.hide();
			}
		} else {
			btn.removeClass('btn-open').addClass('btn-close').attr({
				'title': '关闭',
				'name': '关闭埋点值'
			});
			if (height > 0) {
				wrap.stop(true).animate({
					"height": height
				}, 200);
			} else {
				wrap.show().css('height', 'auto');
			}
		}

		//写cookie，保存时间为12小时
		var exp = new Date();
		exp.setTime(exp.getTime() + 12 * 60 * 60 * 1000);

		if (cookieFlag) {
			cookieFlag = false;
			document.cookie = "topActiveStatus=true;expires=" + exp;
		}
	})
};

index.getcpm = function () {

	lazyelem.listen('.floor', 'fn', function (obj) {
		if ($(obj).hasClass('com-floor')) {
			return;
		}
		cpmRequire(obj);

		if ($(obj).find('a').attr("cptId")) {
			pid = $(obj).find('a').attr("cptId");
			if (pid) {
				try {
					apsAdboardCptPvObj.aps_adboard_loadAdCptPv(pid, index.cptTime);
				} catch (e) {}
			}
		}

	});

	lazyelem.listen('.middle-floor', 'fn', function (obj) {
		cpmRequire(obj);
		if ($(obj).find('a').attr("cptId")) {
			pid = $(obj).find('a').attr("cptId");
			if (pid) {
				try {
					apsAdboardCptPvObj.aps_adboard_loadAdCptPv(pid, index.cptTime);
				} catch (e) {}
			}
		}
	});

}

function isLocalStorageSupported() {
	var testKey = 'test',
		storage = window.localStorage;
	if (Util.ieVersion(7) || Util.ieVersion(6) || typeof JSON == 'undefined') {
		return false;
	}
	try {
		storage.setItem(testKey, 'testValue');
		storage.removeItem(testKey);
		return true;
	} catch (error) {
		return false;
	}
}

index.lazyFloor = function () {

	lazyelem.listen('.com-floor', 'fn', function (obj) {

		var pageCode = $("body").attr("data-pageCode"),
			key = $(obj).attr("data-fullId"), //存储关键字key
			callback = "lazyload" + key;

		var backHost = window.location.host;
		var url = '';
		if (sn.isBack && ('true' == sn.isBack)) {
			url = 'http://' + backHost + '/cms-admin-web/page/previewModel/' + pageCode + '_' + key + '_' + previewTimes + '_' + callback + '.htm';
		} else {
			url = sn.cmsLibDomain + '/homepage/model/' + pageCode + '_' + key + '_' + callback + '.json';
		}


		var modern = isLocalStorageSupported(),
			localDate,
			floorContent;
		key = "floorId" + key;



		//存在localstorage的情况
		if (modern && localStorage.getItem(key) && !sn.isBack) {
			// if(modern && localStorage.getItem(key)){
			localDate = JSON.parse(localStorage.getItem(key));
			storeTime = parseInt(localDate.time) + 10 * 60 * 1000;
			var nowDate = new Date().getTime();

			//缓存过期（本地缓存时间为30min）
			if (nowDate > storeTime) {
				$.ajax({
					url: url,
					cache: false,
					dataType: 'jsonp',
					jsonpCallback: callback,
					success: function (data) {

						var nowTime = new Date().getTime();

						floorContent = data;

						if (modern) {
							localStorage.setItem(key, JSON.stringify({
								'time': nowTime,
								'floorContent': floorContent
							}));
						}

						getHtml(obj, floorContent);
					}
				});
			} else {
				floorContent = localDate.floorContent;
				getHtml(obj, floorContent);
			}

			//没有localstorage的情况
		} else {

			$.ajax({
				url: url,
				cache: false,
				dataType: 'jsonp',
				jsonpCallback: callback,
				success: function (data) {

					var nowTime = new Date().getTime();

					floorContent = data;

					if (modern) {
						localStorage.setItem(key, JSON.stringify({
							'time': nowTime,
							'floorContent': floorContent
						}));
					}

					getHtml(obj, floorContent);
				}
			});
		}

		//dom操作以及事件绑定
		function getHtml(obj, floorContent) {

			if (!floorContent || !floorContent.data) {
				if (modern && localStorage.getItem(key)) {
					localDate = JSON.parse(localStorage.getItem(key));
					floorContent = localDate.floorContent;

					$(obj).html(floorContent.data);
				} else {
					return;
				}
			} else {
				//填充dom
				$(obj).html(floorContent.data);
			}



			var tjObj = $(obj).hasClass('g-floor') ? $(obj) : $(obj).find('.g-floor'),
				count;


			index.floorCode(obj);

			//cpt广告


			function getCMSHtml(obj) {

				$(obj).find('li').show();
				lazyelem.listen($(obj).find("img[lazy-src]"), "img");
				lazyelem.detect();
				var cptDom = $(obj);
				cptDom.find("a").each(function (i) {
					if (cptDom.find("a").eq(i).attr("cptId")) {
						var cptid = cptDom.find("a").eq(i).attr("cptId");
						if (cptid) {
							try {
								apsAdboardCptPvObj.aps_adboard_loadAdCptPv(cptid, index.cptTime);
							} catch (e) {}
						}
					}
				});
				lazyelem.listen($(obj).find("[cms-name]"), 'fn', function (obj) {

					index.cmsBgDom.push(obj);

					if (index.cmsBgFlag) {
						return;
					}
					index.cmsBgFlag = true;

					setTimeout(function () {
						index.cmsBgFunc(index.cmsBgDom);
					}, 100)

				});
				cpmRequire($(obj));
				lazyelem.detect();
			}

			tjObj.each(function () {
				var the = $(this),
					indexX,
					indexY,
					tjKey,
					parameter = the.attr('data-kg');

				if (the.hasClass('g-floor1')) {
					count = 8;
					indexX = the.index('.com-floor');
					tjKey = 'recdpllc';
				} else if (the.hasClass('g-floor2')) {
					count = 7;
					indexX = the.parent('.com-floor').index('.com-floor');
					indexY = the.index();
					tjKey = 'recspllc';
				} else if (the.hasClass('g-floor3')) {
					count = 4;
					indexX = the.parent('.com-floor').index('.com-floor');
					indexY = the.index();
					tjKey = 'recsanpllc';
				}


				if (!parameter) {
					getCMSHtml(this);
					return true;
				}



				Util.getCity(function (cityId) {
					// sn.cityId = cityId;
					var cID = '',
						uID = '',
						nowC = '',
						nowU = '';


					nowU = Util.getCookie('custno');

					if (typeof nowU != 'undefined' && nowU) {
						uID = nowU;
					}

					nowC = Util.getCookie('_snma');
					if (typeof nowC != 'undefined' && nowC) {
						cID = nowC.split("|")[1];
					}

					var url = '//tuijian.suning.com/recommend-portal/recommend/paramsBiz.jsonp?u=' + index.uID + '&c=' + index.cID + '&parameter=plhd&parameterCode=' + parameter + '&cityId=' + cityId + '&sceneIds=19-9&count=' + count;


					$.ajax({
						url: url,
						dataType: 'jsonp',
						timeout: 10000,
						jsonpCallback: 'floorRec' + parameter,
						success: function (re) {
							if (re.sugGoods[0]['resCode'] == '01' || re.sugGoods[0]['resCode'] == '03') {
								if (re.sugGoods[0]['skus'].length < count) {
									getCMSHtml(the);
								} else {
									getHtml(re.sugGoods[0]['skus']);
								}

							} else {
								getCMSHtml(the);
							}

						},
						error: function () {
							getCMSHtml(the);
						}
					})


					function getHtml(re) {

						var list1 = the.find('.img-list').eq(0),
							list2 = the.find('.img-list').eq(1),
							list3 = the.find('.bottom-list'),
							sugGoodsCode, vendorId;

						var item;

						for (var i = 0; i < count; i++) {

							name = 'index3_none_' + tjKey;
							id = 'baoguang_' + tjKey;

							sugGoodsCode = re[i].sugGoodsCode ? re[i].sugGoodsCode : 'none';
							vendorId = re[i].vendorId ? re[i].vendorId : 'none';

							if (the.hasClass('g-floor1')) {
								if (i < 4) {
									item = list1.find('li').eq(i);
								} else {
									item = list2.find('li').eq(i - 4);
								}
								name += '_' + (indexX + 1) + '-' + (i + 1) + '_p_' + vendorId + '_' + sugGoodsCode + '_' + re[i].handwork;
								id += '_' + (indexX + 1) + '-' + (i + 1) + '_' + vendorId + '_' + sugGoodsCode + '_' + re[i].handwork;

							} else if (the.hasClass('g-floor2')) {
								if (i < 4) {
									item = list1.find('li').eq(i);
								} else {
									item = list3.find('li').eq(i - 4);
								}

								name += '_' + (indexX + 1) + '-' + (i + 1 + indexY * 7) + '_p_' + vendorId + '_' + sugGoodsCode + '_' + re[i].handwork;
								id += '_' + (indexX + 1) + '-' + (i + 1 + indexY * 7) + '_' + vendorId + '_' + sugGoodsCode + '_' + re[i].handwork;

							} else {
								if (i < 2) {
									item = list1.find('li').eq(i);

								} else {
									item = list3.find('li').eq(i - 2);
								}
								name += '_' + (indexX + 1) + '-' + (i + 1 + indexY * 4) + '_p_' + vendorId + '_' + sugGoodsCode + '_' + re[i].handwork;
								id += '_' + (indexX + 1) + '-' + (i + 1 + indexY * 4) + '_' + vendorId + '_' + sugGoodsCode + '_' + re[i].handwork;
							}

							if (re[i].labelPic.indexOf("http:") == 0) {
								re[i].labelPic = re[i].labelPic.split("http:")[1];
							}

							var saDataText = Util.json2String({
									'recvalue': re[i].handwork
								}).replace(/"/g, "'"),
								saDataImg = Util.json2String({
									'prdid': sugGoodsCode,
									'shopid': vendorId,
									'recvalue': re[i].handwork
								}).replace(/"/g, "'")

							//暂时使用白底图
							item.find('a').attr({
									'href': re[i].jumpUrl,
									'name': name,
									'id': id
								}).end()
								.find('.img-name').html(re[i].labelName).end()
								.find('.img-desc').html(re[i].labelDesc).end()
								.find('img').attr('lazy-src', re[i].labelPic)


							item.find('.click-area').attr('sa-data', saDataText)
							item.find('.img-wrapper').attr('sa-data', saDataImg)

							var ind;

							if (the.hasClass('g-floor1')) {
								ind = i + 1;
							} else if (the.hasClass('g-floor2')) {
								ind = (i + 1 + indexY * 7);
							} else {
								ind = (i + 1 + indexY * 4);
							}

						}

						the.find('li').show();
						lazyelem.listen($(obj).find("img[lazy-src]"), "img");
						index.getwebp(obj)
						lazyelem.detect();


					}

				});


			});

		}

	});

};

//大促会场推荐

index.dchc = function () {


	lazyelem.listen('.soe-module', 'fn', function (obj) {

		if ($(obj).attr('data-tuijian') == 'true') {

			Util.getCity(function (cityId) {

				var parameter = $(obj).attr('data-parameter');

				var callback = $(obj).hasClass('soebig-module') ? 'dchc1' : 'dchc2',
					url = tuijianDomain + '/recommend-portal/recommend/paramsBiz.jsonp?u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId + '&parameter=' + parameter + '&sceneIds=16-47&count=10';


				$.ajax({
					url: url,
					dataType: 'jsonp',
					timeout: 10000,
					jsonpCallback: callback,
					success: function (data) {
						if (data && data.sugGoods && data.sugGoods[0].skus && data.sugGoods[0].skus.length > 9) {
							getHtml(data.sugGoods[0].skus);
						} else {
							getCMSHtml();
						}

					},
					error: function () {
						getCMSHtml();
					}
				})

			});
		} else {
			getCMSHtml();
		}


		function getHtml(data) {

			var dom = '',
				item, imgList, imgItem, imgUrl, id, trickPoint, titleColor, descColor, imgUrlBf;

			titleColor = $(obj).attr('data-tColor') ? $(obj).attr('data-tColor') : '';
			descColor = $(obj).attr('data-dColor') ? $(obj).attr('data-dColor') : '';

			for (var i = 0; i < data.length; i++) {

				item = data[i];

				imgList = item['list'];

				imgItem = imgList[parseInt(Math.random() * imgList.length)];

				if (item.labelPic.indexOf("http:") == 0) {
					item.labelPic = item.labelPic.split("http:")[1];
				}

				var shop = imgItem.productType == 3 || imgItem.productType == 5 ? imgItem.supplierCode : imgItem.shopId;

				imgUrl = (imgItem.sugGoodsCode != '') ? sn.imgHost + '/uimg/b2c/qrqm/' + shop + imgItem.sugGoodsCode + '.jpg?ver=' + imgItem.picVersion + '&format=400w_400h_4e' : item.labelPic;

				imgUrlBf = imgItem.pictureUrl;

				trickPoint = 'index3_' + item.labelCode + '_recpllc_1-' + (i + 1) + '_p_' + imgItem.shopId + '_' + imgItem.sugGoodsCode + '_' + item.handwork;
				id = 'baoguang_recpllc_1-' + (i + 1) + '_' + imgItem.shopId + '_' + imgItem.sugGoodsCode + '_' + item.handwork;

				var linkUrl = item.jumpUrl
				linkUrl += linkUrl.indexOf('?') > -1 ? '&' : '?' + 'productCode=' + imgItem.sugGoodsCode + '&shopId=' + imgItem.shopId + '&supplierCode=' + imgItem.supplierCode + '&productType=' + imgItem.productType + '&pictureUrl=' + encodeURIComponent(imgItem.pictureUrl)

				var saDataText = Util.json2String({
						'recvalue': item.handwork
					}).replace(/"/g, "'"),
					saDataImg = Util.json2String({
						'prdid': imgItem.sugGoodsCode,
						'shopid': imgItem.shopId,
						'recvalue': item.handwork
					}).replace(/"/g, "'")

				dom += '<li>' +
					'<a href="' + linkUrl + '" sa-data="' + saDataText + '" class="click-area" target="_blank" name="' + trickPoint + '" id="' + id + '">' +
					'<p class="name" style="color: ' + titleColor + '">' + item.labelName + '</p>' +
					'</a>' +
					'<a href="' + linkUrl + '" sa-data="' + saDataImg + '" class="img-wrapper" target="_blank" name="' + trickPoint + '" id="' + id + '">' +
					'<img lazy-src="' + imgUrl + '" data-src="' + imgUrlBf + '" src="//res.suning.cn/public/v3/images/blank.gif">' +
					'<p class="desc" style="color: ' + descColor + '">' + item.labelDesc + '</p>' +
					'</a>' +
					'</li>';

			}
			$(obj).find('.reco-big').html(dom);
			$(obj).find('img').on('error', function () {
				$(this).attr('src', $(this).attr('data-src'))
			})
			index.getwebp(obj);
			lazyelem.listen($(obj).find('img[lazy-src]'));

			lazyelem.detect();



			Util.baoguangFun('baoguang_recpllc_1');
		}

		function getCMSHtml() {
			$(obj).find('.big').show();
			index.getwebp(obj);
			lazyelem.detect();
		}

	});

};

//新分会场楼层
index.newHc = function () {

	lazyelem.listen('.tj-floor', 'fn', function (obj) {

		var random = $(obj).attr('data-random');

		if ($(obj).attr('data-parameter')) {

			if (Util.isLocalStorageSupported() && random) {

				var flag = Util.getData('hcRandom');
				var sp = 0;
				if (flag) {
					var lastTime = Util.getData('hcRandom').match(/\d+/)[0],
						now = new Date().getTime();
					sp = Math.floor(((now - lastTime) / (60 * 1000)) % 60);
				}

				if (sp >= 10) {
					getTuijianData();
				}else if (flag) {
					if (flag == 'cms') {
						getCMSHtml();
						// changeTrickPoint();
					} else {
						getTuijianData();
					}
				} else {

					var num = Math.random(),
						text = num > 0.5 ? 'cms' : 'tj';

					Util.setData('hcRandom', text + new Date().getTime());

					if (num > 0.5) {
						getCMSHtml();
						// changeTrickPoint();
					} else {
						getTuijianData();
					}

				}

			} else {
				getTuijianData();
			}

		} else {
			getCMSHtml();
		}


		function getTuijianData() {

			Util.getCity(function (cityId) {

				var parameter = $(obj).attr('data-parameter'),
					count = $(obj).find('li').length;

				count = count - count % 5;

				if (count < 5) {
					getCMSHtml();
					if (random) {
						changeTrickPoint();
					}

				}

				var url = tuijianDomain + '/recommend-portal/recommend/paramsBiz.jsonp?u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId + '&parameter=' + parameter + '&sceneIds=16-47&count=' + count;

				$.ajax({
					url: url,
					dataType: 'jsonp',
					timeout: 10000,
					jsonpCallback: 'newHc',
					success: function (data) {
						if (data && data.sugGoods && data.sugGoods[0].skus && data.sugGoods[0].skus.length > (count - 1)) {
							getHtml(data.sugGoods[0].skus);
						} else {
							try {
								index.saYcFunc('sy-dcfhctjjk-2sjbz', '16-47');
							} catch (error) {};
							getCMSHtml();
							if (random) {
								changeTrickPoint();
							}
						}
					},
					error: function () {
						try {
							index.saYcFunc('sy-dcfhctjjk-2sjbz', '16-47');
						} catch (error) {};
						getCMSHtml();
						if (random) {
							changeTrickPoint();
						}
					}
				})

			});
		}

		function getHtml(data) {

			var dom = '',
				item, imgList, imgItem, imgUrl, id, trickPoint, linkUrl, imgUrlBf,
				li = $(obj).find('li');


			$.each(data, function (index, item) {


				imgList = item['list'];

				if (imgList.length > 0) {
					imgItem = imgList[parseInt(Math.random() * imgList.length)];
				} else {
					imgItem = {
						"pictureUrl": "",
						"sugGoodsCode": "none",
						"shopId": "none",
						"supplierCode": "none",
						"productType": "",
						"picVersion": "",
						"catGroupId": "",
						"handwork": "",
						"brand": "",
						"price": ""
					}
				}



				if (item.labelPic.indexOf("http:") == 0) {
					item.labelPic = item.labelPic.split("http:")[1];
				}

				var shop = imgItem.productType == 3 || imgItem.productType == 5 ? imgItem.supplierCode : imgItem.shopId;

				//新图片规范
				imgUrl = (imgItem.sugGoodsCode != '' && imgItem.sugGoodsCode != 'none') ? sn.imgHost + '/uimg/b2c/qrqm/' + shop + imgItem.sugGoodsCode + '.jpg?ver=' + imgItem.picVersion + '&format=400w_400h_4e' : item.labelPic;
				imgUrlBf = imgItem.pictureUrl;
				trickPoint = 'index3_' + item.labelCode + '_recpllc_1-' + (index + 1) + '_p_' + imgItem.shopId + '_' + imgItem.sugGoodsCode + '_' + item.handwork;
				id = 'baoguang_recpllc_1-' + (index + 1) + '_' + imgItem.shopId + '_' + imgItem.sugGoodsCode + '_' + item.handwork;

				itenData = {
					'src': trickPoint,
					'contentId': imgItem.contentId || '',
					'productCode': imgItem.sugGoodsCode || '',
					'shopId': imgItem.shopId || '',
					'shopCode': imgItem.shopCode || '',
					'supplierCode': imgItem.supplierCode || '',
					'productType': imgItem.productType || '',
					'productName': imgItem.sugGoodsName ? encodeURIComponent(imgItem.sugGoodsName) || '' : '',
					'handwork': item.handwork || '',
					'promotionInfo': imgItem.promotionInfo || '',
					'promotionId': imgItem.promotionId || '',
					'pictureUrl': imgItem.pictureUrl ? encodeURIComponent(imgItem.pictureUrl) || '' : ''
				}

				var saDataText = Util.json2String({
						'recvalue': item.handwork
					}).replace(/"/g, "'"),
					saDataImg = Util.json2String({
						'prdid': imgItem.sugGoodsCode,
						'shopid': imgItem.shopId,
						'recvalue': item.handwork
					}).replace(/"/g, "'")

				linkUrl = item.jumpUrl + '?' + Util.serialize(itenData);

				var liItem = li.eq(index);

				liItem.find('a').attr({
					'name': trickPoint,
					'id': id,
					'href': linkUrl,
					'title': item.labelName + ' ' + item.labelDesc,
					'aria-label': item.labelName + ' ' + item.labelDesc
				}).find('img').attr({
					'lazy-src': imgUrl,
					'data-src': imgUrlBf
				});

				liItem.find('.click-area').attr('sa-data', saDataText)
				liItem.find('.img-wrapper').attr('sa-data', saDataImg)

				liItem.find('.title').html(item.labelName).end().find('.desc').html(item.labelDesc);


			});


			$(obj).find('img').on('error', function () {
				$(this).attr('src', $(this).attr('data-src'))
			})

			$(obj).find('.hcList').show();
			lazyelem.detect();



			Util.baoguangFun('baoguang_recpllc_1');
		}

		function getCMSHtml() {
			$(obj).find('.hcList').show();
			lazyelem.detect();
		}

		function changeTrickPoint() {

			$.each($(obj).find('.hcList-wrapper a'), function (index, item) {
				index++;

				index = index > 9 ? index : '0' + index;

				$(item).attr('name', 'index3_homepage1_dczntj_' + index);

			})

		}

	});

}

//加载webp格式图片
index.getwebp = function (obj) {

	if ($.isWebp) {
		var img = $(obj).find('img');

		img.each(function () {

			var the = $(this),
				src = '';

			if (the.attr('lazy-src') != '') {

				src = the.attr('lazy-src');

			} else if (the.attr('src') != '') {
				src = the.attr('src');
			}
			if (src && src.indexOf('?') == -1) {
				src = src + '?from=mobile'
			} else if (src) {
				src = src + '&from=mobile'
			}
			if (the.attr('lazy-src') != '') {

				the.attr('lazy-src', src);

			} else if (the.attr('src') != '') {
				src = the.attr('src', src);
			}

		});
	}

};

//新人弹框和促销弹框和浏览器提醒逻辑
index.activeDialog = function (loginFlag) {
	//低版本浏览器判断提示ie6,ie7
	if ((Util.ieVersion(6) || Util.ieVersion(7)) && !Util.getCookie('indexCheckBrowser')) {
		index.oldBrowser();
		return;
	}

	index.newUser(loginFlag);

};

//新人楼层
index.newFloor = function () {

	var nfloor = $('.nine-floor');

	$('.newUser-floor').show();

	lazyelem.detect();

	if (nfloor.attr('data-tuijian') == 'true') {
		Util.getCity(function (cityId) {
			$.ajax({
				url: tuijianDomain + '/recommend-portal/recommend/paramsBiz.jsonp?u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId + '&sceneIds=19-77&count=4',
				dataType: 'jsonp',
				timeout: 10000,
				jsonpCallback: 'newFloor',
				success: function (data) {
					if (data && data.sugGoods && data.sugGoods[0].skus && data.sugGoods[0].skus.length > 3) {
						getHtml(data.sugGoods[0].skus);
					} else {
						getCMSHtml();
					}
				},
				error: function () {
					getCMSHtml();
				}
			})
		})
	} else {
		getCMSHtml();
	}




	function getHtml(data) {

		var dom = '';

		$.each(data, function (index, item) {

			if (index > 3) {
				return;
			}

			var shop = item.productType == 3 || item.productType == 5 ? item.supplierCode : item.shopCode;

			var imgUrl = shop && item.sugGoodsCode ? '//image1.suning.cn/uimg/b2c/qrqm/' + shop + item.sugGoodsCode + '.jpg?ver=' + item.picVersion + '&format=400w_400h_4e' : item.pictureUrl + '_400w_400h_4e';

			var trickPoint = 'index3_none_recxrlcj_1-' + (index + 1) + '_p_' + item.supplierCode + '_' + item.sugGoodsCode + '_' + item.handwork + '_none';

			var id = 'baoguang_recxrlcj_1-' + (index + 1) + '_' + item.supplierCode + '_' + item.sugGoodsCode + '_' + item.handwork + '_none';

			var saData = Util.json2String({
				'prdid': item.sugGoodsCode,
				'shopid': item.shopCode,
				'recvalue': item.handwork
			}).replace(/"/g, "'")

			var dataObj = {
				partNumber: item.sugGoodsCode,
				vendorCode: shop,
				linkType: '',
				trickPoint: trickPoint,
				linkUrl: ''
			};

			var ariaLabel = item.sugGoodsName + '新人价' + item.price + '元';

			dom += '<li ' + commodity.getSku(dataObj) + ' data-tj="true">' +
				'<a title="' + ariaLabel + '" tabindex="-1" href="//cuxiao.suning.com/HYRXRZC.html" sa-data="' + saData + '" name="' + trickPoint + '" id="' + id + '" target="_blank">' +
				'<img lazy-src="' + imgUrl + '" alt="">' +
				'<div class="licon">' +
				'<p class="pro-title">' + item.sugGoodsName + '</p>' +
				'<del class="refprice"></del>' +
				'<p class="tag">新人价</p><p class="price">&yen;' + item.price + '</p>' +
				'<div class="clear"></div>' +
				'<p class="buy-btn">立即购买</p>' +
				'</div>' +
				'</a>' +
				'</li>';

		})

		$('.nine-floor ul').html(dom);
		lazyelem.listen($('.nine-floor ul').find('img'), 'img');
		$('.nine-floor ul').show()

		lazyelem.listen($(".nine-floor").find("li[data-sku]"), 'fn', function (obj) {
			index.priceDOM.push(obj);
			if (index.getPriceFlag) {
				return;
			}
			index.getPriceFlag = true;
			GetPrice.queryprice(index.priceDOM, "1", index.getpricecallback)
		});

		lazyelem.detect();

		Util.baoguangFun('baoguang_recxrlcj_1');

	}

	function getCMSHtml() {
		$('.nine-floor ul').show()
		lazyelem.detect();
	}

	//打开收起事件
	$('.btn-close').on('click', function () {

		var newPro = $('.new-pro'),
			nineFloor = $('.nine-floor'),
			self = $(this);

		if (self.hasClass('btn-open')) {
			newPro.show();
			nineFloor.show();
			self.removeClass('btn-open');
		} else {
			newPro.hide();
			nineFloor.hide();
			self.addClass('btn-open');
		}

	});

}

//新人弹框
index.newUser = function (loginFlag) {
	var newFlag,
		main = function () {

			var newOverlay = $('.dialog-overlay'),
				newDialog = $('.new-user'),
				close = newDialog.find('.close'),
				domHeight = $(document).height();
			newOverlay.css('height', domHeight);

			$(window).scroll(function () {
				domHeight = $(document).height();
				newOverlay.css('height', domHeight);
			});

			newDialog.show();
			newOverlay.show();
			index.newFloor();
			lazyelem.detect();
			close.on('touchstart click', function () {
				try {
					sa.click.sendDatasIndex(this);
				} catch (e) {}
				newOverlay.hide();
				newDialog.hide();
				return false;
			});

			newOverlay.click(function () {
				newOverlay.hide();
				newDialog.hide();
			})

			Util.setData('newUserDialog', new Date().getTime() + 1000 * 60 * 60 * 24 * 7);

			setTimeout(function () {
				newOverlay.hide();
				newDialog.hide();
			}, 7000);

		};


	if (Util.ieVersion(6)) return; //IE6或者不维护时不执行


	if (loginFlag) {
		//登录了请求新人,如果未购买过，调用弹框逻辑

		$.ajax({
			url: nmqsDomain + '/newMember/json/getQualificationData.do?channelType=1&deptIds=ALL',
			cache: false,
			dataType: 'jsonp',
			jsonpCallback: 'newMember',
			success: function (data) {

				if (data && data.onlineNewmember == '0') {

					if (Util.isLocalStorageSupported()) {
						newFlag = parseInt(Util.getData('newUserDialog'));
						if (!newFlag || newFlag < new Date().getTime()) {
							main();
						}
					} else {
						main();
					}
				}

			}
		});
	} else {
		var cID = '',
			nowC = '';


		nowC = Util.getCookie('_snma');
		if (typeof nowC != 'undefined' && nowC) {
			cID = nowC.split("|")[1];
		}

		$.ajax({
			url: nmqsDomain + '/newMember/json/getDeviceInfoNotLogin.do?deviceId=' + cID,
			cache: false,
			dataType: 'jsonp',
			jsonpCallback: 'newMemberNotLogin',
			success: function (data) {

				if (data && data.deviceNewmember == 0) {

					if (window.localStorage) {
						newFlag = parseInt(Util.getData('newUserDialog'));
						if (!newFlag || newFlag < new Date().getTime()) {
							main();
						}
					} else {
						main();
					}
				}

			}
		});
	}

};

index.oldBrowser = function () {
	Util.SetCookie('indexCheckBrowser', 1, 1);
	var html = '<div class="old-browser-warning">' +
		'<span class="old-browser-warning-close"></span>' +
		'<a class="old-browser-warning-content" href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie" target="_blank">IE浏览器最新版</a>' +
		'<div class="old-browser-warning-bg"></div>' +
		'</div>' +
		'<div class="old-browser-dialog-overlay"></div>';
	$('body').append(html);

	var dOldBrowserDialogOverlay = $('.old-browser-dialog-overlay'),
		dOldBrowserWarning = $('.old-browser-warning');

	dOldBrowserDialogOverlay.dblclick(function () {
		$(this).unbind().remove();
		dOldBrowserWarning.remove();
	})

	dOldBrowserWarning.find('.old-browser-warning-close').one('click', function () {
		dOldBrowserDialogOverlay.unbind().remove();
		dOldBrowserWarning.remove();
	})

	if (Util.ieVersion(6)) {
		var windowH = $(window).height();
		var wScrollTop = $(window).scrollTop();
		dOldBrowserWarning.css({
			'top': wScrollTop + windowH / 2
		})
		dOldBrowserDialogOverlay.css({
			'top': wScrollTop,
			'height': windowH
		})
		$(window).scroll(function () {
			var wScrollTop = $(this).scrollTop();
			dOldBrowserWarning.css({
				'top': wScrollTop + windowH / 2
			})
			dOldBrowserDialogOverlay.css({
				'top': wScrollTop
			})
		})
	}
}

index.dacuTitle = function () {
	lazyelem.listen(".oneimg-floor", "fn", function (obj) {

		var img = $(obj).find('.title');

		var src = bigscreen ? img.attr('d-src') : img.attr('n-src');

		img.attr('src', src);

	});
}

//品牌日
index.pinpaiShow = function () {

	var wrapper = $('.pinpai-show'),
		little = wrapper.find('.little'),
		big = wrapper.find('.big'),
		flag = false,
		close = wrapper.find('.close');

	wrapper.hover(function () {

		var leftWidth = bigscreen ? 1200 : 1000;

		var src = bigscreen ? big.attr('w-src') : big.attr('n-src');

		big.attr('src', src);

		wrapper.stop().animate({
			'width': leftWidth
		}, 500);

	}, function () {
		wrapper.stop().animate({
			'width': 200
		}, 500);
	});

};

index.dacuFloat = function () {

	if ($('.dacu-float-wrapper').length < 1 || $('.firstScreen').length < 1) {
		return;
	}

	var wrapper = $('.dacu-float-wrapper'),
		img = wrapper.find('.main'),
		wSrc = img.attr('w-src'),
		nSrc = img.attr('n-src'),
		height = $('.firstScreen').offset().top + 482,
		top;

	function show() {

		if (document.documentElement.clientWidth >= 1200) {
			img.attr('src', wSrc);
			top = '-150px';
		} else {
			img.attr('src', nSrc);
			top = '-130px';
		}

		var scrollTop = $(document).scrollTop(),
			winHeight = $(window).height();

		if (height < scrollTop) {
			wrapper.stop(true).css({
				'bottom': '0'
			});
			lazyelem.detect();
		} else {
			wrapper.stop(true).css({
				'bottom': top
			});
		}

	}
	show();

	$(window).resize(function () {
		show();
	});
	$(window).scroll(function () {
		show();
	});
}

index.formateProCode = function (c) {
	var a = "";
	if (c.length < 18) {
		for (var e = 18 - c.length, b = 0; b < e; b++) {
			a += "0"
		}
	}
	return a + c
}

index.cityOperate = function () {
	$('.ng-toolbar-left').append('<div class="index-city-handle" sap-modid="AVnhU"><div id="sncity"></div></div>');

	$("a[name^=item]").live("click", function () {
		try {
			sa.click.sendDatasIndex(this);
		} catch (e) {}
	});

	$("#sncity").mCity({
		used: true,
		city: true,
		cityCb: function () {
			window.location.href = window.location.href;
		}
	});
}

//cms埋点曝光
index.cmsBgDom = [];
index.cmsBgFlag = false;

index.cmsBgFuncInit = function () {

	lazyelem.listen('[cms-name]', 'fn', function (obj) {

		index.cmsBgDom.push(obj);

		if (index.cmsBgFlag) {
			return;
		}
		index.cmsBgFlag = true;

		setTimeout(function () {
			index.cmsBgFunc(index.cmsBgDom);
		}, 100)

	});
};

index.cmsBgFunc = function (data) {

	var nameList = '';

	for (var i = 0; i < 10; i++) {

		if (data.length == 0) {
			break;
		}

		if (i != 0) {
			nameList += ',';
		}
		nameList += $(data.shift()).attr('cms-name');
	}

	saExportUtil.sendCustomExpoData(nameList, 1);

	if (data.length > 0) {
		index.cmsBgFunc(data);
	} else {
		index.cmsBgFlag = false;
	}

}

index.brandDom = function () {

	var getTjData = function () {

		lazyelem.listen('.brand-show', 'fn', function (obj) {

			Util.getCity(function (cityId) {

				var url = fmDomain + '/wapIndex/getUserPreferences.do?pageCode=homepage_v6&u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId + '&sceneIds1=6-46&sceneIds2=13-72&count=10';

				$.ajax({
					url: url,
					dataType: 'jsonp',
					timeout: 10000,
					jsonpCallback: 'brandData',
					success: function (re) {
						if (re && re.data && re.data.length > 5) {

							var dom = '',
								trickPoint, id, imgUrl, shop;

							$.each(re.data, function (index, item) {

								if (index > 5) {
									return
								}

								trickPoint = 'index3_none_recppq_1-' + (index + 1) + '_p_' + item.shopCode + '_' + item.sugGoodsCode + '_' + item.handwork;
								id = 'baoguang_recppq_1-' + (index + 1) + '_' + item.shopCode + '_' + item.sugGoodsCode + '_' + item.handwork + '_none';

								shop = item.productType == 3 || item.productType == 5 ? item.supplierCode : item.shopCode;


								imgUrl = '//image.suning.cn/uimg/b2c/qrqm/' + shop + item.sugGoodsCode + '.jpg?ver=' + item.picVersion + '&format=400w_400h_4e',

									dom += '<li>' +
									'<a href="' + item.linkUrl + '?src=' + trickPoint + '" target="_blank" name="' + trickPoint + '" id="' + id + '">' +
									'<img lazy-src="' + imgUrl + '" class="pro-img" />' +
									'<div class="infor">' +
									'<img lazy-src="' + sn.imgHost + item.barndLogo + '" class="logo-img">' +
									'<p style="color:' + item.color + ';">' + item.brandName + '</p>' +
									'</div>' +
									'</a>' +
									'</li>';

							});

							$('.brand-show ul').html(dom);
							lazyelem.listen($('.brand-show ul').find('img[lazy-src]'), 'img');
							lazyelem.detect();
							Util.baoguangFun('baoguang_recppq');
							index.brandAnimate();
						} else {
							getCmsData();
						}

					},
					error: function () {
						getCmsData();
					}
				})

			});

		});
	}

	var getCmsData = function () {

		if (typeof brandWallList == "undefined" || !brandWallList || brandWallList.length < 6) {
			$('.brand-show').hide();
			return;
		}

		var domList = Util.getArrayItems(brandWallList, 6),
			dom = '',
			color = $('.brand-show .content').attr('data-textColor');

		$.each(domList, function (index, item) {

			dom += '<li>' +
				'<a href="' + item.href + '" target="_blank" name="' + item.trickPoint + '">' +
				'<img lazy-src="' + item.pic1 + '" class="pro-img" />' +
				'<div class="infor">' +
				'<img lazy-src="' + item.pic2 + '" class="logo-img">' +
				'<p style="color:' + color + ';">' + item.title + '</p>' +
				'</div>' +
				'</a>' +
				'</li>'

		});

		$('.brand-show ul').html(dom);

		lazyelem.listen($('.brand-show ul').find('img[lazy-src]'), 'img');
		lazyelem.detect();

		index.brandAnimate();

	}

	$('.brand-show').attr('data-tuijian') == 'true' ? getTjData() : getCmsData()

}

index.brandAnimate = function () {

    var items = $('.brand-show li'),
        length = items.length;


    function brandAnimateFunc(index) {

        var item = items.eq(index),
            animateObj = item.find('.infor'),
            animateImg = animateObj.find('img');

        animateObj.animate({
            'top': 0
        }, 2000, function () {
            animateObj.animate({
                'top': '120px'
            }, 2000)
        })

        animateImg.animate({
            'marginTop': '20px',
            'width': '186px',
            'height': '76px'
        }, 2000, function () {
            animateImg.animate({
                'marginTop': '0',
                'width': '143px',
                'height': '59px'
            }, 2000, function () {

                index++;

                index = index == length ? 0 : index;
                brandAnimateFunc(index);

            });
        })

    }

    brandAnimateFunc(0)

};

index.allImgCpm = function () {
	//顶通
	if ($('.top-active-wrap').find('a.img-wrapper').attr('cpmId')) {
		cpmRequire($('.top-active-wrap'));
	}

	//小logo广告
	if ($('.ng-gif-logo').attr('cpmId')) {
		cpmRequire($('.ng-header-box'))
	}
}

index.dacuFloatHc = function () {

	//出现隐藏
	if ($('.v7-floatHc').length < 1 || $('.firstScreen').length < 1) {
		return;
	}

	var wrapper = $('.v7-floatHc'),
		height = $('.firstScreen').offset().top + 482,
		top;

	function show() {

		if (document.documentElement.clientWidth >= 1200) {
			top = '-100px';
		} else {
			top = '-84px';
		}

		var scrollTop = $(document).scrollTop(),
			winHeight = $(window).height();

		if (height < scrollTop) {
			wrapper.stop(true).css({
				'bottom': '0'
			});
			lazyelem.detect();
		} else {
			wrapper.stop(true).css({
				'bottom': top
			});
		}

	}
	show();

	$(window).resize(function () {
		show();
	});
	$(window).scroll(function () {
		show();
	});

	if (wrapper.attr('data-parameter')) {
		Util.getCity(function (cityId) {
			// sn.cityId = cityId;
			var count = $('.v7-floatHc li').length,
				url = tuijianDomain + '/recommend-portal/recommend/paramsBiz.jsonp?&u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId + '&parameter=' + wrapper.attr('data-parameter') + '&sceneIds=15-53&count=' + count

			$.ajax({
				url: url,
				dataType: 'jsonp',
				timeout: 10000,
				jsonpCallback: 'floatHc',
				success: function (re) {
					if (re && re.sugGoods && re.sugGoods[0]) {

						if (re.sugGoods[0]['skus'].length < count) {
							getCMSHtml();
						} else {
							getHtml(re.sugGoods[0]['skus']);
						}

					} else {
						getCMSHtml();
					}
					lazyelem.detect();
				},
				error: function () {
					getCMSHtml();
				}
			})

		});
	} else {
		getCMSHtml();
	}
	//推荐数据


	function getHtml(data) {

		var dataList = data.splice(0, $('.v7-floatHc li').length),
			dom = ''
		var color = wrapper.find('ul li').eq(0).attr('data-color');
		$.each(dataList, function (index, item) {
			var saData = Util.json2String({
				'recvalue': item.handwork
			}).replace(/"/g, "'")

			dom += '<li>' +
				'<a tabindex="-1" href="' + item.jumpUrl + '" target="_blank" sa-data="' + saData + '">' +
				'<span style="color:' + color + '">' + item.labelName + '<b class="right" style="border-color:' + color + '"></b></span>' +
				'</a>' +
				'</li>'
		})

		wrapper.find('ul').html(dom)

	}

	function getCMSHtml() {
		wrapper.find('li').show()
	}

}

index.hoverHandle = function () {
	var items = $('.ng-nav-bar .ng-nav-index ul.ng-nav li a');
	items.hover(function () {
		$(this).css('color', '#f60');
	}, function () {
		var defaultColor = $(this).attr('data-color') && $(this).attr('data-color') != '' ? $(this).attr('data-color') : '#333';
		$(this).css('color', defaultColor);
	})
}

index.popInit = function () {

	var trigger = $('.pop-box-trigger'),
		showBox = $('.pop-box-cont');
	if (trigger.length == 0 || showBox.length == 0) {
		return;
	}
	trigger.hover(function () {
		trigger.find('.pic').attr('src', trigger.find('.pic').attr('d-src'))
		showBox.show();
	}, function () {
		trigger.find('.pic').attr('src', trigger.find('.pic').attr('c-src'))
		showBox.hide();
	});

}

//888888
index.saYcInit = function () {
	//初始化方法
	sa.openAPI = sa.openAPI || {};
	sa.initTrackerConfig();
	SAUP.sendLogData('expoInit');
}

//端测 index.saYcFunc('scmscx-pczhctabcnxh-tabcnxhggjkyc', 'tabcnxhggjkyc');

index.saYcFunc = function (errorCode, typeName, parameter) {
	var param = {
		//必传参数
		bid: "syn",
		error_type: "2",
		error_code: errorCode || '',
		//非必传参数
		type_name: typeName || '', //接口名称
		error_detail: parameter ? '{"parameter": ' + parameter + '}' : '',
		member_id: index.uID,
		region: index.cID
	}
	sa.openAPI.sendMsgV2(param);

}

index.cmsShow = function (obj, isCommFloor) {
	if (isCommFloor) {
		lazyelem.listen($(obj).find("li[data-sku]"), 'fn', function (obj) {
			index.priceDOM.push(obj);
			if (index.getPriceFlag) {
				return;
			}
			index.getPriceFlag = true;
			GetPrice.queryprice(index.priceDOM, "1", index.getpricecallback)
		});
	}
	$(obj).find('.cms-good').show();
	lazyelem.listen($(obj).find("img[lazy-src]"), "img");
	lazyelem.detect();
}

index.floorCode = function (obj) {

	var timer;
	$(obj).find('.code-wrapper').hover(function () {
		clearTimeout(timer);
		$(this).find('.code').show();
		lazyelem.listen($(obj).find("img[lazy-src]"), "img");
		lazyelem.detect();

	}, function () {
		var the = $(this);
		timer = setTimeout(function () {
			the.find('.code').hide();
		}, 200);

	});

	// $('.index-head-active span').click(function(){
	//   $('.index-head-active').hide();
	// })

};
// 获取用户信息 super会员 云钻等

index.getUserInfor = function () {

	probeAuthStatus(function () {
		// 已登录;
		$('.first-right').find('.has-login').show().siblings('.not-login').hide();
		getInfor();
		yunZuanNum();
		isSuper();
		orderInfo();
		index.activeDialog(true);

	}, function () {
		// 未登录
		$('.first-right').find('.not-login').show().siblings('.has-login').hide();

		$('.first-right .user-img a').on('click', function () {
			loginFun();
		});
		$('.first-right .log').on('click', function () {
			loginFun()
		});
		index.activeDialog(false);
	});

	function loginFun() {
		var targetUrl = encodeURIComponent(window.location.href);
		window.location.href = passportLogonUrl + "?service=" +
			encodeURIComponent(httpsDomain + "/webapp/wcs/stores/auth?targetUrl=" +
				targetUrl) +
			"&method=GET&loginTheme=b2c";
	}

	//查询个人信息
	function getInfor() {
		$.ajax({
			type: "post",
			url: msiDomain + "b2cBroadside/memberInfoPageHeadB2c.do",
			async: true,
			dataType: 'jsonp',
			jsonpCallback: "getMyMemberInfoCb",
			timeout: 15000,
			success: function getMyMemberInfoCb(data) {				
				// 用户名
				if (data.nickName != null && "error" != data.nickName) {
					$(".user-info .hi em").html(data.nickName);
				}
				// 用户等级
				if (data.userRankName && data.userRankName !== '') {
					var level = data.userRankName;
					if (level != "") {
						$('.user-info .level').html(level).show();
					} else {
						$('.user-info .level').remove();
					}
				}else if (data.custLevelNum != null && "error" != data.custLevelNum) {
					var level;
					if (data.custLevelNum == "新人") {
						level = "新";
					} else if (data.custLevelNum == "V1") {
						level = "V1";
					} else if (data.custLevelNum == "V2") {
						level = "V2";
					} else if (data.custLevelNum == "V3") {
						level = "V3";
					} else if (data.custLevelNum == "V4") {
						level = "V4";
					} else {
						level = ""
					}
					if (level != "") {
						$('.user-info .level').html(level).show();
					}else{
						$('.user-info .level').remove();
					}
				}
				// 用户头像
				if (data.custType == '0') {
					$(".user-img img").show().attr("src", custHeadUrl + data.sysHeadPicNum);
				} else {
					if (null != data.sysHeadPicNum) {
						$(".user-img img").show().attr("src", custHeadUrl + data.sysHeadPicNum);
					} else {
						$(".user-img img").show().attr("src", scriptDomianDir + 'project/msIndex/enterprise/css/images/sysheadpic_60x60.jpg');
					}
				}

				$(".user-img a").attr('href', "//vip.suning.com/");
			},
			error: function (data) {}
		});
	}
	// 查询super会员
	function isSuper() {
		var url = superDomain+ 'snprime-web/m/ajax/queryMySuperLetters.do';
		Util.getAjax(url, 'queryMySuperLetters').done(function(res){
			if(res && res.superFlag && res.superFlag == '1'){
				$('.user-info span').css({
					'color': '#FADA99',
					'background-image': 'linear-gradient(90deg, #373A77 3%, #17125B 100%)'
				})
				$('.user-info .tips').html('续费Super预计可省869元/年').css({
					'position': 'absolute',
					'left': '0',
					'top': '60px',
					'width': '100%',
					'text-align': 'center'
				});
				$('.user-img').prepend('<em class="crown"></em>');
			}else{				
				$('.user-info .tips').html('云钻兑换更多好券');
			}
		}).fail(function(){
			$('.user-info .tips').html('云钻兑换更多好券');
		})
	}
	// 查询云钻
	function yunZuanNum() {
		var url = dtsDomain + 'snscs-web/rsf/private/queryPointAccountBalanceAndStatus-myPointInfoss.json'
		Util.getAjax(url, 'myPointInfoss').done(function (res) {
			if (res && res.data && res.data.status && res.data.status == "COMPLETE") {
				var num = res.data.balanceAmt > 9999 ? '9999+' : res.data.balanceAmt
				$('.user-info .yz').html('云钻' + num).show();
			}else{
				$('.user-info .yz').html('查看云钻').show()
			}
		}).fail(function(){
			$('.user-info .yz').html('查看云钻').show()
		})
	}
	// 查询订单信息
	function orderInfo() {
		var url1 = orderDomain + 'publicService/orderCount.do',
			callback1='order1';
		var url2 = reviewDomain + 'ajax/getpendingCount/waitEvaluation_callback.do',
			callback2 = 'waitEvaluation_callback';

		Util.getAjax(url1,callback1).done(function(res){			
			if(res){
				$('.order-info').find('.num').eq(0).html(res.waitPayCounts);
				$('.order-info').find('.num').eq(1).html(res.waitDeliveryCounts);
				$('.order-info').find('a').eq(0).attr({
					'title': $('.order-info').find('a').eq(0).attr('title') + res.waitPayCounts,
					'aria-label': $('.order-info').find('a').eq(0).attr('title') + res.waitPayCounts
				});
				$('.order-info').find('a').eq(1).attr({
					'title': $('.order-info').find('a').eq(1).attr('title') + res.waitDeliveryCounts,
					'aria-label': $('.order-info').find('a').eq(1).attr('title') + res.waitDeliveryCounts
				});
			}
		});
		Util.getAjax(url2,callback2).done(function(res){			
			$('.order-info').find('.num').eq(2).html(res.pendingOrderCount)
			$('.order-info').find('a').eq(2).attr({
				'title': $('.order-info').find('a').eq(2).attr('title') + res.pendingOrderCount,
				'aria-label': $('.order-info').find('a').eq(2).attr('title') + res.pendingOrderCount
			});
		})
		
	}
}
// 天天低价
index.newTwoTtdj = function () {	
	lazyelem.listen('.new-two-dj', 'fn', function (obj) {
		if ($(obj).attr('data-switch') == 'true') {
			Util.getCity(function (cityId) {
				var timeList = [];
				$(obj).find('input[type="hidden"]').each(function (index, item) {
					timeList.push(Number($(item).attr('value')))
				})
				_init(timeList);

				function _init(timeList) {
					var url = fmDomain + '/gw/pcRecDj.do?cityId=' + cityId + '&categoryCodes=' + timeList.join(',') + '&u=' + index.uID + '&c=' + index.cID,
						callback = 'pcRecDj';
					Util.getAjax(url,callback).done(function(res){	
						//有下一场
						if (res && res.data && res.data.currentCategoryInfo && res.data.currentCategoryInfo.skus && res.data.currentCategoryInfo.skus.length > 2 && res.data.nextCategoryInfo && res.data.nextCategoryInfo.skus && res.data.nextCategoryInfo.skus.length > 2) {
							nowCc = res.data.currentCategoryInfo.categoryCode;
							nextCc = res.data.nextCategoryInfo.categoryCode;
							var tListItem = $(obj).find('.t-list li');

							tListItem.eq(0).attr({
								'data-time': nowCc,
								'title': nowCc + ':00场',
								'aria-label': nowCc + ':00场'
							}).find('i').html(nowCc + ':00场');

							tListItem.eq(1).attr({
								'data-time': nextCc,
								'title': nextCc + ':00场',
								'aria-label': nextCc + ':00场'
							}).find('i').html(nextCc + ':00场');
							
							hoverFun();
							Util.getCurrentTime().done(function (now) {
								if(nextCc == 0){
									nextCc = 24
								}
								endTime = new Date(new Date().toDateString() + ' ' + nextCc + ':00').getTime()
								if (now < parseInt(endTime)) {
									Util.CountDown({
										obj: $(obj).find('.time'),
										startTime: 0,
										endTime: endTime,
										nowTime: now,
										beforeStart: function () {},
										isStart: function () {
											var gapDay = this.gap[3].toString(),
												gapHour = this.gap[2].toString(),
												gapMinute = this.gap[1].toString(),
												gapSecond = this.gap[0].toString();
											this.obj.html('<span class="hour-node">' + gapHour + '</span><i>:</i><span class="minute-node">' + gapMinute + '</span><i>:</i><span class="second-node">' + gapSecond + '</span>')
	
										},
										callback: function () {}
									});
								}
							}).fail(function(){
								cmsShow(obj);
							});
							var html1 = genHtml(res.data.currentCategoryInfo.skus, true);
							$(obj).find('.list-content').eq(0).html(html1);
							var html2 = genHtml(res.data.nextCategoryInfo.skus, false)
							$(obj).find('.list-content').eq(1).html(html2)

						} else if (res && res.data && res.data.currentCategoryInfo && res.data.currentCategoryInfo.skus && res.data.currentCategoryInfo.skus.length > 2) {
							var html1 = genHtml(res.data.currentCategoryInfo.skus, true);
							$(obj).find('.list-content').eq(0).html(html1);
							$(obj).find('.cc-infor').hide();
							$(obj).find('.time').hide();
							$(obj).find('.tab-list').hide();
						}else{
							cmsShow(obj);
							try {
								index.saYcFunc('sy-ttdjtjhbjk-2sjbz');
							} catch (error) {}
						}
					}).fail(function(){
						try {
							index.saYcFunc('sy-ttdjtjhbjk-2sjbz');
						} catch (error) {};
						cmsShow(obj);
					})
				}

				function hoverFun() {
					var tab = $(obj).find('.t-list li');

					tab.hover(function () {
						var index = $(this).index(),
							$this = $(this),
							$conList = $(obj).find('.tab-content .con-list'),
							$nowlist = $conList.eq(index);

						timer = setTimeout(function () {
							$this.addClass('cur').siblings().removeClass('cur');
							$nowlist.addClass('con-list-cur').siblings().removeClass('con-list-cur');
						}, 100)
					}, function () {
						clearTimeout(timer)
					})
				}

				function genHtml(skus, isNow) {
					var html = '<ul>';
					var queryDom1=[],
						queryDom2=[];

					$.each(skus, function (index, item) {
						if(index > 2){
							return;
						}
						var imgUrl = item.pictureUrl + '?format=200h_200w_4e',
							actId = item.extAttr.activityId,
							longTime = isNow ? '' : item.extAttr.gbBeginDate,
							linkUrl = isNow ? '//qiang.suning.com/?activityId=' + actId : '//qiang.suning.com/?activityId=' + actId + '&timelong=' + longTime,
							gdsCode = item.gdsCode,
							price = item.price,
							refpriceDom = parseFloat(price) < parseFloat(item.refPrice) ? '<span class="refprice"><i>¥</i><em>' + parseFloat(item.refPrice) + '</em></span>' : '<span class="refprice"></span>',
							processDom = isNow ? '<p class="line"><span></span></p><p class="precent">已抢<i></i>%</p>' : '<p class="tips">即将秒杀，敬请期待<p>'
							saData = Util.json2String({
								'prdid': item.gdsCode,
								'shopid': item.shopCode,
								'recvalue': item.handwork
							}).replace(/"/g, "'");

						queryDom1.push(actId);
						queryDom2.push(gdsCode);
						var ariaLabel = item.gdsName + ' ' + Number(price) + '元';
						html += ['<li data-activityid="' + actId + '">',
							'<a title="' + ariaLabel + '" aria-label="' + ariaLabel + '" style="display:block;width:100%;height:100%;" href="' + linkUrl + '" target="_blank" sa-data="' + saData + '" data-activityid="' + actId + '">',
							'<img src="' + imgUrl + '">',
							'<p class="title" >' + item.gdsName + '</p>',
							'<p class="price-box">',
							'<span class="price"><i>¥</i><em>' + price + '</em></span>',
							refpriceDom,
							'</p>',
							processDom,
							'</a>',
							'</li>'
						].join('');
					})

					html += '</ul>';
					if(isNow){
						getProgeress(obj,queryDom1.join(','),queryDom2.join(','))
					}
					return html
				}
			});
		} else {
			cmsShow(obj)
		}
	})

	function cmsShow(obj) {
		$(obj).find('.cc-infor').hide();
		$(obj).find('.time').hide();
		$(obj).find('.tab-list').hide();

		var wrapper = $(obj).find('.tab-content .con-list').eq(0);
		var len = wrapper.find('.cms-good').length - (wrapper.find('li').length % 3);
		if(len < 3){
			$(obj).parents('.new-twoFloor').hide();
			return;
		}
		index.cmsShow(obj, true)
		wrapper.find('.cms-good').show();

		var queryDom1 = [],
			queryDom2 = [];
		wrapper.find('.cms-good').each(function(index,item){
			var actId=$(item).attr('data-activityid'),
				partnumber=$(item).attr('data-partnumber');
			queryDom1.push(actId);
			queryDom2.push(partnumber);
		})
		getProgeress(obj, queryDom1.join(','), queryDom2.join(','))
	}

	function getProgeress(obj, grppurIds, partNumbers) {
		var callback = 'getProgress',
			url = juDomain + 'api/groupbuy/v2/queryGrppurSaleCount_' + grppurIds + '_' + partNumbers + '_' + callback + '.html';
		Util.getAjax(url, callback).done(function (res) {
			$(res.data).each(function (index, item) {
				var _this = $(obj).find('.list-content').eq(0).find('li[data-activityid="' + item.grppurId + '"]');				
				if (item.progressBar) {
					_this.find('.line').show().find('span').css('width', item.progressBar + 'px')
					if (item.progressBar < 90) {
						_this.find('.precent').show().find('i').html(item.progressBar)
					}else{
						_this.find('.precent').show().html('即将售罄')
					}
				}
			})

		})
	}
};
// 秒杀
index.newTwoMs = function () {
	lazyelem.listen('.new-two-ms', 'fn', function (obj) {
		var maxNum = 99;
		if ($(obj).find('.s-num') && $(obj).find('.s-num').attr('name') != '') {
			maxNum = $(obj).find('.s-num').attr('name');
		}

		if ($(obj).attr('data-tuijian') == 'true') {
			Util.getCity(function (cityId) {
				var callback = 'newTwoMs',
					url = rodsDomain + 'rods-web/route.jsonp?snTerminal=284000002001&apiCode=J0177&sceneCode=C2036&channelCode=1&callback=' + callback + '&u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId;
				$.ajax({
					url: url,
					dataType: 'json',
					timeout: 5000,
					success: function (res) {
						if (res && res.skus && res.skus.length > 2) {
							var itemList = res.skus.slice(0, 3),
								html = '',
								queryString = '',
								queryString2 = '',
								queryStringList = [],
								queryStringList2 = [],
								icon = '';

							if ($(obj).find('.s-icon') && $(obj).find('.s-icon').attr('name') != '') {
								icon = $(obj).find('.s-icon').attr('name');
							}

							$(itemList).each(function (index, item) {
								var activityId = item.extAttr && item.extAttr.activityId;
									partNumber = item.gdsCode,
									shopCode = item.shopCode,
									supplierCode = item.supplierCode,
									handwork = item.handwork,
									imgUrl = item.pictureUrl + '?format=200h_200w_4e',
									trickPoint = '',
									iconDom = '<img class="icon" src="' + icon + '" />',
									refpriceDom = parseFloat(item.price) < parseFloat(item.refPrice) ? '<span class="refprice"><i>¥</i><em>' + parseFloat(item.refPrice) + '</em></span>' : '<span class="refprice"></span>',
									saData = Util.json2String({
										'prdid': partNumber,
										'shopid': shopCode,
										'recvalue': handwork
									}).replace(/"/g, "'");

								queryStringList.push(activityId);
								queryStringList2.push(partNumber);

								var recShop = item.recGoodsType == 3 || item.recGoodsType == 5 ? supplierCode : shopCode;

								var dataObj = {
									picUrl: '',
									partNumber: partNumber,
									shopPicUrl: '/uimg/b2c/newcatentries/',
									vendorCode: recShop,
									linkType: '',
									trickPoint: trickPoint,
									linkUrl: ''
								};

								var jumpUrl = '//nmnode.suning.com/pc/brandBenefits.html?activityId1=' + activityId

								html += '<li data-activityId="' + activityId + '">' +
									'<a style="display:block;width:100%;height:100%;" name="" href="' + jumpUrl + '" target="_blank" sa-data="' + saData + '">' +
									'<img class="pro-pic" src="' + imgUrl + '" alt="">' +
									'<p class="name">' + item.gdsName + '</p>' +
									'<p class="price-box">' +
									iconDom +
									'<span class="price"><i>¥</i><em>' + item.price + '</em></span>' +
									refpriceDom +
									'</p>' +
									'<p class="sales-num"></p>' +
									'</a>' +
									'</li>'
							})
							queryString = queryStringList.join(',');
							queryString2 = queryStringList2.join(',');
							getSalesNum(queryString, queryString2, maxNum);
							$(obj).find('ul').html(html);
						} else {
							try {
								index.saYcFunc('sy-snmstjjk-2sjbz', 'C2036');
							} catch (error) {};
							if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
								$(obj).parents('.new-twoFloor').hide();
								return;
							}
							index.cmsShow(obj, true);
							var queryString = '',
								queryString2 = '',
								queryStringList = [],
								queryStringList2 = [];
							$(obj).find('.cms-good').each(function (index, item) {
								queryStringList.push($(item).attr('data-activityid'));
								queryStringList2.push($(item).attr('data-partnumber'));
							})
							queryString = queryStringList.join(',');
							queryString2 = queryStringList2.join(',');
							getSalesNum(queryString, queryString2, maxNum)
						}
					},
					error: function () {
						try {
							index.saYcFunc('sy-snmstjjk-2sjbz', 'C2036');
						} catch (error) {};
						if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
							$(obj).parents('.new-twoFloor').hide();
							return;
						}
						index.cmsShow(obj, true);
						var queryString = '',
							queryString2 = '',
							queryStringList = [],
							queryStringList2 = [];
						$(obj).find('.cms-good').each(function (index, item) {
							queryStringList.push($(item).attr('data-activityid'));
							queryStringList2.push($(item).attr('data-partnumber'));
						})
						queryString = queryStringList.join(',');
						queryString2 = queryStringList2.join(',');
						getSalesNum(queryString, queryString2, maxNum)
						
					}
				})
			});
		} else {
			if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
				$(obj).parents('.new-twoFloor').hide();
				return;
			}
			// index.cmsShow(obj, true);
			$(obj).find('.cms-good').show();
			lazyelem.listen($(obj).find("img[lazy-src]"), "img");
			lazyelem.detect();
			var queryString = '',
				queryString2 = '',
				queryStringList = [],
				queryStringList2 = [];
			$(obj).find('.cms-good').each(function (index, item) {
				queryStringList.push($(item).attr('data-activityid'));
				queryStringList2.push($(item).attr('data-partnumber'));
			})
			queryString = queryStringList.join(',');
			queryString2 = queryStringList2.join(',');
			getSalesNum(queryString, queryString2, maxNum)
		}

		function getSalesNum(queryString, queryString2, maxNum) {			
			var callback = 'salesNum' + new Date().getTime(),
				url = zsqDomain + 'api/groupbuy/v2/queryGrppurSaleCount_' + queryString + '_' + queryString2 + '_' + callback + '.html'
			$.ajax({
				url: url,
				dataType: 'jsonp',
				timeout: 10000,
				jsonpCallback: callback,
				success: function (res) {
					if (res && res.data) {
						$(res.data).each(function (index,item) {
							var num = Number(item.saleCount) < maxNum ? '爆卖中' : '月销' + item.saleCount + '件';
							var proItem = $(obj).find('li[data-activityid="' + item.grppurId + '"]');
							proItem.find('.sales-num').html(num);
							var ariaLabel = proItem.find('.name').text() + ' ' + Number(proItem.find('.price em').text()) + '元 ' + num;
							proItem.find('a').attr({
								'aria-label': ariaLabel,
								'title': ariaLabel
							})
						})
					}
				}
			})
		}
	});

}
// 领券
index.newTwoQuanInit = function () {
	lazyelem.listen('.new-two-quan', 'fn', function (obj) {
		if ($(obj).attr('data-tuijian') == 'true') {
			var callback = 'newTwoQuan',
				url = quanDomain + 'getRedPacketAct.do';
			$.ajax({
				url: url,
				dataType: 'jsonp',
				data: {
					channel: 1,
					sceneIds: '15-33',
					count: 10,
					supplement: 1
				},
				timeout: 10000,
				jsonpCallback: callback,
				success: function (data) {
					if (data && data.isSuccess == 1 && data.freeCouponList && data.freeCouponList.length && data.freeCouponList.length > 2) {

						var quanDom = [];

						$.each(data.freeCouponList, function (index, item) {
							if (index > 2) {
								return;
							}
							var picUrl = item.skuList && item.skuList[0] && item.skuList[0].whitePictureUrl,
								sugGoodsCode = item.skuList && item.skuList[0] && item.skuList[0].sugGoodsCode,
								vendorId = item.skuList && item.skuList[0] && item.skuList[0].vendorId,
								supplierCode = item.skuList && item.skuList[0] && item.skuList[0].supplierCode,
								productType = item.skuList && item.skuList[0] && item.skuList[0].productType,
								handwork = item.skuList && item.skuList[0] && item.skuList[0].handwork,
								recShop = productType == 3 || productType == 5 ? supplierCode : vendorId,
								linkUrl = item.pclink + '?sortId=' + SFE.base.productFomate.getRealPartNumber(sugGoodsCode) + '_' + recShop,
								saData = Util.json2String({
									'eletp': 'coupon',
									'activityid': item.actId,
									'recvalue': item.recValue
								}).replace(/"/g, "'"),
								saData2 = Util.json2String({
									'prdid': sugGoodsCode,
									'shopid': recShop,
									'recvalue': handwork
								}).replace(/"/g, "'");
							if(picUrl.indexOf('http:') > -1){
								picUrl = picUrl.replace('http:', '');
							}
							picUrl += '?format=200h_200w_4e';

							
							var labelDom = index == 0 ? '<span class="label1"></span>' : '<span class="label2"></span>';
							var ariaLabel = item.rewardsDesc + " " + item.actDesc + " 立即领取";

							quanDom.push('<li data-actId="' + item.actId + '" data-actKey="' + item.actKey + '">',
								labelDom,
								'<a tabindex="-1" class="left-area 123" target="_blank" href="' + linkUrl + '" name="" sa-data="' + saData2 + '" data-linkUrl="' + linkUrl + '">',
								'<img src="' + picUrl + '" alt="' + ariaLabel + '">',
								'</a>',
								'<a role="button" title="' + ariaLabel + '" aria-label="' + ariaLabel + '" class="left-area getNow" href="javascript:;" name="" sa-data="' + saData + '" data-linkUrl="' + linkUrl + '" >',
								'<div class="layer"></div>',
								'<p class="rule rule1">' + item.rewardsDesc + '</p>',
								'<p class="desc">' + item.actDesc + '</p>',
								'<i>立即领取</i>',
								'</a>',
								'</li>')

						})

						$(obj).find('ul').html(quanDom.join(''));
						index.getQuanFunc($(obj));

						// probeAuthStatus(function () {
						// 	$.each(data.freeCouponList, function (index, item) {
						// 		if (index > 2) {
						// 			return;
						// 		}
						// 		var picUrl = item.skuList && item.skuList[0] && item.skuList[0].whitePictureUrl,
						// 			sugGoodsCode = item.skuList && item.skuList[0] && item.skuList[0].sugGoodsCode,
						// 			vendorId = item.skuList && item.skuList[0] && item.skuList[0].vendorId,
						// 			supplierCode = item.skuList && item.skuList[0] && item.skuList[0].supplierCode,
						// 			productType = item.skuList && item.skuList[0] && item.skuList[0].productType,
						// 			handwork = item.skuList && item.skuList[0] && item.skuList[0].handwork,
						// 			recShop = productType == 3 || productType == 5 ? supplierCode : vendorId,
						// 			linkUrl = item.pclink + '?sortId=' + SFE.base.productFomate.getRealPartNumber(sugGoodsCode) + '_' + recShop,
						// 			saData = Util.json2String({
						// 				'eletp': 'coupon',
						// 				'activityid': item.actId,
						// 				'recvalue': item.recValue
						// 			}).replace(/"/g, "'"),
						// 			saData2 = Util.json2String({
						// 				'prdid': sugGoodsCode,
						// 				'shopid': recShop,
						// 				'recvalue': handwork
						// 			}).replace(/"/g, "'");
						// 		if(picUrl.indexOf('http:') > -1){
						// 			picUrl = picUrl.replace('http:', '');
						// 		}
						// 		picUrl += '?format=200h_200w_4e';

								
						// 		var labelDom = index == 0 ? '<span class="label1"></span>' : '<span class="label2"></span>';
						// 		var ariaLabel = item.rewardsDesc + " " + item.actDesc + " 立即领取";
	
						// 		quanDom.push('<li data-actId="' + item.actId + '" data-actKey="' + item.actKey + '">',
						// 			labelDom,
						// 			'<a tabindex="-1" class="left-area 123" target="_blank" href="' + linkUrl + '" name="" sa-data="' + saData2 + '" data-linkUrl="' + linkUrl + '">',
						// 			'<img src="' + picUrl + '" alt="' + ariaLabel + '">',
						// 			'</a>',
						// 			'<a role="button" title="' + ariaLabel + '" aria-label="' + ariaLabel + '" class="left-area getNow" href="javascript:;" name="" sa-data="' + saData + '" data-linkUrl="' + linkUrl + '" >',
						// 			'<div class="layer"></div>',
						// 			'<p class="rule rule1">' + item.rewardsDesc + '</p>',
						// 			'<p class="desc">' + item.actDesc + '</p>',
						// 			'<i>立即领取</i>',
						// 			'</a>',
						// 			'</li>')
	
						// 	})
	
						// 	$(obj).find('ul').html(quanDom.join(''));
						// 	index.getQuanFunc($(obj));
							
						// }, function () {
						// 	$.each(data.freeCouponList, function (index, item) {
						// 		if (index > 2) {
						// 			return;
						// 		}
						// 		var picUrl = item.skuList && item.skuList[0] && item.skuList[0].whitePictureUrl,
						// 			sugGoodsCode = item.skuList && item.skuList[0] && item.skuList[0].sugGoodsCode,
						// 			vendorId = item.skuList && item.skuList[0] && item.skuList[0].vendorId,
						// 			supplierCode = item.skuList && item.skuList[0] && item.skuList[0].supplierCode,
						// 			productType = item.skuList && item.skuList[0] && item.skuList[0].productType,
						// 			handwork = item.skuList && item.skuList[0] && item.skuList[0].handwork,
						// 			recShop = productType == 3 || productType == 5 ? supplierCode : vendorId,
						// 			linkUrl = item.pclink + '?sortId=' + SFE.base.productFomate.getRealPartNumber(sugGoodsCode) + '_' + recShop,
						// 			saData = Util.json2String({
						// 				'eletp': 'coupon',
						// 				'activityid': item.actId,
						// 				'recvalue': item.recValue
						// 			}).replace(/"/g, "'"),
						// 			saData2 = Util.json2String({
						// 				'prdid': sugGoodsCode,
						// 				'shopid': recShop,
						// 				'recvalue': handwork
						// 			}).replace(/"/g, "'");
						// 			if(picUrl.indexOf('http:') > -1){
						// 				picUrl = picUrl.replace('http:', '');
						// 			}

						// 		var obj = {
						// 			vendorCode: recShop,
						// 			partNumber: sugGoodsCode
						// 		}

						// 		var topLink = commodity.getUrl(obj);

						// 		var labelDom = index == 0 ? '<span class="label1"></span>' : '<span class="label2"></span>';
						// 		var ariaLabel = item.rewardsDesc + " " + item.actDesc + " 立即领取";

						// 		quanDom.push('<li data-actId="' + item.actId + '" data-actKey="' + item.actKey + '">',
						// 			labelDom,
						// 			'<a tabindex="-1" class="left-area" target="_blank" href="' + topLink + '" name="" sa-data="' + saData2 + '" data-linkUrl="' + linkUrl + '">',
						// 			'<img src="' + picUrl + '">',
						// 			'</a>',
						// 			'<a role="button" title="' + ariaLabel + '" aria-label="' + ariaLabel + '" class="left-area getNow" href="javascript:;" name="" sa-data="' + saData + '" data-linkUrl="' + linkUrl + '" >',
						// 			'<div class="layer"></div>',
						// 			'<p class="rule rule1">' + item.rewardsDesc + '</p>',
						// 			'<p class="desc">' + item.actDesc + '</p>',
						// 			'<i>立即领取</i>',
						// 			'</a>',
						// 			'</li>')

						// 	})

						// 	$(obj).find('ul').html(quanDom.join(''));
						// 	index.getQuanFunc($(obj));
						// })

					} else {
						try {
							index.saYcFunc('sy-lqzxtjjk-2sjbz', '15-33');
						} catch (error) {};
						if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
							$(obj).parents('.new-twoFloor').hide();
							return;
						}
						index.cmsShow(obj);
						$(obj).find('.cms-good').show();
						index.getQuanFunc($(obj));
					}

				},
				error: function () {
					try {
						index.saYcFunc('sy-lqzxtjjk-2sjbz', '15-33');
					} catch (error) {};
					if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
						$(obj).parents('.new-twoFloor').hide();
						return;
					}
					index.cmsShow(obj)
					$(obj).find('.cms-good').show();
					index.getQuanFunc($(obj));
				}
			})
		} else {
			if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
				$(obj).parents('.new-twoFloor').hide();
				return;
			}
			index.cmsShow(obj)
			$(obj).find('.cms-good').show();
			index.getQuanFunc($(obj));
		}
	});
}
index.getQuanFunc = function (obj) {

	obj.find('li .getNow').on('click', function () {
		var self = $(this),
			item = self.parents('li'),
			actId = item.attr('data-actId'),
			actKey = item.attr('data-actKey');
		ensureLogin(function () {
			Util.getCity(function (cityId) {
				var paramObj = {
					"actId": actId,
					"actKey": actKey,
					"cityId": cityId,
					"sourceId": 9231,
					"callerCode": 1362
				}
				coupon.receive.receiveCoupon(paramObj, function (data) {
					if (navigator.userAgent.indexOf("Firefox") > 0 && window.needScale) {
						if (window.isScaled) {
							$('.m-dialog') && $('.m-dialog').css('top', $(window).scrollTop() + 50 + 'px');
						} 

					}

					if (data.resultCode == 0) {
						self.addClass('gotten');
						self.find('i').html('立即使用');
						self.unbind().attr({
							'href': self.attr('data-linkUrl'),
							'target': '_blank',
							'title': self.find('.rule').text() + ' ' + self.find('.desc').text() + ' 立即使用',
							'aria-label': self.find('.rule').text() + ' ' + self.find('.desc').text() + ' 立即使用'
						})
					}
				}, self, '首页')

			})
		}, passport_config);

		if (window.needScale && navigator.userAgent.indexOf("Firefox") > 0) {
			if (window.isScaled) {
				$('#iframeLogin') && $('#iframeLogin').css('top', $(window).scrollTop() - 100 + 'px');
			}
		}

	});

};
// 排行榜
index.newTwoPhb = function () {
	lazyelem.listen('.new-two-phb', 'fn', function (obj) {
		var labelPic = [],
			labelNameObj = {},
			font = {
				color: [],
				icon: []
			};

		labelInit()
		if ($(obj).attr('data-tuijian') == 'true') {
			Util.getCity(function (cityId) {
				var callback = 'newTwoPhb',
					url = tuijianDomain + '/recommend-portal/dyBase.jsonp?u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId + '&sceneIds=31-42&count=9&num=3&parameter=66601&storeCode=&merchantCode=&channelType=&delivery=&sceneCode=&snTerminal=284000002001';
				Util.getAjax(url, callback).done(function (res) {
					if (res && res.sugGoods && res.sugGoods[0] && res.sugGoods[0].list && res.sugGoods[0].list.length > 2) {
						var dom = [],
							newList = [];
						if (res.sugGoods[0].list[0] && hasSkus(res.sugGoods[0].list[0]) && res.sugGoods[0].list[1].list[0] && hasSkus(res.sugGoods[0].list[1].list[0]) && res.sugGoods[0].list[2] && hasSkus(res.sugGoods[0].list[2])) {
							newList.push(res.sugGoods[0].list[0],res.sugGoods[0].list[1].list[0], res.sugGoods[0].list[2])
						}
						if (res.sugGoods[0].list[5] && hasSkus(res.sugGoods[0].list[5]) && res.sugGoods[0].list[1].list[1] && hasSkus(res.sugGoods[0].list[1].list[1]) && res.sugGoods[0].list[3] && hasSkus(res.sugGoods[0].list[3])) {
							newList.push(res.sugGoods[0].list[5], res.sugGoods[0].list[1].list[1], res.sugGoods[0].list[3])
						}
						if (res.sugGoods[0].list[6] && hasSkus(res.sugGoods[0].list[6]) && res.sugGoods[0].list[1].list[2] && hasSkus(res.sugGoods[0].list[1].list[2]) && res.sugGoods[0].list[4] && hasSkus(res.sugGoods[0].list[4])) {
							newList.push(res.sugGoods[0].list[6], res.sugGoods[0].list[1].list[2], res.sugGoods[0].list[4])
						}	
						
						function hasSkus(obj){
							return obj.skus && obj.skus.length > 0
						}

						var len = newList.length;
						$.each(newList, function (index, item) {
							if (index >= len) {
								return;
							}
							
							var name = item.labelName,
								desc = item.multiDepiction,
								labelCode = item.labelCode,
								labelType = item.labelType,
								labelName = labelNameObj[labelType] ? labelNameObj[labelType] : '人气榜',
								proItem = item.skus && pro(item.skus),
								picurl = proItem.whitePictureUrl || proItem.pictureUrl,
								productCode = proItem.sugGoodsCode,
								productName = proItem.sugGoodsName,
								supplierCode = proItem.supplierCode,
								price = proItem.price,
								productType = proItem.productType,
								shopCode = proItem.shopCode,
								handwork = proItem.handwork,
								searchIndex = index % 3,
								labelBg = labelPic[searchIndex],
								descColor = font.color[searchIndex],
								descIcon = font.icon[searchIndex],
								saData = Util.json2String({
									'prdid': productCode,
									'shopid': shopCode,
									'recvalue': handwork
								}).replace(/"/g, "'"),
								saDataText = Util.json2String({
									'recvalue': handwork
								}).replace(/"/g, "'");

							picurl += '?format=200h_200w_4e';

							function pro(skus){
								if (skus[0] && skus[0].whitePictureUrl && skus[0].whitePictureUrl != '' && skus[0].pictureUrl && skus[0].pictureUrl!='') {
									return skus[0]
								}else{
									return skus[1]
								}
							}

							var preLink = '//phb.suning.com/bdIndex.html';

							var jumpUrl = preLink + '?supplierCode=' + supplierCode + '&productCode=' + productCode + '&productType=' + productType + '&shopCode=' + shopCode + '&pictureUrl=' + encodeURIComponent(picurl) + '&productName=' + encodeURIComponent(productName) + '&price=' + price + '&handwork=' + encodeURIComponent(handwork) + '&catalogueName=' + encodeURIComponent(name) + '&catalogueId=' + labelCode + '&labelType=' + labelType;

							var airaLabel = labelName + ' ' + name + ' ' + desc;

							var html = '<li >' +
									'<div class="label">' +
										'<img src="' + labelBg + '" alt="" />' +
										'<p>' + labelName + '</p>' +
									'</div>' +
									'<a tabindex="0" aria-label="' + airaLabel + '" title="' + airaLabel + '" href="' + jumpUrl + '" target="_blank" sa-data="' + saData + '">' +
										'<img class="main-pic" src="' + picurl + '">' +
										'<p class="name">' + name + '</p>' +
										'<p class="desc" ><span style="color: ' + descColor + '"><img class="icon" src="' + descIcon + '" />' + desc + '</span></p>' +
									'</a>' +
								'</li>'
							dom.push(html)
						});
						if (dom.length > 0) {
							$('.new-two-phb ul').html(dom.join(''));
							if($('.new-two-phb ul').find('li').length > 3){
								phbLoop();
								$('.new-two-phb').find('ul').eq(1) && $('.new-two-phb').find('ul').eq(1).find('a').attr('tabindex', '-1')
							}
						}else{
							index.cmsShow(obj);
							cmsLabelInit(obj);
						}
					} else {
						try {
							index.saYcFunc('sy-tjbdtjjk-2sjbz', '31-42');
						} catch (error) {};
						if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
							$(obj).parents('.new-twoFloor').hide();
							return;
						}
						index.cmsShow(obj);
						cmsLabelInit(obj);
					}
				}).fail(function () {
					try {
						index.saYcFunc('sy-tjbdtjjk-2sjbz', '31-42');
					} catch (error) {};
					if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
						$(obj).parents('.new-twoFloor').hide();
						return;
					}
					index.cmsShow(obj);
					cmsLabelInit(obj);
				})

			});
		} else {
			if ($(obj).find('.cms-good') && $(obj).find('.cms-good').length < 3) {
				$(obj).parents('.new-twoFloor').hide();
				return;
			}
			index.cmsShow(obj);
			cmsLabelInit(obj);
		}

		function cmsLabelInit(obj){				
			$(obj).find('.cms-good').each(function(index, item){
				var labelType=$(item).attr('data-labeltype');
				var searchIndex = index % 3,
					labelBg = labelPic[searchIndex],
					descColor = font.color[searchIndex],
					descIcon = font.icon[searchIndex];
				var curItem = $(item);
				var html1 = '<img src="' + labelBg + '" />' + '<p>' + labelType + '</p>';
				var html2 = '<img class="icon" src="' + descIcon + '" />';
				curItem.find('.label').html(html1);
				curItem.find('.desc span').css('color', descColor).prepend(html2);
			});

			
		}

		function labelInit() {
			$(obj).find('.label-img').each(function (index, item) {
				var labelImg = $(item).attr('name');
				labelPic[index] = labelImg
			})

			$(obj).find('.label-name').each(function (index, item) {
				var name = $(item).attr('name'),
					value = $(item).attr('data-label');
				labelNameObj[name] = value
			})

			$(obj).find('.color').each(function (index, item) {
				var value = $(item).attr('name');
				font.color[index] = value
			})

			$(obj).find('.b-img').each(function (index, item) {
				var value = $(item).attr('name');
				font.icon[index] = value
			})
		}

		function phbLoop() {
			var loop = new Util.verticalLoop(".new-two-phb .content-box", {
				mouseOverDelay: 200,
				duration: 1000,
				height: 244,
				delay: 3000
			})
		}
	});
};
// 直播
index.newTwoZhibo = function () {
	lazyelem.listen(".new-two-zhibo", 'fn', function (obj) {
		var callback = 'newZhibo',
			url = cmsLibDomain + '/scms/api/app/jsonp/pczhibo-' + callback + '.jsonp';
		Util.getAjax(url, callback).done(function(res){
			if (res && res.data && res.data[0] && res.data[0].tag) {
				$(res.data[0].tag).each(function(index,item){
					if (item.extMap && item.extMap.kzb && item.extMap.kzb == 'snzb') {
						_main(item.extMap)
					}
				})
			}else{
				try {
					index.saYcFunc('sy-snzblibjk-2sjbz');
				} catch (error) {};
				$(obj).parents('.new-twoFloor').hide();
			}
		}).fail(function(){
			try {
				index.saYcFunc('sy-snzblibjk-2sjbz');
			} catch (error) {};
		})
		function _main(info){
			if(info.erweima.indexOf('http:') > -1){
				info.erweima = info.erweima.replace('http:', '');
			}
			$(obj).find('.title .code img').attr('src', info.erweima);

			var name1 = info.subta && info.subta != '' ? '<p class="name" style="color: ' + info.zbwa + '">' + info.subta + '</p>' : '',
				name2 = info.subtb && info.subtb != '' ? '<p class="name" style="color: ' + info.zbwa + '">' + info.subtb + '</p>' : '',
				name3 = info.subtc && info.subtc != '' ? '<p class="name" style="color: ' + info.zbwa + '">' + info.subtc + '</p>' : '';
				
			

			var html = '<li class="code-box"><a tabindex="-1" href="javascript:;" name="">' +
				'<img class="pic1" src="' + info.zbxta + '" alt="">' +
				name1+
				'<img class="icon" src="' + info.nicon + '" />' +
				'<div class="code">' +
				'<img src="' + info.erweima + '" alt="">' +
				'<p>手机苏宁扫一扫</p>' +
				'</div>' +
				'</a></li>' +
				'<li class="code-box"><a tabindex="-1" href="javascript:;" name="">' +
				'<img class="pic1" src="' + info.zbxtb + '" alt="">' +
			  name2+
				'<img class="icon" src="' + info.nicon + '" />' +
				'<div class="code">' +
				'<img src="' + info.erweima + '" alt="">' +
				'<p>手机苏宁扫一扫</p>' +
				'</div>' +
				'</a></li>' +
				'<li class="code-box"><a tabindex="-1" href="javascript:;" name="">' +
				'<img class="pic1" src="' + info.zbxtc + '" alt="">' +
				name3+
				'<img class="icon" src="' + info.nicon + '" />' +
				'<div class="code">' +
				'<img src="' + info.erweima + '" alt="">' +
				'<p>手机苏宁扫一扫</p>' +
				'</div>' +
				'</a></li>';

			$(obj).find('.content-box ul').html(html);
			codeInit(obj);
		}
		function codeInit(obj){
			index.floorCode(obj);
			$(obj).find('.code-box').hover(function () {
				$(this).find('.code').show()
			}, function () {
				$(this).find('.code').hide()
			})
		}
	})
}
// 拼购
index.newTwoPg = function () {
	lazyelem.listen(".new-two-pingou", 'fn', function (obj) {
		if ($(obj).attr('data-tuijian') == 'true') {
			Util.getCity(function (cityId) {
				var callback = 'newTwoPg',
					url = rodsDomain + 'rods-web/route.jsonp?snTerminal=284000002001&apiCode=J0184&sceneCode=C0049&channelCode=2&callback=' + callback + '&u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId;
				Util.getAjaxJson(url).done(function(res){
					if (res && res.skus && res.skus.length > 2) {
						var list = res.skus.slice(0, 9);
						var html = '';
						$(list).each(function (index, item) {
							var pictureUrl = item.pictureUrl + '?format=200h_200w_4e',
								price = item.pgPrice,
								pgNum = item.extAttr && item.extAttr.saledStore,
								isOrigin = item.extAttr && item.extAttr.orign && (item.extAttr.orign == 6 || item.extAttr.orign == 12),
								actId = item.extAttr && item.extAttr.activityId,
								partNumber = item.generalCode,
								shopCode =item.shopCode,
								// url = isOrigin ? pinDomain + '/pgs/product/' + shopCode + '/' + partNumber + '.html' + '?adTypeCode=1214&adId=' + shopCode + '_' + partNumber : pinDomain + '/pgs/product/' + actId + '.html' + '?adTypeCode=1165&adId=' + actId,
								url = isOrigin ? pinDomain + "/pgs/product/" + shopCode + "/" + partNumber + '.html?adTypeCode=1214&adId=' + shopCode + '_' + partNumber + '&page=/packageB/pages/pingou/fourth/fourth/fourth?storeId=' + partNumber + '%26shopId=' + shopCode : pinDomain + "/pgs/product/" + actId + '.html?adTypeCode=1165&adId=' + actId + '&page=/packageB/pages/pingou/fourth/fourth/fourth?actId=' + actId,
								utmList = ['pingou-keng1A', 'pingou-keng1B','pingou-keng1C','pingou-keng2A','pingou-keng2B','pingou-keng2C','pingou-keng3A','pingou-keng3B','pingou-keng3C'];
								var codeImgUrl = '';
								genShortUrl('https:' + url + '&utm_source=homepagev8&utm_medium=' + utmList[index], partNumber).done(function(shortUrl){
									codeImgUrl = genCode(shortUrl);
										$(obj).find('.content-box ul li').eq(index).attr('data-src', shortUrl);
								}).fail(function(){
									codeImgUrl = genCode(window.location.protocol + url + '&utm_source=homepagev8&utm_medium=' + utmList[index]);	
								}).always(function(){
									$(obj).find('.content-box ul li').eq(index).find('.code img').attr('lazy-src', codeImgUrl);
								})
							html += '<li class="code-box" style="margin-bottom: 20px"><a tabindex="-1" href="javascript:;" name="">' +
								'<img src="' + pictureUrl + '" />' +
								'<p class="price-box"><span class="price"><i>¥</i><em>' + price + '</em></span><span class="nums">已拼' + pgNum + '件</span></p>' +
								'<div class="code">' +
								'<img lazy-src="' + codeImgUrl + '" alt="">' +
								'<p>扫一扫 看优惠</p>' +
								'</div>' +
								'</a></li>';

						});
						$(obj).find('.content-box ul').html(html);


						if ($(obj).find('.content-box ul li').length > 3) {
							var loop = new Util.verticalLoop(".new-two-pingou .content-box", {
								mouseOverDelay: 200,
								duration: 1000,
								height: 210,
								delay: 3000
							})
						}

						index.floorCode(obj);

						$(obj).find('.code-box').hover(function () {
							$(this).find('.code').show();
							lazyelem.listen($(this).find("img[lazy-src]"), "img");
							lazyelem.detect();
						}, function () {
							$(this).find('.code').hide()
						})
					} else {
						try {
							index.saYcFunc('sy-snpgtjjk-2sjbz', 'C0049');
						} catch (error) {};
						if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
							$(obj).parents('.new-twoFloor').hide();
							return;
						}
						cmsHandle(obj);
					}
				}).fail(function(){
					try {
						index.saYcFunc('sy-snpgtjjk-2sjbz', 'C0049');
					} catch (error) {};
					if($(obj).find('.cms-good')&&$(obj).find('.cms-good').length < 3){
						$(obj).parents('.new-twoFloor').hide();
						return;
					}
					cmsHandle(obj);
				})
			})
		}else{
			if($(obj).find('.cms-good') && $(obj).find('.cms-good').length < 3){
				$(obj).parents('.new-twoFloor').hide();
				return;
			}
			cmsHandle(obj);
		}
		// 生成二维码，返回的直接是二维码图片地址
		function genCode(longUrl) {
			longUrl = text(longUrl);
			var bizCode = 'l9sbQJ';
			var url = codeDomain + '/pc/build.do?longUrl=' + longUrl + '&bizCode=' + bizCode + '&logo=&flag=1';
			
			return url
		}
		// 生成短连接
		function genShortUrl(longUrl, partNumber) {
			longUrl = encodeURIComponent(longUrl);
			var bizCode = 230;
			var url = pduaDomain + '/pd/build.do?longUrl=' + longUrl + '&bizCode=' + bizCode + '&callBack=shortUrlCb' + partNumber;
			var dfd = $.Deferred();
			Util.getAjax(url, 'shortUrlCb' + partNumber).done(function(res){
				if(res && res.code == 1 && res.data){
					dfd.resolve(res.data);
				}else{
					dfd.reject()
				}
			}).fail(function(){
				dfd.reject()
			})
			return dfd.promise();
		}
		// 对地址编码
		function text(str) {
			var strRes = '';
			if (null != str && '' != str.replace(/^\s*|\s*$/, '')) {
				for (var i = 0, j = str.length; i < j; i++) {
					strRes += str.charCodeAt(i).toString(16);
				}
			}
			return strRes;
		}

		function cmsHandle() {
			$(obj).find('.cms-good').each(function (index, item) {
	
				var isOrigin = $(item).attr('data-isOrigin') && ($(item).attr('data-isOrigin') == 6 || $(item).attr('data-isOrigin') == 12),
					actId = $(item).attr('data-activity'),
					partNumber = $(item).attr('data-partnumber'),
					shopCode = $(item).attr('data-vendorcode'),
					url = isOrigin ? pinDomain + "/pgs/product/" + shopCode + "/" + partNumber + '.html?adTypeCode=1214&adId=' + shopCode + '_' + partNumber + '&page=/packageB/pages/pingou/fourth/fourth/fourth?storeId=' + partNumber + '%26shopId=' + shopCode : pinDomain + "/pgs/product/" + actId + '.html?adTypeCode=1165&adId=' + actId + '&page=/packageB/pages/pingou/fourth/fourth/fourth?actId=' + actId,
					codeImgUrl = genCode(window.location.protocol + url);
					var codeImgUrl = '';
					genShortUrl('https:' + url, partNumber).done(function(shortUrl){
						codeImgUrl = genCode(shortUrl);
						$(item).attr('data-src', shortUrl)
					}).fail(function(){
						codeImgUrl = genCode(window.location.protocol + url);	
					}).always(function(){
						$(item).find('.code img').attr('lazy-src', codeImgUrl);
					})
				
			});

			$(obj).find('.cms-good').show();
			if ($(obj).find('.content-box ul li').length > 3) {
				var loop = new Util.verticalLoop(".new-two-pingou .content-box", {
					mouseOverDelay: 200,
					duration: 1000,
					height: 210,
					delay: 3000
				})
			}
			index.floorCode(obj);
			$(obj).find('.code-box').hover(function () {
				$(this).find('.code').show();
				lazyelem.listen($(this).find("img[lazy-src]"), "img");
				lazyelem.detect();
			}, function () {
				$(this).find('.code').hide()
			})
		}
	})
}
// 频道广场
index.newGround = function () {
	lazyelem.listen(".new-channel-ground", 'fn', function (obj) {
		if ($(obj).attr('data-tuijian') == 'true') {
			Util.getCity(function (cityId) {
				getNewGround();

				function getNewGround() {
					var url = rodsDomain + 'rods-web/route.jsonp?snTerminal=284000002001&apiCode=J0175&sceneCode=C2029&channelCode=1&u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId;
					Util.getAjaxJson(url).done(function(res){						
						if (res && res.skus && res.skus.length >= 6) {
							var list = res.skus,
								len = list.length,
								count=0,
								htmlDom=[];

							for (var i = 0; i < len; i++) {								
								var item = res.skus[i],
									categoryCode = item.categoryCode,
									categoryName = item.categoryName,
									categoryDesc = item.categoryDesc,
									jumpUrl = item.categoryUrl;

								if (categoryName !== '') {
									
									;
									(function (categoryCode, categoryName, categoryDesc, jumpUrl) {
										getProDom(categoryCode, jumpUrl).then(function (dom, link, saData) {
											count++;
											var html = '<div class="channel-box">' +
												'<a tabindex="0" title="' + categoryName + ' ' + categoryDesc + '" class="title" target="_blank" href="' + link + '" sa-data="' + saData + '">' +
												'<p class="text">' + categoryName + '</p>' +
												'<p class="sub-text">' + categoryDesc + '</p>' +
												'</a>' +
												dom +
												'</div>';
											htmlDom.push(html);
											if (htmlDom.length == 6) {
												$(obj).find('.channel-wrap').html(htmlDom.join(''));
												$(obj).find('.channel-box').show();
											}
											if(count == 12 && htmlDom.length < 6){
												$(obj).find('.channel-box').show();
											}
										}).fail(function () {
											count++;
											if (count == 12 && htmlDom.length < 6) {
												$(obj).find('.channel-box').show();
											}
										})
									})(categoryCode, categoryName, categoryDesc, jumpUrl)
								} else {
									continue;
								}
							}
						} else {
							try {
								index.saYcFunc('sy-pdgclmtjjk-2sjbz', 'C2029');
							} catch (error) {};
							$(obj).find('.channel-box').show();
						}
					}).fail(function(){
						try {
							index.saYcFunc('sy-pdgclmtjjk-2sjbz', 'C2029');
						} catch (error) {};
						$(obj).find('.channel-box').show();
					})
					
				}

				function getProDom(categoryCode, jumpUrl) {
					var dfd = $.Deferred();

					var url = rodsDomain + 'rods-web/route.jsonp?apiCode=J0176&sceneCode=C2029&channelCode=1&u=' + index.uID + '&c=' + index.cID + '&cityId=' + cityId + '&categoryCode=' + categoryCode,
						dom = '';
					Util.getAjaxJson(url).done(function(res){
						if (res && res.skus && res.skus.length > 1) {
							var item1 = res.skus[0],
								pictureUrl1 = item1.pictureUrl + '?format=200h_200w_4e',
								partNumber1 = item1.gdsCode,
								shopCode1 = item1.shopCode,
								supplierCode1 = item1.supplierCode,
								productType1 = item1.productType,
								price1 = item1.price,
								refPrice1 = item1.refPrice,
								name1 = item1.gdsName,
								handwork1= item1.handwork,
								linkUrl1 = jumpUrl + '?supplierCode=' + supplierCode1 + '&productCode=' + partNumber1 + '&productType=' + productType1 + '&shopCode=' + shopCode1 + '&pictureUrl=' + encodeURIComponent(pictureUrl1) + '&productName=' + encodeURIComponent(name1) + '&price=' + price1 + '&refPrice='+refPrice1+'&handwork=' + handwork1,
								item2 = res.skus[1],
								pictureUrl2 = item2.pictureUrl + '?format=200h_200w_4e',
								partNumber2 = item2.gdsCode,
								shopCode2 = item2.shopCode,
								supplierCode2 = item2.supplierCode,
								productType2 = item2.productType,
								price2 = item2.price,
								refPrice2 = item2.refPrice,
								name2 = item2.gdsName,
								handwork2= item2.handwork,
								linkUrl2 = jumpUrl + '?supplierCode=' + supplierCode2 + '&productCode=' + partNumber2 + '&productType=' + productType2 + '&shopCode=' + shopCode2 + '&pictureUrl=' + encodeURIComponent(pictureUrl2) + '&productName=' + encodeURIComponent(name2) + '&price=' + price2 + '&refPrice='+refPrice2+'&handwork=' + handwork2,
								saData1 = Util.json2String({
									'prdid': partNumber1,
									'shopid': shopCode1,
									'recvalue': handwork1
								}).replace(/"/g, "'"),
								saData2 = Util.json2String({
									'prdid': partNumber2,
									'shopid': shopCode2,
									'recvalue': handwork2
								}).replace(/"/g, "'")


							dom += '<div class="content">' +
								'<a tabindex="-1" href="' + linkUrl1 + '" target="_blank" sa-data="'+saData1+'">' +
								'<img src="' + pictureUrl1 + '" alt="' + name1 + '">' +
								'</a>' +
								'<a tabindex="-1"  href="' + linkUrl2 + '" target="_blank" sa-data="'+saData2+'">' +
								'<img src="' + pictureUrl2 + '" alt="' + name2 + '">' +
								'</a>' +
								'</div>'
							dfd.resolve(dom, linkUrl1, saData1)
						} else {
							dfd.reject()
						}
					}).fail(function(){
						dfd.reject()
					})

					return dfd.promise()
				}
			});
		}else{
			$(obj).find('.channel-box').show();
		}
	})
}
// 猜你喜欢
index.labelAjaxIndex = 0;
index.newRecTab = function () {
	lazyelem.listen(".new-rec-tab", 'fn', function (obj) {
		var labelDom = [];
		if ($(obj).attr('data-tuijian') == 'true') {
			Util.getCity(function (cityId) {
				var prev = new Date().getTime(),
					curTabIndex = 0, 
					isLoading =false,
					isScrolling = false;

				// 第一个精选tab
				function initFirstTabCont() {
					if ($(obj).find('.tab-nav .cur').attr('data-get') == 'true') {
						return;
					}
					var streetCode = Util.getCookie('streetCode') ? Util.getCookie('streetCode') : '',
						url = fmDomain + '/api/getPcIndexProTag.do?u=' + index.uID + '&c=' + index.cID + '&cityCode=' + cityId + '&districtCode=' + streetCode + '&sceneIds=12-14&sceneIds2=12-14&count=100&count2=4&flag=1&channel=322&terminal=pc&snTerminal=284000002001';
					Util.getAjax(url, 'recommandTab').done(function (res) {
						if (res && res.data && res.data.sugGoods && res.data.sugGoods[0]) {
							if (res.data.sugGoods[0]['resCode'] == '01' || res.data.sugGoods[0]['resCode'] == '03') {
								if (res.data.sugGoods[0]['skus'].length < 15 || !Util.isArrayFn(res.data.sugGoods[0]['skus'])) {
									index.cmsShow($(obj).find('.tab-content').eq(0), false);
								} else {
									$(obj).find('.tab-nav li').eq(0).attr('data-get', 'true')
									initFirstPageCont(res.data.sugGoods[0]['skus'], 0);
								}
							} else {
								index.cmsShow($(obj).find('.tab-content').eq(0), false);
							}
						} else {
							try {
								index.saYcFunc('sy-cnxhjxhbjk-2sjbz', '12-14');
							} catch (error) {};
							index.cmsShow($(obj).find('.tab-content').eq(0), false);
						}
						lazyelem.detect();
					}).fail(function () {
						try {
							index.saYcFunc('sy-cnxhjxhbjk-2sjbz', '12-14');
						} catch (error) {};
						index.cmsShow($(obj).find('.tab-content').eq(0), false);
					})

				}
				initFirstTabCont();

				// 后面类目及类目下商品
				function filterOtherTabs() {
					var streetCode = Util.getCookie('streetCode') ? Util.getCookie('streetCode') : '',
						// 要改成3241
						url = fmDomain + '/gw/pcGuessLikeTab.do?tabParameter=3241&u=' + index.uID + '&c=' + index.cID + '&districtCode=' + streetCode + '&cityId=' + cityId + '&flag=1',
						callback = 'pcGuessLikeTab' + new Date().getTime();

					var dfd = $.Deferred()

					Util.getAjax(url, callback).done(function (res) {
						if (res && res.code && res.code == '1' && res.data && res.data.length > 0) {
							// 每个分类如果商品数小于40就从数据中删除
							var arr = [];
							$(res.data).each(function (index, item) {
								if (item.skus && item.skus.length < 20) return;
								arr.push(item)
							})
							if (arr.length > 0) {
								dfd.resolve(arr)
							} else {
								dfd.reject()
							}
						} else {
							dfd.reject()
						}
					}).fail(function () {
						dfd.reject()
					})
					return dfd.promise()
				}

				// 其他tab获取数据并过滤
				filterOtherTabs().done(function(arr){
					initTabNav(arr).done(function (html) {
						$(obj).find('.tab-nav ul').append(html);
						// 样式修改
						var navLen = $(obj).find('.tab-nav li').length;
						$(window).resize(function () {
							if (document.documentElement.clientWidth < 1200 || window.isScaled) {
								$(obj).find('.tab-nav li').css('width', 944 / navLen);
							} else {
								$(obj).find('.tab-nav li').css('width', 1190 / navLen);
							}
						})
						if (document.documentElement.clientWidth < 1200 || window.isScaled) {
							$(obj).find('.tab-nav li').css('width', 944 / navLen);
						} else {
							$(obj).find('.tab-nav li').css('width', 1190 / navLen);
						}

						$(obj).find('.tab-nav').show();
						//增加tab切功能
						var opt = {
							container: $(obj),
							tabNav: $(obj).find('.tab-nav li'),
							tabCont: $(obj).find('.tab-content'),
							contClassName: 'tab-content'
						}
						index.tabSwitch(opt, handleFun);

						var offsetTop = $('.new-rec-tab').offset().top;
						var scrollTop = offsetTop - 100 + 'px';
						var timer1 = null;

						function handleFun() {
							clearTimeout(timer1);
							timer1 = setTimeout(function () {
								$("html, body").stop(true).animate({
									scrollTop: scrollTop
								}, '300', function () {
									isLoading = false;
									curTabIndex = $(obj).find('.tab-nav .cur').index();
									$(obj).find('.tab-nav').removeClass('fixed')
								});
							}, 0);
						}

						$(window).scroll(function () {
							throttle(fixTabNav, 200)()
						})

						function throttle(fn, delay) {
							return function () {
								var ctx = this;
								var args = arguments;
								var now = new Date().getTime();
								if (now - prev >= delay) {
									fn.apply(ctx, args);
									prev = new Date().getTime();
								}
							}
						}

						function fixTabNav() {
							var top = $(obj).offset().top,
								scrollTop = $(window).scrollTop();
							if (scrollTop > top) {
								$(obj).find('.tab-nav').addClass('fixed');
							} else {
								$(obj).find('.tab-nav').removeClass('fixed');
							}
						}
					}).fail(function () {
						console.log('tab导航数据不足');
					})

					initTabCont(arr);

					//猜你喜欢分类tab
					function initTabNav(list) {
						var dfd = $.Deferred(),
							html = '';

						$(list).each(function (index, item) {
							var labelList = item.pictureUrl.split(','),
								labelDom = '';

							if (labelList.length = 2) {
								var picUrl1 = labelList[0];
								if(picUrl1.indexOf('http:') > -1){
									picUrl1 = picUrl1.replace('http:', '');
								}
								var picUrl2 = labelList[1];
								if(picUrl2.indexOf('http:') > -1){
									picUrl2 = picUrl2.replace('http:', '');
								}
								labelDom = '<img class="label label1" src="' + picUrl1 + '"></img>' + '<img class="label label2" src="' + picUrl2 + '"></img>'
							}

							html += '<li role="tab" tabindex="-1" aria-label="' + item.catalogueName + ' ' + item.promotionDoc + '" data-cateId="' + item.catalogueId + '">' +
								'<p class="text">' +
								labelDom +
								'<span>' + item.catalogueName + '</span></p>' +
								'<p><span class="sub-text">' + item.promotionDoc + '</span></p>' +
								'</li>'
						})

						if (html !== '') {
							dfd.resolve(html)
						} else {
							dfd.reject()
						}

						return dfd.promise()
					}
					// 猜你喜欢分类tab下内容
					function initTabCont(list) {
						$(list).each(function (index, item) {
							$(obj).find('.tab-content').eq(index + 1).attr({
								'data-catalogueid': item.catalogueId,
								'data-pagenum': 1,
							});
							initFirstPageCont(item.skus, index + 1, item.catalogueId);
						})
					}

				}).fail(function(){
					//其他tab初始化数据失败
				});

				// 生产html片段并且放入对tab-content
				function initFirstPageCont(skus, index, catalogueId) {
					var html = genGoodsHtml(skus, index);

					if (index > 0) {
						html += '<div class="loading-next"></div>';
					}
					// 将商品对应的html加入到页面
					var $curContBox = $(obj).find('.tab-content').eq(index);
					$curContBox.find('ul').html(html);
					lazyelem.listen($(obj).find("img[lazy-src]"), "img");
					lazyelem.detect();
				}

				//返回商品代码片段
				function genGoodsHtml(skus, index) {
					var html = '',
						skusArr = skus,
						skusLen = skus.length;
							
					skusLen = (skusLen - skusLen % 20) > 0 ? skusLen - skusLen % 20 : 0;

					for (var i = 0; i < skusLen; i++) {
						var promotionHtml = '';

						if (skusArr[i]['promotionInfo'] != "") {
							promotionHtml += '<span>' + skusArr[i]['promotionInfo'] + '</span>';
						}
						if (skusArr[i].shoppingAllowance && skusArr[i].shoppingAllowance !== '') {
							promotionHtml += '<span class="allowance" style="height:14px;background:#fff;border:1px solid #f40;color:#f40;line-height:14px;padding:0 3px 0 0;text-align:center;"><em style="float:left;height:14px;margin-right:3px;padding:0 2px;background:#f40;color:#fff;">补贴</em>' + skusArr[i].shoppingAllowance + '</span>';
						}
						if (skusArr[i].promotionList && skusArr[i].promotionList.length > 0) {
							var len = 0;
							if (skusArr[i].shoppingAllowance && skusArr[i].shoppingAllowance !== '') {
								len = skusArr[i].promotionList.length > 1 ? 1 : skusArr[i].promotionList.length;
							} else {
								len = skusArr[i].promotionList.length > 2 ? 2 : skusArr[i].promotionList.length;
							}
							for (var z = 0; z < len; z++) {
								promotionHtml += '<span>' + skusArr[i].promotionList[z].simple + '</span>';
							}

						}

						var goodId = skusArr[i]['sugGoodsId'],
							partNumber = skusArr[i]['sugGoodsCode'], //18位商品编码
							vendorCode = skusArr[i]['vendorId'],
							supplierCode = skusArr[i]['supplierCode'],
							handwork = skusArr[i]['handwork'],
							priceType = skusArr[i]['priceType'],
							coopSecType = skusArr[i]['coopSecType'],
							specialType = skusArr[i]['specialType'],
							trickPoint = '',
							recShop = skusArr[i].productType == 3 || skusArr[i].productType == 5 ? skusArr[i].supplierCode : skusArr[i].shopCode,
							dataObj = {
								picUrl: '',
								partNumber: partNumber,
								shopPicUrl: '/uimg/b2c/newcatentries/',
								vendorCode: recShop,
								linkType: '',
								trickPoint: '',
								linkUrl: ''
							},
							saData = Util.json2String({
								'prdid': skusArr[i].sugGoodsCode,
								'shopid': skusArr[i].shopCode,
								'recvalue': handwork
							}).replace(/"/g, "'"),
							productType = skusArr[i]['productType'],
							price = skusArr[i]['price'],
							refPriceDom = skusArr[i]['refPrice'] && skusArr[i]['refPrice'] != '' && parseInt(skusArr[i]['refPrice']) > parseInt(price) ? '<i>¥</i><em>' + skusArr[i]['refPrice'] + '</em>' : '';

						var ariaLabel = productType == '1' || productType == '3' || (productType == '2' && coopSecType == 'A4') || productType == '4' || productType == '5' || productType == '7' ? '自营 ' : '';
						ariaLabel += skusArr[i]['sugGoodsName'] + ' ';
						if (skusArr[i]['promotionInfo'] != "") {
							ariaLabel += skusArr[i]['promotionInfo'] + ' ';
						}
						
						// 促销标签请求 满5个请求并清空数组
						if (index > 0) {
							labelDom.push(skusArr[i]);
							if (labelDom.length == 5) {
								getLabel(labelDom);
								labelDom.length = 0;
							}
						}

						var sgname = skusArr[i]['sugGoodsName'];
						if (price) {
							if (price.indexOf('.') <= -1) {
								price = price
							} else {
								price = price.split('.')[0] + '.' + price.split('.')[1];
							}
						} else {
							price = '';
						}

						ariaLabel += price + '元';

						var guessIcon = '';

						if (productType == '1' || productType == '3' || (productType == '2' && coopSecType == 'A4')) {
							guessIcon = '<i class="zyIcon"></i>';
						}
						// 苏宁服务标签 
						if (productType == '2' && coopSecType == 'A4') {
							if(specialType && specialType.indexOf('T0003') > -1){
								guessIcon = '<i class="snfwIcon"></i>';
							}else{
								guessIcon = '<i class="zyIcon"></i>';
							}
						}

						if (productType == '4' || productType == '5') {
							guessIcon = '<i class="hwgZyIcon"></i>';
						}

						if (productType == '6') {
							guessIcon = '<i class="hwgIcon"></i>';
						}

						if (productType == '7') {
							guessIcon = '<i class="zyIcon"></i><i class="jwIcon"></i>';
						}

						if (recShop == '0070088095') {
							guessIcon = '<i class="laoxIcon"></i>';
						}

						var labelType = skusArr[i].pid && skusArr[i].pid !== '' ? '<span class="label-type">广告</span>' : '';

						if ((skusArr[i].pid && skusArr[i].pid != '') || (skusArr[i].apsClickUrl && skusArr[i].apsClickUrl != '')) {
							var imgUrl = skusArr[i].adSrc,
								jumpUrl = skusArr[i].apsClickUrl;
						} else {
							var imgUrl = skusArr[i].pictureUrl ? skusArr[i].pictureUrl + '?format=400h_400w_4e' : '//image' + Util.getRandomNum() + '.suning.cn' + dataObj.shopPicUrl + recShop + '-' + partNumber + '_1_400x400.jpg',
								jumpUrl = commodity.getUrl(dataObj, trickPoint)
						}

						html += '<li data-partnumber="' + partNumber + '">' +
							'<a tabindex="0" class="pro-link" title="' + ariaLabel + '" aria-label="' + ariaLabel + '" name="' + trickPoint + '" sa-data="' + saData + '" href="' + jumpUrl + '" target="_blank" >' +
							'<img lazy-src="' + imgUrl + '" />' +
							'<p class="title">' + guessIcon + sgname + '</p>' +
							'<p class="price-box">' +
							'<span class="price"><i>¥</i><em>' + price + '</em></span>' +
							'<span class="refprice">' + refPriceDom + '</span>' +
							'</p>' +
							'<p class="cxIcon">' + promotionHtml + '</p>' +
							'</a>' +
							'</li>'
					}

					return html
				}

				// 滚动加载逻辑
				$(window).on("resize scroll",function(){
					var windowHeight = $(window).height(),//当前窗口的高度             
						scrollTop = $(window).scrollTop(),//当前滚动条从上往下滚动的距离            
						docHeight = $(document).height(); //当前文档的高度 
					if (scrollTop + windowHeight >= docHeight - 650 && curTabIndex > 0 && !isLoading) {

						var $curContBox = $(obj).find('.tab-content').eq(curTabIndex),
							catalogueId = $curContBox.attr('data-catalogueId'),
							pageNum = Number($curContBox.attr('data-pageNum')) + 1;

						// 如果已经请求过4次即200个商品
						if (pageNum <= 5) {
							genHtmlNextPage(catalogueId, pageNum).done(function(html){
								$curContBox.find('.loading-next').before(html);
								lazyelem.listen($curContBox.find("img[lazy-src]"), "img");
								lazyelem.detect();
								$curContBox.attr('data-pageNum', pageNum);
								if (pageNum == 5) {
									$curContBox.find('.loading-next').hide()
								}
								isLoading = false;
							}).fail(function(){
								$curContBox.attr('data-pageNum', pageNum);
								if (pageNum == 5) {
									$curContBox.find('.loading-next').hide()
								}
								isLoading = false;
							})
							
						}
						
					}
				});

				function genHtmlNextPage(catalogueId, pageNum) {
					isLoading = true;
					var dfd = $.Deferred(),
						streetCode = Util.getCookie('streetCode') ? Util.getCookie('streetCode') : '',
						// 要改成3241
						url = tuijianDomain + '/recommend-portal/dyBase.jsonp?sceneIds=32-42&u=' + index.uID + '&c=' + index.cID + '&flag=' + pageNum + '&count=50&parameter=3241&districtCode=' + streetCode + '&catalogueId=' + catalogueId + '&cityId=' + cityId + '&snTerminal=284000002001',
						callback = 'genHtmlNextPage'+ new Date().getTime();
					Util.getAjax(url, callback).done(function (res) {
						var html ='';
						if(res && res.sugGoods && res.sugGoods[0] && res.sugGoods[0].skus && res.sugGoods[0].skus.length >= 20){
							var list = res.sugGoods[0].skus,
							len = list.length;
							list.length = (len - len % 20) > 0 ? len - len % 20 : 0;
							
							html = genGoodsHtml(list, curTabIndex)
							dfd.resolve(html)
						}else{
							dfd.reject();
						}
					}).fail(function () {
						dfd.reject()
					})

					return dfd.promise();
				}
			});
		
		} else {
			index.cmsShow(obj);
		}

		function getLabel(labelDom) {
			var dom = []
			$(labelDom).each(function(index, item){
				var productType = item.productType,
					priceType = item.priceType,
					supplierCode = item.supplierCode,
					price = item.price;
				if (productType == 1 || productType == 2) {
					productType = '0';
					supplierCode = '';
				} else if (productType == 3) {
					productType = '5';
				} else if (productType == 4 || productType == 5 || productType == 6) {
					productType = '1';
				}

				var priceList = ['4-1', '4-2', '4-3', '4-4', '4-5', '4-6', '4-7', '4-8', '4-10', '4-12', '4-14', '4-15', '4-32', '6-1', '6-2', '6-3', '6-4', '6-5', '6-32', '7-1', '7-2', '7-3', '7-4', '7-5', '7-6', '8-1', '8-2', '8-3', '8-4', '8-5', '8-6', '8-7','12-1','12-2','13-1','13-2','13-3','14','15','16','17']

				if ($.inArray(priceType, priceList) < 0) {
					priceType = 0
				}

				var string = item.sugGoodsCode + '**' + productType + '*' + priceType + '***' + supplierCode + '*' + price + '****';
				dom.push(string)
			})

			var labelString = dom.join(',');


			index.labelAjax($(obj), labelString);
			
		} 
	});
}
// 促销标签
index.labelAjax=function(container, productCodeAndStoreId, isItem) {
	index.labelAjaxIndex++;

	var callback = 'labelInfo' + new Date().getTime() + index.labelAjaxIndex,
		memberId = encodeURIComponent(Util.getCookie('sncnstr'));
	Util.getCity(function (cityId) {
		if (Util.getCookie('sncnstr')) {
			// http://spes.suning.com/spes-web/act/searchActWithMemIdEnc/{appCode}_{channelId}_{cityId}_{marketId}_{bonusTrigerId}_{nonShoppingBonusTrigerId}_{bonusShoppingTrigerId}_{productCodeAndStoreId}_{memberId}_{isMultiMarket}_{callback}.jsonp
			url = cuxiaoLabelDomain + 'spes-web/act/searchActWithMemIdEnc/CMSADMIN_31_' + cityId + '__9_3_86_' + productCodeAndStoreId + '_' + memberId + '__' + callback + '.jsonp'
		}else{
			//  http://spes.suning.com/spes-web/act/searchActWithoutMemId/{channelId}_{cityId}_{marketId}_{bonusTrigerId}_{nonShoppingBonusTrigerId}_{bonusShoppingTrigerId}_{productCodeAndStoreId}_{isMultiMarket}_{appCode}_{callback}.jsonp
			url = cuxiaoLabelDomain + 'spes-web/act/searchActWithoutMemId/31_' + cityId + '__9_3_86_' + productCodeAndStoreId + '__CMSADMIN_' + callback + '.jsonp';
		}
		Util.getAjax(url,callback).done(function(res){
			if(res && res.activityList && res.activityList.length > 0){
				$(res.activityList).each(function (index, item) {
					var promotionHtml = '',
						activityInfo = item.activityInfo;
						var actDom=[];
					$(activityInfo).each(function(idx, activity){
							activityTypeId = activity.activityTypeId;
							var bonusRulesDesc1 = (activity.bontyRuleInfo && activity.bontyRuleInfo.bountyRuleList && activity.bontyRuleInfo.bountyRuleList[0] && activity.bontyRuleInfo.bountyRuleList[0].bountyRulDescribe) || '',
								bonusRulesDesc2 = ( activity.bonusList &&  activity.bonusList[0] && activity.bonusList[0].bonusRulesDesc) || '',
								couponPromotionLabel =  (activity.bonusList &&  activity.bonusList[0] && activity.bonusList[0].couponPromotionLabel) || '';
	
							if (activityTypeId == 17) {
								actDom[0] =bonusRulesDesc1!=''? '<span>' + bonusRulesDesc1 + '</span>':'';
							} else if (activityTypeId == 11) {
								actDom[1] = couponPromotionLabel !=''?'<span>' + couponPromotionLabel + '</span>':'';
							} else if (activityTypeId==9) {
								actDom[2] ='<span>返券</span>'
							} else if (activityTypeId==4) {
								actDom[3] = bonusRulesDesc2!=''?'<span>' + bonusRulesDesc2 + '</span>':'';
							} else if (activityTypeId==22) {
								actDom[4] = bonusRulesDesc2!=''?'<span>' + bonusRulesDesc2 + '</span>':'';
							} else if (activityTypeId == 5) {
								actDom[5] ='<span>赠品</span>'
							} else if (activityTypeId==15) {
								actDom[6] ='<span>满赠</span>'
							} else if (activityTypeId==16) {
								actDom[7] ='<span>限量赠</span>'
							} else if (activityTypeId==99) {
								actDom[8] = bonusRulesDesc2!=''?'<span>' + bonusRulesDesc2 + '</span>':'';
							} else if (activityTypeId==14) {
								actDom[9] = '<span>免税</span>'
							}
					})
					promotionHtml += actDom.join('')
	
					if(isItem){
						container.find('.cxIcon').append(promotionHtml)
					}else{
						container.find('li[data-partnumber="' + item.productNumber + '"] .cxIcon').append(promotionHtml);
					}
				})
				
			}
		})
	})
}
// tab切
index.tabSwitch = function (opt, callback) {
	var timer,
		container = opt.container,
		tabNav = opt.tabNav,
		tabCont = opt.tabCont,
		contClassName = opt.contClassName,
		defaultIndex = opt.index || 0;

	tabNav.eq(defaultIndex).addClass("cur");

	tabNav.on("mouseenter", function () {
		var $this = $(this),
			curIndex = $this.index();
		timer = setTimeout(function () {
			if ($this.hasClass("cur")) {
				return;
			} else {
				for (var i = 0; i < tabNav.length; i++) {
					if (i == curIndex) {
						tabNav.eq(i).addClass("cur").attr({
							'tabindex': '0',
							'aria-selected': 'true'
						}).siblings().attr({
							'tabindex': '-1',
							'aria-selected': 'false'
						});
						tabCont.eq(i).show().siblings('.' + contClassName).hide();
						callback();
					} else {
						tabNav.eq(i).removeClass("cur");
					}
				}
				lazyelem.detect();
			}
		}, 200);
	});
	tabNav.on('mouseleave', function () {
		clearTimeout(timer);
	});
}
// 首屏联版
index.banner = function () {
	
	if ($('.banner-wrapper').attr('data-tuijian') == 'true') {
		index.adBanner($('.banner-wrapper'), '1400600').done(function () {
			cb()
		}).fail(function(){
			try {
				index.saYcFunc('sy-8dlbggclzx-2sjbz', '1400600');
			} catch (error) {};
			cb()
		})
	}else{
		cb()
	}
	function cb(){
		var duration = $('.banner-wrapper').attr('data-duration') && $('.banner-wrapper').attr('data-duration') != '' ? Number($('.banner-wrapper').attr('data-duration')): 3000;
		var slide = new Util.Slide(".banner", {
				mouseOverDelay: 200,
				duration: 500,
				delay: duration
			}),
			box = $(".banner-wrapper"),
			prev = box.find(".btn-left"),
			next = box.find(".btn-right");
	
		prev.click(function () {
			slide.prev();
		});
		next.click(function () {
			slide.next();
		});
	
		box.hover(function () {
			prev.show();
			next.show();
		}, function () {
			prev.hide();
			next.hide();
		});
	}
};
// 首屏四个小广告
index.bannerFourPic = function(){
	if ($('.four-wrap').attr('data-tuijian') == 'true') {
		index.adBanner($('.four-wrap'), '1400700').done(function () {
			$('.four-wrap').find('a').each(function(index, item){
				// 如果没有请求策略且需要请求cpm
				if(!$(item).attr('data-fromcelue')){
					if($(item).attr("cpmId")){
						cpmRequire($(item).parent());
						if ($(item).attr("cptId")) {
							pid = $(item).attr("cptId");
							if (pid) {
								try {
									apsAdboardCptPvObj.aps_adboard_loadAdCptPv(pid, index.cptTime);
								} catch (e) {
									index.saYcFunc('sy-4xlbggcpmss-2sjbz');
								}
							}
						}
					}else{
						lazyelem.listen($(item).find("img[lazy-src]"), "img");
						lazyelem.detect();
						$(item).show()
					}
				}
			})
		}).fail(function(){
			try {
				index.saYcFunc('sy-4xlbggclzx-2sjbz', '1400700');
			} catch (error) {};
			cb()
		})
	}else{
		cb()
	}
	// 获取cpm的逻辑
	function cb(){
		cpmRequire($('.four-wrap'));
		if ($('.four-wrap').find('a[cptId]')) {
			$('.four-wrap').find('a[cptId]').each(function () {
				pid = $(this).attr('cptId')
				if (pid) {
					try {
						apsAdboardCptPvObj.aps_adboard_loadAdCptPv(pid, index.cptTime);
					} catch (e) {}
				}
			});
		}
		lazyelem.listen($('.four-wrap').find("img[lazy-src]"), "img");
		lazyelem.detect();
		$('.four-wrap').find('a').show()
	}
}
// 策略广告
index.adBanner=function(obj, slotId){	
	var siteid = $('meta[name="siteid"]').attr("content"),
		pageid = $('meta[name="pageid"]').attr("content"),
		modid = $(obj).attr('sap-modid'),
		isAd = $('body').attr('data-ispreview'),
		previewTime = $('body').attr('data-time');
	var dfd = $.Deferred();
	Util.getCity(function (cityId) {
		if (isAd == 'true' && previewTime!='') {
			var url = smpDomain + 'api/banner/preview?slotId=' + slotId + '&t=' + previewTime + '&city=' + cityId;
		}else{
			var url = smpDomain + 'api/pc/banner?slotId=' + slotId + '&custNo=' + index.uID + '&clt=pc&utmSource=' + pageid + '&city=' + cityId + '&siteId=' + siteid + '&pageCode=' + pageid + '&moduleId=' + modid + '&callback=adBanner';
		}
		$.ajax({
			url: url,
			dataType: 'json',
			timeout: 10000,
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			success: function(res){
				if (res && res.data && res.data.banner && res.data.banner.length > 0) {
					var bannerList = res.data.banner,
						impressionid = res.impressionId;
					$(bannerList).each(function (index, item) {
						var bannerItemLi = $(obj).find('li').eq(index),
								bannerItem = bannerItemLi.find('a[cpmid]');
						if (item.adSrc && item.pid) {
							var apsClickUrl = item.apsClickUrl || '',
								adSrc = item.adSrc,
								pid = item.pid,
								title = item.title;
							
							var saData = Util.json2String({
								'slotId': slotId,
								'impressionId': impressionid
							}).replace(/"/g, "'")

							bannerItem.attr({
								'pid': pid,
								'href': apsClickUrl,
								'data-fromcelue': true,
								'sa-data':	saData,
								'aria-label': title,
								'title': title || ''
							})
							//大联版
							if (bannerItem.parents('.banner-wrapper').length == 1) {
								if(bannerItem.hasClass('cpm-item')){
									bannerItem.find('img').attr({
										'd-src': adSrc,
										'alt': title || ''
									})
								}else{
									bannerItem.find('img').attr({
										'lazy-src': adSrc,
										'alt': title || ''
									})
								}
								if(bannerItem.parent().attr('data-needbg')=='true'){
									bannerItem.parent().css('background', item.tone)
								}
							} else {// 小联版
								bannerItem.find('img').attr({
									'lazy-src': adSrc,
									'alt': title || ''
								})
								bannerItem.find('img').attr({
									'src': adSrc,
									'alt': title || ''
								})
								lazyelem.listen(bannerItem.find("img[lazy-src]"), "img");
								lazyelem.detect();
								bannerItem.show()
							}
						}else {
							if (bannerItem && !bannerItem.attr('data-fromcelue') ) {
								cpmRequire(bannerItemLi);
							}
						}
					})
					dfd.resolve()
				} else {
					dfd.reject()
				}
			},
			error: function(){
				dfd.reject()
			}
		})
	})
	return dfd.promise()
}

index.isPiconeShow = function(){
	lazyelem.listen(".cityone-floor", 'fn', function (obj) {
		Util.getCity(function (cityId) {
			var $wrapper = $(obj),
				pics = $wrapper.find('a');
			$(pics).each(function(index, item){
				var _this = $(item),
					cityInfo = _this.attr('data-city'),
					cityAry = cityInfo.split(',');
				if (cityInfo) {
					$(cityAry).each(function(i, v){
						if (v == cityId) {
							_this.show();
						}
					})
				}else{
					_this.show()
				}
			})
		})
	});
}

// 页面放大、缩小逻辑
index.pageZoomSize = function(sizeZoomId) {
	var zoomSize1 = 1.2;
	var zoomSize2 = 1.3;
	var zoomSize3 = 1.5;
	index.needScale = true;
	if ($('.slh') && $('.slh').attr('name') && $('.slh').attr('name')!=='') {
		var zoomArr = $('.slh').attr('name').split(',');
		zoomSize1 = Number(zoomArr[0]) || 1.2;
		zoomSize2 = Number(zoomArr[1]) || 1.3;
		zoomSize3 = Number(zoomArr[2]) || 1.5;
	}
	var clientWidth = window._clientWidth;
	if (sizeZoomId > 0 && clientWidth > 1279) {
		window.isScaled = true;
		if (clientWidth < 1440) {
			sizeZoomId = zoomSize1;
		} else if (clientWidth > 1439 && clientWidth < 1920) {
			sizeZoomId = zoomSize2;
		}else{
			sizeZoomId = zoomSize3;
		}
	}else{
		window.isScaled = false;
		sizeZoomId = 1;
	}
	index.pageZoomInZG(sizeZoomId);
}

index.pageZoomInZG = function(pageZoomIn) {
	//放大
	if (isFirefox = navigator.userAgent.indexOf("Firefox") > 0) {
		if(pageZoomIn == 1){
			$("body").removeAttr('style');
		}else{
			//document.body.style.zoom = pageZoomIn;
			//document.body.style.cssText += '; -moz-transform: scale(' + (pageZoomIn) + ');-moz-transform-origin: 0 0; ';
			$("body").css("zoom", pageZoomIn);
			$("body").css("-moz-transform", "scale(" + (pageZoomIn) + ")");
			$("body").css("-moz-transform-origin", "center top");
			$("body").css("overflow-x", "hidden");
		}
		
	} else if (navigator.userAgent.indexOf("MSIE") > 0 || !!window.ActiveXObject || "ActiveXObject" in window) {
		$("body").css("zoom", pageZoomIn);
		$("body").css("overflow-x", "scroll");
	} else {
		document.body.style.zoom = pageZoomIn;
		$("body").css("overflow-x", "hidden");
	} 
	
}

index.navScaleHandle = function(){
	if ($('.new-rec-tab') && $('.new-rec-tab').find('.tab-nav li') && $('.new-rec-tab').find('.tab-nav li').length > 0){
		var navLen = $('.new-rec-tab').find('.tab-nav li').length;
		if (document.documentElement.clientWidth < 1200 || window.isScaled) {
			$('.new-rec-tab').find('.tab-nav li').css('width', 944 / navLen);
		} else {
			$('.new-rec-tab').find('.tab-nav li').css('width', 1190 / navLen);
		}
	}
}

index.specialWza = function(state){
	// $('.sn-sidebar').find('a').attr('tabindex', '-1');
	var $rankWrap = $('.new-two-phb').find('ul').eq(0);
	if(state == 'normal'){
		$('.new-two-ms').find('.content-box a').attr('tabindex', '0');
		$('.new-two-quan').find('li').eq(2).find('a').attr('tabindex', '0');
		$('.new-two-dj').find('.list-content li a').attr('tabindex', '0');
		$rankWrap.find('li a').attr('tabindex', '0');
	}else{
		$('.new-two-ms').find('.content-box li').eq(2).find('a').attr('tabindex', '-1');
		$('.new-two-quan').find('li').eq(2).find('a').attr('tabindex', '-1');
		$('.new-two-dj').find('.list-content li').each(function (index) {
			if (index > 1) {
				$(this).find('a').attr('tabindex', '-1')
			}
		})
		$rankWrap.find('li').each(function (index) {
			if ((index + 1) % 3 == 0) {
				$(this).find('a').attr('tabindex', '-1');
			}
		})
	}
}

index.jumpFocus = function () {
	var btn = $('#J_accessibility').find('a'),
		$searchInput = $('.search-keyword-box input'),
		$cate = $('.index-list').find('li').eq(0).find('a').eq(0);

	btn.eq(0).on('click',function(){
		$searchInput.focus();
	})

	btn.eq(1).on('click', function () {
		$cate.focus();
	})
}

index.bindKeyBoardEvent = function () {
	var $btn = $('#J_accessibility').find('a[role="link"]'),
		$searchInput = $('.search-keyword-box input'),
		$cate = $('.index-list').find('li').eq(0).find('a').eq(0),
		tabClickNums = 0;

	$(window).on('keydown', function(event){
		if (event.keyCode == 9) {
			bindTabEvent();
		}else if(event.keyCode == 13){
			bindEnterEvent(event);
		}
	})
	
	function bindTabEvent(){
		if(tabClickNums === 0){
			$('.accessibility').css('top',0).focus();
			$('#sncity').find('a').attr('tabindex', '-1');
		} 
		// ie浏览器兼容		
		// if(navigator.userAgent.indexOf("MSIE") > 0 || !!window.ActiveXObject || "ActiveXObject" in window){
			// if(tabClickNums < 2){
			// 	$btn.css('outline', 'none')	
			// 	$btn.eq(tabClickNums).focus().css('outline', 'solid 1px #015FCC');
			// }else{
			// 	$btn.css('outline', 'none');
			// 	focusOrBlur();	
			// }
		// }else{
			focusOrBlur()
		// }
		tabClickNums++;
	}

	function focusOrBlur(){
		$('a, div, span, input, img, dt, li').focus(function(ev){
			var e = ev || window.event,
				tar = e.target || e.srcElement;
			$(tar).css({
				'outline': 'solid 1px #015FCC'
			})
			// 侧边栏加到a标签样式不生效，要加到父元素div
			if(tar.parentNode.className.indexOf('sn-sidebar-tab') > -1){
				$(tar.parentNode).css({
					'outline': 'solid 1px #015FCC'
				})
			}
		});

		$('a, div, span, input, img, dt, li').blur(function (ev) {
			var e = ev || window.event,
				tar = e.target || e.srcElement;
			$(tar).css({
				'outline': 'none'
			})
			// 侧边栏加到a标签样式不生效，要加到父元素div
			if(tar.parentNode.className.indexOf('sn-sidebar-tab') > -1){
				$(tar.parentNode).css({
					'outline': 'none'
				})
			}
		});
	}

	function bindEnterEvent(event){
		$btn.css('outline','none');
		if (tabClickNums == 1) {
			$searchInput.focus();
			event.preventDefault();
		} else if (tabClickNums == 2) {
			$cate.focus().css('outline', 'solid 1px #015FCC');
			event.preventDefault();
		}
	}
}

$(function () {
	lazyelem.listen();
	var callbackNormal = function(){
		if (document.documentElement.clientWidth < 1200) {
			$('body').removeClass('root1200').end().addClass('root990');
			bigscreen = false;
		} else {
			$('body').addClass('root1200');
			bigscreen = true;
		}
		index.pageZoomSize(0);
		index.navScaleHandle();
		index.specialWza('normal');
	};
	var callbackEnlarge = function(){
			$("body").removeClass("root1200").end().addClass("root990");
			bigscreen = false;
			index.pageZoomSize(1);
			index.navScaleHandle();
			index.specialWza('scale');
			try {
				SAUP.sendLogData("manuclick",
				{
					sapmodid:"ghbym",
					sadata:{
						'eleid':'1'
					}
				})
			} catch (error) {
				
			}
	}
	SFE.base.scaleHandle && SFE.base.scaleHandle(callbackNormal,callbackEnlarge)

	$(window).resize(function () {
		if (SFE.base.getCookie('isScale') != 'true') {
			if (document.documentElement.clientWidth < 1200) {
				$('body').removeClass('root1200').end().addClass('root990');
				bigscreen = false;
			} else {
				$('body').addClass('root1200');
				bigscreen = true;
			}
		}
	});

	index.bindKeyBoardEvent();

	index.jumpFocus();

	index.hoverHandle();

	Util.getStreetCode();
	index.cookieGet();
	index.getenv();

	//品牌日
	index.pinpaiShow();
	//大促底部浮动
	index.dacuFloat();
	index.dacuFloatHc();
	
	//大促推荐分会场
	index.dchc();
	index.newHc();
	index.dacuTj();
	
	//V8新增代码
	index.saYcInit();
	index.getUserInfor();
	index.newTwoTtdj();
	index.newTwoMs();
	index.newTwoQuanInit();
	index.newTwoPhb();
	index.newTwoZhibo();
	index.newTwoPg();
	index.newGround();
	index.newRecTab();
	
	index.brandDom();
	index.dacuTitle();
	index.topActive();
	index.lazyFloor();
	index.banner();
	index.bannerFourPic();
	index.floorCode();
	index.getcpm();
	index.isPiconeShow();

	//千变banner
	index.recBanner();
	
	index.cityOperate();
	index.floatbar();
	index.nav();
	index.cmsBgFuncInit();
	index.popInit()

	lazyelem.listen("li[data-sku]", 'fn', function (obj) {
		index.priceDOM.push(obj);
		if (index.getPriceFlag) {
			return;
		}
		index.getPriceFlag = true;
		GetPrice.queryprice(index.priceDOM, "1", index.getpricecallback);
	});

	window.onload=function(){
		$('#sncity').find('a').attr('tabindex', '-1');
		$('.ui-city-toggle').hover(function(){
			$(this).find('#citybName').css('color','#f60')
		},function(){
			$(this).find('#citybName').css('color','#333')
		})
		addSHLIcon();
	}

	index.allImgCpm();


})

function addSHLIcon(){
	let lens = $('.ng-s-footer .ng-authentication').find('a').length;
	if(lens <= 6) {
		$(`<a href="javascript:;" rel="nofollow" sap-expo="true"><img src="${SFE.URL_CONST.RES_HOST[SFE.base.getEnv()]}/project/cmsWeb/suning/homepage/v8/css/images/aria.png" height="24" alt="网页无障碍"></a>`).insertBefore($('.ng-s-footer .ng-authentication').find('a').eq(0))
	}
}